!function a(s,o,u){function l(t,e){if(!o[t]){if(!s[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[t]={exports:{}};s[t][0].call(n.exports,function(e){return l(s[t][1][e]||e)},n,n.exports,a,s,o,u)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)l(u[e]);return l}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./veryengine/veryEngine"),n=e("./veryengine/babylon"),a=function(){function e(e,t){this._showFps=!0,this._canvas=e,n.BabylonEngine.Canvas=this._canvas,this._fps=t,this._table=document.getElementById("VeryTable")}return e.prototype.createScene=function(){this._engine&&(i.VE_Manager.dispose(),this._engine.dispose()),this._engine=new BABYLON.Engine(this._canvas,!0),n.BabylonEngine.Engine=this._engine;var e=this._engine;window.addEventListener("resize",function(){e.resize()}),this._scene=new BABYLON.Scene(this._engine),n.BabylonEngine.Scene=this._scene,n.Time.start();var t=new BABYLON.ArcRotateCamera("MainCamera",0,0,10,new BABYLON.Vector3(0,0,0),this._scene);t.setPosition(new BABYLON.Vector3(20,200,400)),t.attachControl(this._canvas,!0),t.lowerBetaLimit=.1,t.upperBetaLimit=Math.PI/2*.99,t.lowerRadiusLimit=150;return e.hideLoadingUI(),BABYLON.SceneLoader.Append("./scene/","scene.babylon",this._scene,function(e){var t=new i.VeryEngine;console.log("空行数："+hot1.countEmptyRows());try{t.init(hot1.getData(),projectName)}catch(e){console.error(e)}var r=i.VE_Manager.objects(projectName);e.onBeforeRenderObservable.add(function(){for(var e=0;e<r.count;e++){var t=r.getObjectID(e);r.getVeryObject(t).update()}})}),this},e.prototype.animate=function(){var e=this;return this._engine.runRenderLoop(function(){e._canvas.width!==e._canvas.clientWidth&&e._engine.resize(),e._scene&&e._scene.render(),e._showFps&&e.updateFpsPos()}),this},e.prototype.toggleDebug=function(){if(this._engine){var e=this._engine.scenes[0];e.debugLayer.isVisible()?e.debugLayer.hide():e.debugLayer.show({embedMode:!0})}return this},e.prototype.updateFpsPos=function(){this._fps&&(this._fps.style.right=document.body.clientWidth-(this._table.clientWidth+this._canvas.clientWidth)+"px",this._fps.innerHTML=this._engine.getFps().toFixed()+" fps")},e}();r.default=a},{"./veryengine/babylon":10,"./veryengine/veryEngine":98}],2:[function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var n,a=i(e("./game"));document.getElementById("runButton").addEventListener("click",function(){n&&n.createScene().animate()}),document.getElementById("debugButton").addEventListener("click",function(){n&&n.toggleDebug()}),function e(){dataLoaded?function(){var e=document.getElementById("renderCanvas"),t=document.getElementById("fpsLabel");null!==e&&null!==t&&(n=new a.default(e,t)).createScene().animate()}():setTimeout(e,500)}()},{"./game":1}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../enum"),n=function(){function e(){this._enabled=!0,this._projectName="",this.gameObject=null,this.veryObject=null,this._objectID="",this._actionID="",this._erveryFrame=!1,this.isSequence=!1,this._sequenceState=i.SequenceActionState.Initial,this._sequenceAction=null}return Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionID",{get:function(){return this._actionID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return i.ActionType.Normal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"everyFrame",{get:function(){return this._erveryFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SequenceState",{get:function(){return this._sequenceState},set:function(e){this._sequenceState=e},enumerable:!0,configurable:!0}),e.prototype.set=function(e){this._scene=e},e.prototype.setEveryFrame=function(e){this._erveryFrame=e},e.prototype.setActionID=function(e,t,r){this._projectName=e,this._objectID=t,this._actionID=r},e.prototype.setVeryObject=function(e){this.veryObject=e,this.gameObject=e.gameObject},e.prototype.action=function(e,t){this._enabled=e,this._erveryFrame=t,this._enabled&&(this.active(),this._erveryFrame||this.onUpdate())},e.prototype.sequenceAction=function(e,t,r){this._sequenceAction=e,this._sequenceState=i.SequenceActionState.Running,this.action(t,r)},e.prototype.update=function(){this._enabled&&this._erveryFrame&&this.onUpdate()},e.prototype.onUpdate=function(){},e.prototype.pause=function(){this._sequenceState=i.SequenceActionState.Pause},e.prototype.resume=function(){this._sequenceState=i.SequenceActionState.Running},e.prototype.stop=function(){this._sequenceState=i.SequenceActionState.Initial},e.prototype.finish=function(){this._sequenceState=i.SequenceActionState.Initial,null!==this._sequenceAction&&(this._sequenceAction.finishAction(this),this._sequenceAction=null),this.enabled=!1},e}();r.VE_ActionBehaviour=n},{"../enum":20}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("../state"),u=e("../manager"),a=e("../global"),l=e("../utility"),c=e("../babylon"),s=e("../enum"),i=function(){function e(){}return e.addAction=function(e){if(!a.GameGlobal.PlatformLoaded)for(var t=new e.prototype.constructor,r=t.ID.split("|"),i=0;i<r.length;i++){var n=r[i].trim().toLowerCase();this._actionFunctionDics[n]?a.VE_ErrorManager.Add(new a.VE_Error("","响应初始化错误，响应ID重复，当前响应ID："+n+"，重复响应："+t.className+"，请为当前响应重新分配响应ID！","",s.Severity.Error)):this._actionFunctionDics[n]=e}},e.hasAction=function(e){return e=e.toLowerCase(),!!this._actionFunctionDics[e]},e.createAction=function(e,t,r,i,n,a){if(r=r.toLowerCase(),!this._actionFunctionDics[r])return a.isRight=!1,a.message="响应创建错误：当前响应类型在平台中不存在，请检查！响应类型："+r,null;var s;try{if(!(s=new this._actionFunctionDics[r].prototype.constructor))return a.isRight=!1,a.message="响应创建错误：当前响应创建失败，请检查！响应类型："+r,null;var o=s;if(o.set(c.BabylonEngine.Scene),o.setVeryObject(e),o.setActionID(e.projectName,e.objectID,t),!o.paraParser(i))return a.isRight=!1,a.message="该响应创建失败，响应参数格式错误！",null;a.clear();var u=l.VE_TypeConvert.boolConvert(n[1],a);return a.isRight?(o.setEveryFrame(u),o.enabled=!1,o):(a.isRight=!1,a.message="该响应创建失败，响应每帧运行参数目前只允许填写bool常量true或者false，不允许填写变量！",null)}catch(e){return console.error("响应创建错误："+e.message),a.isRight=!1,a.message="响应创建错误：当前响应类型创建失败，请检查！响应类型："+r+"，错误原因："+e.message,null}},e.remove=function(e){e=e.toLowerCase(),delete this._actionFunctionDics[e]},e.findAction=function(e,t){if(e.isCreatedAction(t))return e.getAction(t);var r=t.split(o.StateConst.STATE_SEPARATOR);if(2!==r.length)return null;var i=u.VE_Manager.objects(e.projectName),n=r[0].trim(),a=r[1].trim();if(i.isCreated(n)){var s=i.getVeryObject(n);return s.isCreatedAction(a)?s.getAction(a):null}return null},e.dispose=function(){e._actionFunctionDics={}},e._actionFunctionDics={},e}();r.VE_Actions=i},{"../babylon":10,"../enum":20,"../global":40,"../manager":59,"../state":70,"../utility":85}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../enum"),n=e("../html"),a=e("../utility"),s=e("./assignmentTypeJudge"),o=function(){function e(e,t){this._totalStr="",this._leftType=i.AssignType.Variable,this._rightType=i.AssignType.Variable,this._leftVariable=null,this._leftTemplate=null,this._leftVarID="",this._rightConstStr="",this._rightConstValue=null,this._rightVariable=null,this._rightTemplate=null,this._rightVarID="",this._pos="",this._state=e,this._totalStr=t}return Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftType",{get:function(){return this._leftType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightType",{get:function(){return this._rightType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftVariable",{get:function(){return this._leftVariable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightVariable",{get:function(){return this._leftVariable},enumerable:!0,configurable:!0}),e.prototype.setPos=function(e){this._pos=e},e.prototype.setLeftVariable=function(e){this._leftType=i.AssignType.Variable,this._leftVariable=e},e.prototype.setLeftTemplate=function(e){this._leftType=i.AssignType.Template,this._leftTemplate=e},e.prototype.setLeftTemplateVar=function(e,t){this._leftType=i.AssignType.TemplateVariable,this._leftTemplate=e,this._leftVarID=t},e.prototype.setRightVariable=function(e){this._rightType=i.AssignType.Variable,this._rightVariable=e},e.prototype.setRightTemplate=function(e){this._rightType=i.AssignType.Template,this._rightTemplate=e},e.prototype.setRightNull=function(){this._rightType=i.AssignType.Template,this._rightTemplate=null},e.prototype.setRightTemplateVariable=function(e,t){this._rightType=i.AssignType.TemplateVariable,this._rightTemplate=e,this._rightVarID=t},e.prototype.setRightConst=function(e){this._rightType=i.AssignType.Const,this._rightConstStr=e},e.prototype.setRightConstValue=function(e){this._rightType=i.AssignType.Const,this._rightConstValue=e},e.prototype.finish=function(){},e.prototype.assign=function(){if(this._leftType===i.AssignType.Variable)this.rightAssignment();else if(this._leftType===i.AssignType.Template)null==this._rightTemplate?null!==this._leftTemplate&&this._leftTemplate.unload():this._leftTemplate=this._rightTemplate;else{if(null===this._leftTemplate.templateInstance)return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：左侧模板变量未实例化，"+this._leftTemplate.templateVarID);if(this._leftTemplate.templateInstance.isCreatedExpression(this._leftVarID))return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：左侧变量不能为“公式”，"+this._rightTemplate.templateVarID);if(this._leftTemplate.templateInstance.isCreatedVariable(this._leftVarID))this._leftVariable=this._leftTemplate.templateInstance.getVariable(this._leftVarID),this.rightAssignment();else{if(!this._leftTemplate.templateInstance.isCreatedFsm(this._leftVarID))return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：左侧无法被查找到，"+this._rightTemplate.templateVarID);this._leftVariable=this._leftTemplate.templateInstance.getFsm(this._leftVarID).fsmVar,this.rightAssignment()}}},e.prototype.rightAssignment=function(){if(this._rightType===i.AssignType.Variable)this._leftVariable.setValue(this._rightVariable.getValue());else if(this._rightType===i.AssignType.Const)if(null===this._rightConstValue){var e=new a.ErrorInfo;if(this._rightConstValue=this._leftVariable.initValue(this._rightConstStr,e),!e.isRight)return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：右侧常量转化错误，"+this._rightConstStr);this._leftVariable.setValue(this._rightConstValue)}else this._leftVariable.setValue(this._rightConstValue);else{if(null==this._rightTemplate.templateInstance)return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：右侧模板变量未实例化，"+this._rightTemplate.templateVarID);if(this._rightTemplate.templateInstance.isCreatedExpression(this._rightVarID)){var t=this._rightTemplate.templateInstance.getExpression(this._rightVarID);if(!s.VE_AssignmentTypeJudge.allowExpression(this._leftVariable,t))return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：左侧和右侧数据格式不匹配，不能完成赋值，"+this._rightTemplate.templateVarID);this._leftVariable.setValue(t.evaluate())}else if(this._rightTemplate.templateInstance.isCreatedVariable(this._rightVarID)){var r=this._rightTemplate.templateInstance.getVariable(this._rightVarID);if(!s.VE_AssignmentTypeJudge.allow(this._leftVariable,r))return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：左侧和右侧数据格式不匹配，不能完成赋值，"+this._rightTemplate.templateVarID);this._leftVariable.setValue(r.getValue())}else{if(!this._rightTemplate.templateInstance.isCreatedFsm(this._rightVarID))return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：无法获取右侧变量，不能完成赋值，"+this._rightTemplate.templateVarID);r=this._rightTemplate.templateInstance.getFsm(this._rightVarID).fsmVar;if(!s.VE_AssignmentTypeJudge.allow(this._leftVariable,r))return void n.ShowError.showError("位置："+this._pos+"，项目名："+this.state.Fsm.projectName+"，对象名："+this.state.Fsm.objectID+"，状态名："+this.state.Fsm.fsmID+"，赋值响应："+this._totalStr+"，错误：左侧和右侧数据格式不匹配，不能完成赋值，"+this._rightTemplate.templateVarID);this._leftVariable.setValue(r.getValue())}}},e}();r.VE_Assignment=o},{"../enum":20,"../html":42,"../utility":85,"./assignmentTypeJudge":6}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.allow=function(e,t){return e.varType===t.varType},e.allowExpression=function(e,t){return e.varType===t.expType},e}();r.VE_AssignmentTypeJudge=i},{}],7:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./actionBehaviour")),i(e("./assignment")),i(e("./actions"))},{"./actionBehaviour":3,"./actions":4,"./assignment":5}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./engine"),i=function(){function i(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),this._transform=t?new a("",t):r?new a("",null,r):e?new a(e):new a}return Object.defineProperty(i.prototype,"gameObject",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transform",{get:function(){return this._transform},set:function(e){this._transform=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.transform.name},set:function(e){this.transform.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isEmpty",{get:function(){return this._transform.isEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mesh",{get:function(){return this._transform.mesh},enumerable:!0,configurable:!0}),i.Find=function(e,t){t||(t=n.BabylonEngine.Scene);var r=t.getNodeByName(e);return r?r instanceof BABYLON.AbstractMesh?new i("",r):r instanceof BABYLON.TransformNode?new i("",null,r):(console.error("GameObject.Find函数查找到不支持的类型："+r.getClassName()),null):null},i.Destroy=function(e){e&&e.transform.destroy()},i.CreateInstance=function(e){if(!e)return null;if(e.isEmpty)return new i;if(e.transform.mesh){return new i("",e.transform.mesh instanceof BABYLON.Mesh?e.transform.mesh.createInstance(e.name+"_instance"):e.transform.mesh.sourceMesh.createInstance(e.name+"_instance"))}return new i("",null,e.transform.transformNode.clone(e.name+"_intance"))},i}();r.GameObject=i;var a=function(){function n(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=null),this._transformNode=null,this._mesh=null,this._name="",this._tempVec=BABYLON.Vector3.Zero(),this._parent=null,this.forward=BABYLON.Vector3.Forward(),this.localScale=new BABYLON.Vector3(1,1,1),t?(this._mesh=t,this._transformNode=t,this._name=t.name):r?(this._mesh=null,this._transformNode=r,this._name=r.name):e?(this._mesh=null,this._transformNode=new BABYLON.TransformNode(e),this._name=e):(this._mesh=null,this._transformNode=null,this._name=""),this._transformNode){var i=this._transformNode.parent;i&&(i instanceof BABYLON.AbstractMesh?this._parent=new n(i.name,i):this._parent=new n(i.name,null,i))}else this._parent=null}return Object.defineProperty(n.prototype,"transformNode",{get:function(){return this._mesh?this._mesh:this._transformNode?this._transformNode:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMesh",{get:function(){return!!this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEmpty",{get:function(){return!this._transformNode&&!this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(e){this._transformNode&&(this._transformNode.name=e),this._mesh&&(this._mesh.name=e),this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},set:function(e){this.isEmpty||(e&&!e.isEmpty?(this._transformNode.setParent(e.transformNode),this._parent=e):(this._transformNode.setParent(null),this._parent=null))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localPosition",{get:function(){return this.isEmpty?BABYLON.Vector3.Zero():(this._tempVec.copyFrom(this.transformNode.position),this._tempVec)},set:function(e){this.isEmpty||(this.transformNode.position=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return this.isEmpty?BABYLON.Vector3.Zero():(this._tempVec.copyFrom(this.transformNode.getAbsolutePosition()),this._tempVec)},set:function(e){this.isEmpty||this.transformNode.setAbsolutePosition(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localEulerAngles",{get:function(){if(this.isEmpty)return BABYLON.Vector3.Zero();var e=180/Math.PI;return this.transformNode.rotation.multiplyByFloats(e,e,e)},set:function(e){if(!this.isEmpty){var t=Math.PI/180;this.transformNode.rotation=e.multiplyByFloats(t,t,t)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localRotation",{get:function(){return this.isEmpty?BABYLON.Vector3.Zero():(this._tempVec.copyFrom(this.transformNode.rotation),this._tempVec)},set:function(e){this.isEmpty||(this.transformNode.rotation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){if(this.isEmpty)return BABYLON.Vector3.Zero();var e=this.transformNode.parent,t=180/Math.PI;this.transformNode.setParent(null);var r=this.transformNode.rotation.multiplyByFloats(t,t,t);return this.transformNode.setParent(e),r},set:function(e){if(!this.isEmpty){var t=this.transformNode.parent,r=Math.PI/180;this.transformNode.setParent(null),this.transformNode.rotation=e.multiplyByFloats(r,r,r),this.transformNode.setParent(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotation",{get:function(){if(this.isEmpty)return BABYLON.Vector3.Zero();var e=this.transformNode.parent;return this.transformNode.setParent(null),this._tempVec.copyFrom(this.transformNode.rotation),this.transformNode.setParent(e),this._tempVec},set:function(e){if(!this.isEmpty){var t=this.transformNode.parent;this.transformNode.setParent(null),this.transformNode.rotation=e,this.transformNode.setParent(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"childCount",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hierarchyCount",{get:function(){return 0},enumerable:!0,configurable:!0}),n.prototype.translate=function(e,t){this.transformNode&&this.transformNode.translate(e,1,t)},n.prototype.translateRelativeTo=function(e,t){if(this.transformNode){var r=e.clone();t&&t.transformNode&&(r=this.transformDirection(r)),this.transformNode.translate(r,1,BABYLON.Space.WORLD)}},n.prototype.transformPosition=function(e){if(this.transformNode){var t=this.transformNode.computeWorldMatrix();return BABYLON.Vector3.TransformCoordinates(e,t)}return e},n.prototype.transformDirection=function(e){if(this.transformNode){var t=this.transformNode.computeWorldMatrix();return BABYLON.Vector3.TransformCoordinates(e,t).subtract(this.transformNode.getAbsolutePosition())}return e},n.prototype.inverseTransformPosition=function(e){if(this.transformNode){var t=BABYLON.Matrix.Invert(this.transformNode.computeWorldMatrix());return BABYLON.Vector3.TransformCoordinates(e,t)}return e},n.prototype.inverseTransformDirection=function(e){if(this.transformNode){var t=BABYLON.Matrix.Invert(this.transformNode.computeWorldMatrix()),r=BABYLON.Vector3.TransformCoordinates(e,t),i=BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.Zero(),t);return r.subtract(i)}return e},n.prototype.destroy=function(){this.mesh&&this.mesh.dispose(),this.transformNode&&this.transformNode.dispose()},n}();r.Transform=a},{"./engine":9}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){};r.BabylonEngine=i},{}],10:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./babylonVariables")),i(e("./time")),i(e("./engine"))},{"./babylonVariables":8,"./engine":9,"./time":11}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./engine"),n=function(){function e(){}return Object.defineProperty(e,"frameCounter",{get:function(){return i.BabylonEngine.Scene.getFrameId()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"deltaTime",{get:function(){return.001*i.BabylonEngine.Engine.getDeltaTime()},enumerable:!0,configurable:!0}),e.start=function(){this._startDate=new Date,this._startSecond=this._startDate.valueOf()/1e3},Object.defineProperty(e,"time",{get:function(){return(new Date).valueOf()/1e3-this._startSecond},enumerable:!0,configurable:!0}),e}();r.Time=n},{"./engine":9}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./fsmData"),n=function(){function e(e,t,r){this._projectName="",this._objectID="",this._templateID="",this._isTemplate=!1,this._fsmIDs=[],this._fsmDic={},this._fsmPosDic={},this._triggerIDs=[],this._triggerDic={},this._triggerPosDic={},this._actionIDs=[],this._actionDic={},this._actionInitValue={},this._actionPosDic={},this._projectName=e,(this._isTemplate=r)?this._templateID=t:this._objectID=t}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"templateID",{get:function(){return this._templateID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTemplate",{get:function(){return this._isTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._isTemplate?this._templateID:this._objectID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triggerCount",{get:function(){return this._triggerIDs.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionCount",{get:function(){return this._actionIDs.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsmCount",{get:function(){return this._fsmIDs.length},enumerable:!0,configurable:!0}),e.prototype.isCreatedFsm=function(e){return!!this._fsmDic[e]},e.prototype.createFsm=function(e,t){this._fsmIDs.push(e),this._fsmDic[e]=new i.VE_FsmData(e,this),this._fsmPosDic[e]=t},e.prototype.getFsmData=function(e){return this._fsmDic[e]},e.prototype.getFsmPos=function(e){return this._fsmPosDic[e]},e.prototype.hasFsmIndex=function(e){return 0<=e&&e<this._fsmIDs.length},e.prototype.getFsmID=function(e){return this._fsmIDs[e]},e.prototype.isCreatedTrigger=function(e){return!!this._triggerDic[e]},e.prototype.addTrigger=function(e,t,r){this._triggerIDs.push(e),this._triggerDic[e]=t,this._triggerPosDic[e]=r},e.prototype.getTrigger=function(e){return this._triggerDic[e]},e.prototype.getTriggerPos=function(e){return this._triggerPosDic[e]},e.prototype.hasTriggerIndex=function(e){return 0<=e&&e<this._triggerIDs.length},e.prototype.getTriggerID=function(e){return this._triggerIDs[e]},e.prototype.getTriggerPara=function(e){return this._triggerDic[e]},e.prototype.isCreatedAction=function(e){return!!this._actionDic[e]},e.prototype.addAction=function(e,t,r,i){this._actionIDs.push(e),this._actionDic[e]=t,this._actionInitValue[e]=r,this._actionPosDic[e]=i},e.prototype.getActionPara=function(e){return this._actionDic[e]},e.prototype.getActionPos=function(e){return this._actionPosDic[e]},e.prototype.getActionInitVal=function(e){return this._actionInitValue[e]},e.prototype.hasActionIndex=function(e){return 0<=e&&e<this._actionIDs.length},e.prototype.getActionID=function(e){return this._actionIDs[e]},e.prototype.clear=function(){this._fsmIDs=[],this._fsmDic={},this._triggerIDs=[],this._triggerDic={},this._actionIDs=[],this._actionDic={},this._actionInitValue={}},e}();r.VE_DataSource=n},{"./fsmData":13}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){this._fsmType="",this._initialValStr="",this._states=[],this._dataSource=t,this._fsmID=e}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsmID",{get:function(){return this._fsmID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsmType",{get:function(){return this._fsmType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initialValStr",{get:function(){return this._initialValStr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._states.length},enumerable:!0,configurable:!0}),e.prototype.initFsm=function(e,t){this._fsmType=e,this._initialValStr=t},e.prototype.addState=function(e){this._states.push(e)},e.prototype.getStateData=function(e){return this._states[e]},e}();r.VE_FsmData=i},{}],14:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./variableData")),i(e("./fsmData")),i(e("./stateActionData")),i(e("./stateTriggerData")),i(e("./stateData")),i(e("./dataSource"))},{"./dataSource":12,"./fsmData":13,"./stateActionData":15,"./stateData":16,"./stateTriggerData":17,"./variableData":18}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=e("../enum"),i=function(){function e(e,t,r,i,n){void 0===t&&(t="false"),void 0===r&&(r="false"),void 0===i&&(i="false"),void 0===n&&(n=a.StateActionType.Action),this.totalString="",this.varID="",this.varValue="",this.actionID=e,this.enabled=t,this.everyFrame=r,this.isSequence=i,this.type=n}return e.prototype.setNormalAction=function(e,t,r,i){void 0===t&&(t="false"),void 0===r&&(r="false"),void 0===i&&(i="false"),this.actionID=e,this.enabled=t,this.everyFrame=r,this.isSequence=i,this.type=a.StateActionType.Action},e.prototype.setAssignmentAction=function(e,t,r){this.totalString=e,this.varID=t,this.varValue=r,this.type=a.StateActionType.Assignment},e}();r.VE_StateActionData=i},{"../enum":20}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t,r){this.logicalExp="",this.rowIndex=-1,this._triggers=[],this._triggersPos=[],this._actions=[],this._actionsPos=[],this._associatedStates=[],this._associatedStatesPos=[],this._isSequence=!1,this._fsmData=e,this._valStr=t,this._isInitialValue=r}return Object.defineProperty(e.prototype,"fsmData",{get:function(){return this._fsmData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ValStr",{get:function(){return this._valStr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInitialValue",{get:function(){return this._isInitialValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSequence",{get:function(){return this._isSequence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triggerCount",{get:function(){return this._triggers.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionCount",{get:function(){return this._actions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"associatedStateCount",{get:function(){return this._associatedStates.length},enumerable:!0,configurable:!0}),e.prototype.hasTrigger=function(e){return 0<=e&&e<this._triggers.length},e.prototype.addTrigger=function(e,t){this._triggers.push(e),this._triggersPos.push(t)},e.prototype.getTrigger=function(e){return this._triggers[e]},e.prototype.getTriggerPos=function(e){return this._triggersPos[e]},e.prototype.hasAction=function(e){return 0<=e&&e<this._actions.length},e.prototype.addAction=function(e,t){this._actions.push(e),this._actionsPos.push(t)},e.prototype.getAction=function(e){return this._actions[e]},e.prototype.getActionPos=function(e){return this._actionsPos[e]},e.prototype.hasAssociatedState=function(e){return 0<=e&&e<this._associatedStates.length},e.prototype.addAssociatedState=function(e,t){this._associatedStates.push(e),this._associatedStatesPos.push(t)},e.prototype.getAssociatedState=function(e){return this._associatedStates[e]},e.prototype.getAssociatedStatePos=function(e){return this._associatedStatesPos[e]},e.prototype.setSequence=function(){this._isSequence=!0},e}();r.VE_StateData=i},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){this.triggerID=e,this.logicalSwitch="",this.logicalExp=""}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!0,configurable:!0}),e}();r.VE_StateTriggerData=i},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){this._projectName="",this._variableIDs=[],this._varDics={},this._varPosDic={},this._projectName=e}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._variableIDs.length},enumerable:!0,configurable:!0}),e.prototype.isCreatedVariable=function(e){return!!this._varDics[e]},e.prototype.addVariable=function(e,t,r){this._varDics[e]=t,this._variableIDs.push(e),this._varPosDic[e]=r},e.prototype.getVariableID=function(e){return 0<=e&&e<this._variableIDs.length?this._variableIDs[e]:""},e.prototype.getVariableParas=function(e){return this._varDics[e]},e.prototype.getPos=function(e){return this._varPosDic[e]},e.prototype.clear=function(){this._variableIDs=[],this._varDics={}},e}();r.VE_VariableData=i},{}],19:[function(e,t,r){"use strict";var i,n,a,s,o,u,l,c,p;Object.defineProperty(r,"__esModule",{value:!0}),(i=r.ActionType||(r.ActionType={}))[i.Normal=0]="Normal",i[i.Animation=1]="Animation",(n=r.SequenceActionState||(r.SequenceActionState={}))[n.Initial=0]="Initial",n[n.Prepared=1]="Prepared",n[n.Running=2]="Running",n[n.Pause=3]="Pause",(a=r.StateActionType||(r.StateActionType={}))[a.Action=0]="Action",a[a.Assignment=1]="Assignment",(s=r.AssignType||(r.AssignType={}))[s.Variable=0]="Variable",s[s.Template=1]="Template",s[s.TemplateVariable=2]="TemplateVariable",s[s.Const=3]="Const",(o=r.AssignmentType||(r.AssignmentType={}))[o.Const=0]="Const",o[o.Variable=1]="Variable",o[o.Expression=2]="Expression",(u=r.AssociatedFsmType||(r.AssociatedFsmType={}))[u.Object=0]="Object",u[u.Template=1]="Template",(l=r.VariableScope||(r.VariableScope={}))[l.Local=0]="Local",l[l.Fsm=1]="Fsm",l[l.Global=2]="Global",l[l.Scene=3]="Scene",(c=r.Severity||(r.Severity={}))[c.Warning=0]="Warning",c[c.Error=1]="Error",(p=r.ParaType||(r.ParaType={}))[p.Action=0]="Action",p[p.Trigger=1]="Trigger"},{}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./enumTypes"))},{"./enumTypes":19}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t,r){this._value="",this._line=0,this._pos=0,this._value=e,this._line=t,this._pos=r}return e.prototype.getValue=function(){return this._value},e.prototype.getLine=function(){return this._line},e.prototype.getPos=function(){return this._pos},e.prototype.isDigit=function(){return/\d/.test(this._value)},e.prototype.isLetterOrCharactor=function(){if(/[！；：，。《》？、“”‘’（）【】￥]/.test(this._value))return!1;var e=/[a-zA-Z]/.test(this._value);return e||(e=-1<escape(this._value).indexOf("%u")),e},e.prototype.isWhiteSpace=function(){return" "===this._value},e.prototype.isNewLine=function(){return"\n"===this._value},e.prototype.isEndOfInput=function(){return"\0"===this._value},e.prototype.is=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;r++)if(e[r]===this._value&&"\0"!==e[r])return!0;return!1},e.prototype.toString=function(){return this._value},e}();r.ExpChar=i},{}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./scope"),n=e("./positions"),a=e("./expressionParsing"),s=e("../enum"),o=e("../html"),u=function(){function e(){}return e.init=function(){this._scope=i.Scope.Create()},e.isCreated=function(e){return!!this._scope.isCreated(e)||!!this._expVariable[e]},e.isCreatedVariable=function(e){return!!this._scope.isCreated(e)},e.isCreatedExpression=function(e){return!!this._expVariable[e]},e.createVariable=function(e,t,r){return this.errors=[],this.isCreated(e)?(this.errors.push(n.ParseError.Error(new n.NameLocation(e),"变量："+e+"，类型："+t+"，该变量已创建，请勿重复创建！")),!1):(this._scope.setVariable(e,t,r),!0)},e.createExpression=function(e,t){if(this.errors=[],this.isCreated(e))return this.errors.push(n.ParseError.Error(new n.NameLocation(e),"表达式名："+e+"，表达式："+t+"，该表达式已定义，请勿重复定义！")),!1;var r=a.VE_ExpressionParsing.parsing(e,t,this._scope,this._projectName,"","",s.VariableScope.Scene);if(0<a.VE_ExpressionParsing.errors.length){for(var i=0;i<a.VE_ExpressionParsing.errors.length;i++)this.errors.push(a.VE_ExpressionParsing.errors[i]);return!1}return this._expVariable[e]=r,!0},e.getValue=function(e){return this.isCreated(e)?this.isCreatedVariable(e)?this._scope.find(e).getValue():this._expVariable[e].evaluate():null},e.getExpression=function(e){return this._expVariable[e]?this._expVariable[e]:null},e.getVariable=function(e){return this.isCreatedVariable(e)?this._scope.find(e):null},e.printError=function(){if(0<this.errors.length)for(var e=0;e<this.errors.length;e++)console.error(this.errors[e].toString()),o.ShowError.showError(this.errors[e].toString())},e._expVariable={},e.errors=[],e._projectName="",e._objectID="",e}();(r.ExpManager=u).init()},{"../enum":20,"../html":42,"./expressionParsing":24,"./positions":30,"./scope":31}],23:[function(e,t,r){"use strict";var i;Object.defineProperty(r,"__esModule",{value:!0}),(i=r.ExpressionType||(r.ExpressionType={}))[i.ID=0]="ID",i[i.SPECIAL_ID=1]="SPECIAL_ID",i[i.KEYWORD=2]="KEYWORD",i[i.STRING=3]="STRING",i[i.NUMBER=4]="NUMBER",i[i.BOOL=5]="BOOL",i[i.OPERATOR=6]="OPERATOR",i[i.INTEGER=7]="INTEGER",i[i.FLOAT=8]="FLOAT",i[i.DOUBLE=9]="DOUBLE",i[i.EOI=10]="EOI"},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./tokenizer"),f=e("./expressions"),g=e("./expressionEnum"),n=e("./functionExpression"),a=e("./functions"),y=e("./variableExpression"),m=e("../enum"),d=e("./veryExpressions"),b=e("../manager"),i=function(){function e(){}return e.init=function(){this._bracketPair["("]=")",this._bracketPair["["]="]",this._bracketPair["{"]="}",this._bracketPair["（"]="）",this._bracketPair["【"]="】"},e.parsing=function(e,t,r,i,n,a,s){return this._scope=r,this._projectName=i,this._objectID=n,this._fsmID=a,this._varScope=s,t=this.replace(t),this._tokenizer=new o.Tokenizer(t),this.errors=[],this.parse()},e.replace=function(e){return e=(e=(e=e.replace(/（/g,"(")).replace(/）/g,")")).replace(/！/g,"!")},e.parse=function(){var e=this.buildExpression();return this._tokenizer.current().isEnd()||(this._tokenizer.addError(this._tokenizer.current(),"未定义字符："+this._tokenizer.current().getSource()+" "),this._tokenizer.consume()),this.errors=this._tokenizer.getProblemCollector(),e},e.buildExpression=function(){var e=this.relationalExp();if(this._tokenizer.current().isOperator("&&")){this._tokenizer.consume();var t=this.buildExpression();return this.reOrder(e,t,f.BinaryOperator.Add)}if(this._tokenizer.current().isOperator("||")){this._tokenizer.consume();t=this.buildExpression();return this.reOrder(e,t,f.BinaryOperator.Or)}return e},e.relationalExp=function(){var e=this.algebraExp();if(this._tokenizer.current().isOperator("<")){this._tokenizer.consume();var t=this.relationalExp();return this.reOrder(e,t,f.BinaryOperator.LT)}if(this._tokenizer.current().isOperator("<=")){this._tokenizer.consume();t=this.relationalExp();return this.reOrder(e,t,f.BinaryOperator.LT_EQ)}if(this._tokenizer.current().isOperator("==")){this._tokenizer.consume();t=this.relationalExp();return this.reOrder(e,t,f.BinaryOperator.EQ)}if(this._tokenizer.current().isOperator(">=")){this._tokenizer.consume();t=this.relationalExp();return this.reOrder(e,t,f.BinaryOperator.GT_EQ)}if(this._tokenizer.current().isOperator(">")){this._tokenizer.consume();t=this.relationalExp();return this.reOrder(e,t,f.BinaryOperator.GT)}if(this._tokenizer.current().isOperator("!=")){this._tokenizer.consume();t=this.relationalExp();return this.reOrder(e,t,f.BinaryOperator.NEQ)}return e},e.algebraExp=function(){var e=this.productExp();if(this._tokenizer.current().isOperator("+")){this._tokenizer.consume();var t=this.algebraExp();return this.reOrder(e,t,f.BinaryOperator.Add)}if(this._tokenizer.current().isOperator("-")){this._tokenizer.consume();t=this.algebraExp();return this.reOrder(e,t,f.BinaryOperator.Subtract)}return e},e.productExp=function(){var e=this.exponentExp();if(this._tokenizer.current().isOperator("*")){this._tokenizer.consume();var t=this.productExp();return this.reOrder(e,t,f.BinaryOperator.Multiply)}if(this._tokenizer.current().isOperator("/")){this._tokenizer.consume();t=this.productExp();return this.reOrder(e,t,f.BinaryOperator.Divide)}if(this._tokenizer.current().isOperator("%")){this._tokenizer.consume();t=this.productExp();return this.reOrder(e,t,f.BinaryOperator.Modulo)}return e},e.exponentExp=function(){var e=this.atomExp();return this._tokenizer.current().isOperator("!","！")&&(e=new f.BinaryExpression(e,e,f.BinaryOperator.Not)),e},e.atomExp=function(){if(this._tokenizer.current().isOperator("-"))return this._tokenizer.consume(),(r=new f.BinaryExpression(new f.ConstantExpression(0,"number"),this.atomExp(),f.BinaryOperator.Subtract)).setSeal(),r;if(this._tokenizer.current().isOperator("!","！")&&(this._tokenizer.next().isIdentifier()||this._tokenizer.next().isKeyword()||this._tokenizer.next().isStartBracket())){this._tokenizer.consume();var e=this.atomExp();return"bool"!==e.expType?(this._tokenizer.addError(this._tokenizer.current(),"取非运算(!)后应跟着bool值类型！"),f.ConstantExpression.Empty()):new f.BinaryExpression(e,e,f.BinaryOperator.Not)}if(this._tokenizer.current().isOperator("+")&&this._tokenizer.next().isStartBracket()&&this._tokenizer.consume(),this._tokenizer.current().isOperator("+")&&this._tokenizer.next().isConstant()&&this._tokenizer.consume(),this._tokenizer.current().isOperator("+")&&this._tokenizer.next().isIdentifier()&&this._tokenizer.consume(),this._tokenizer.current().isOperator("*")&&this._tokenizer.next().isIdentifier()){this._tokenizer.consume();var t="*"+this._tokenizer.current().getContents();return null!==(c=d.VE_Expressions.getParseExpression(this._projectName,this._objectID,t,this._varScope))?(this._tokenizer.consume(),c):(null===d.VE_Expressions.getTemplateExpression(this._projectName,this._objectID,t,this._varScope)?this._tokenizer.addError(this._tokenizer.current(),"VeryVar变量名："+t+"，该VeryVar变量未定义，无法在系统中查找到，请检查！"):this._tokenizer.addError(this._tokenizer.current(),"VeryVar变量名："+t+"，公式中不支持模板变量，请检查！"),this._tokenizer.consume(),f.ConstantExpression.Empty())}if(this._tokenizer.current().isStartBracket()){var r,i=this._bracketPair[this._tokenizer.consume().getTrigger()];return"BinaryExpression"===(r=this.buildExpression()).className&&r.setSeal(),this.expectTrigger(g.ExpressionType.OPERATOR,i),r}if(this._tokenizer.current().isConstant()){var n=void 0,a="string";return a=this._tokenizer.current().isBool()?(n="true"===this._tokenizer.current().getContents().toLowerCase(),"bool"):this._tokenizer.current().isNumber()?(n=parseFloat(this._tokenizer.current().getContents()),"number"):(n=this._tokenizer.current().getContents(),"string"),this._tokenizer.consume(),new f.ConstantExpression(n,a)}if(this._tokenizer.current().isIdentifier()){if(this._tokenizer.next().isStartBracket()){var s=this._bracketPair[this._tokenizer.next().getTrigger()];return this.functionCall(s)}var o=void 0,u=this._tokenizer.current(),l=this._tokenizer.consume().getContents();if(l.endsWith(".")&&this._tokenizer.current().isOperator("*")&&this._tokenizer.next().isIdentifier()){this._tokenizer.consume();var c;t=l+"*"+this._tokenizer.current().getContents();return null!==(c=d.VE_Expressions.getParseExpression(this._projectName,this._objectID,t,this._varScope))?(this._tokenizer.consume(),c):(null===d.VE_Expressions.getTemplateExpression(this._projectName,this._objectID,t,this._varScope)?this._tokenizer.addError(u,"VeryVar变量名："+t+"，该VeryVar变量未定义，无法在系统中查找到，请检查！"):this._tokenizer.addError(this._tokenizer.current(),"VeryVar变量名："+t+"，公式中不支持模板变量，请检查！"),this._tokenizer.consume(),f.ConstantExpression.Empty())}return null===(o=this._scope.find(l))?(this._tokenizer.addError(u,"变量名："+l+"，该变量在变量作用域中未定义，也未定义该表达式，无法识别！另外，赋值响应右侧如果是公式，不允许引用模板变量！"),f.ConstantExpression.Empty()):new y.VariableExpression(o)}if(this._tokenizer.current().isKeyword()){if("this"!==this._tokenizer.current().getContents().toLowerCase().trim())return"null"===this._tokenizer.current().getContents().toLowerCase().trim()||"none"===this._tokenizer.current().getContents().toLowerCase().trim()?(this._tokenizer.consume(),new f.VeryTemplateExpression):(this._tokenizer.addError(this._tokenizer.current(),"关键字："+this._tokenizer.current().getContents()+"，该关键字暂无定义，请勿使用！"),this._tokenizer.consume(),f.ConstantExpression.Empty());if(this._varScope===m.VariableScope.Fsm&&""!==this._fsmID){var p=b.VE_Manager.objects(this._projectName);if(null!==p){var h=p.getVeryObject(this._objectID);if(null!=h){var _=h.getFsm(this._fsmID);if(null!=_)return this._tokenizer.consume(),new f.VeryVarExpression(_.fsmVar)}}}return this._tokenizer.addError(this._tokenizer.current(),"关键字：this，该关键字只能使用与状态定义中的触发启动条件和状态逻辑表达式，此处超出使用范围，请检查！"),this._tokenizer.consume(),f.ConstantExpression.Empty()}return this._tokenizer.current().isSpecialIdentifier()?this._tokenizer.addError(this._tokenizer.current(),"特殊ID："+this._tokenizer.current().getSource()+"，暂时未定义，请勿使用！"):this._tokenizer.addError(this._tokenizer.current(),"检测到无效字符："+this._tokenizer.current().getSource()+"，请检查！"),this._tokenizer.consume(),f.ConstantExpression.Empty()},e.reOrder=function(e,t,r){if("BinaryExpression"===t.className){var i=t;if(!i.isSealed()&&i.getPriority()===i.getPriorityOp(r))return this.replaceLeft(i,e,r),t}return new f.BinaryExpression(e,t,r)},e.replaceLeft=function(e,t,r){if("BinaryExpression"===e.getLeftExp().className){var i=e.getLeftExp();if(!i.isSealed()&&i.getPriority()===i.getPriorityOp(r))return void this.replaceLeft(i,t,r)}e.setLeftExp(new f.BinaryExpression(t,e.getLeftExp(),r))},e.functionCall=function(e){var t=new n.FunctionExpression,r=this._tokenizer.consume();if(!a.CustomFunctions.hasFunction(r.getContents()))return this._tokenizer.addError(r,"未定义函数："+r.getContents()+"！"),f.ConstantExpression.Empty();var i=a.CustomFunctions.createFunction(r.getContents());for(t.setFunction(i),this._tokenizer.consume();!this._tokenizer.current().isOperator(e)&&!this._tokenizer.current().isEnd();)0!==t.paraCount()&&this.expectTrigger(g.ExpressionType.OPERATOR,","),t.addPara(this.buildExpression());return this.expectTrigger(g.ExpressionType.OPERATOR,e),t.evaluate(),t.paraCount()>i.parameterNumber()&&0<=i.parameterNumber()?(this._tokenizer.addError(r,"函数参数不一致，当前函数："+r.getContents()+"，规定参数个数Max："+i.parameterNumber()+"，当前参数个数："+t.paraCount()+"，请检查！"),f.ConstantExpression.Empty()):t},e.expectTrigger=function(e,t){this._tokenizer.current().matches(e,t)?this._tokenizer.consume():this._tokenizer.addError(this._tokenizer.current(),"期望获得："+t+"，当前值为："+this._tokenizer.current().getTrigger()+"，请检查！")},e.getProjectCollector=function(){return this._tokenizer.getProblemCollector()},e._bracketPair={},e.errors=[],e._projectName="",e._objectID="",e._fsmID="",e._varScope=m.VariableScope.Local,e}();(r.VE_ExpressionParsing=i).init()},{"../enum":20,"../manager":59,"./expressionEnum":23,"./expressions":25,"./functionExpression":27,"./functions":28,"./tokenizer":34,"./variableExpression":36,"./veryExpressions":37}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../utility/dictionary"),n=e("../template"),a=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"bool"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"TrueExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(){return!0},e.prototype.clone=function(){return new e},e.prototype.toString=function(){return"true"},e}();r.TrueExpression=a;var s,o,u=function(){function e(e,t){this._expType="string",this._value=e,this._expType=t}return Object.defineProperty(e.prototype,"expType",{get:function(){return this._expType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"ConstantExpression"},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(){return this._value},e.prototype.clone=function(){return new e(this._value,this._expType)},e.Empty=function(){return new e(null,"string")},e.prototype.isEmpty=function(){return"string"===this._expType&&null===this._value},e.prototype.toString=function(){return null!==this._value?this._value.toString():"null"},e}();r.ConstantExpression=u,(o=s=r.BinaryOperator||(r.BinaryOperator={})).Add="+",o.Subtract="-",o.Multiply="*",o.Divide="/",o.Modulo="%",o.Power="^",o.LT="<",o.LT_EQ="<=",o.EQ="=",o.GT_EQ=">=",o.GT=">",o.NEQ="!=",o.And="&&",o.Or="||",o.Not="!";var l=function(){function r(e,t,r){this._expType="",this.isRight=!0,this._op=s.EQ,this._isSealed=!1,this._left=e,this._right=t,this._op=r,this._expType=this.resultAutoType(e,t,r),"null"===this._expType&&(this.isRight=!1,console.error("公式两边类型不匹配，左侧类型："+e.expType+"，右侧类型："+t.expType+"，计算类型："+r.toString()))}return Object.defineProperty(r.prototype,"expType",{get:function(){return this._expType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return"BinaryExpression"},enumerable:!0,configurable:!0}),r.init=function(){this._opDic["+"]=s.Add,this._opDic["-"]=s.Subtract,this._opDic["*"]=s.Multiply,this._opDic["/"]=s.Divide,this._opDic["%"]=s.Modulo,this._opDic["**"]=s.Power,this._opDic["^"]=s.Power,this._opDic["<"]=s.LT,this._opDic["<="]=s.LT_EQ,this._opDic["=="]=s.EQ,this._opDic[">="]=s.GT_EQ,this._opDic[">"]=s.GT,this._opDic["!="]=s.NEQ,this._opDic["&&"]=s.And,this._opDic["||"]=s.Or,this._opDic["!"]=s.Not,this._opDic["！"]=s.Not,this._priority.Add(s.Not,2),this._priority.Add(s.Power,3),this._priority.Add(s.Multiply,4),this._priority.Add(s.Divide,4),this._priority.Add(s.Modulo,4),this._priority.Add(s.Add,5),this._priority.Add(s.Subtract,5),this._priority.Add(s.LT,6),this._priority.Add(s.LT_EQ,6),this._priority.Add(s.EQ,6),this._priority.Add(s.GT_EQ,6),this._priority.Add(s.GT,6),this._priority.Add(s.NEQ,6),this._priority.Add(s.And,7),this._priority.Add(s.Or,7)},r.prototype.resultAutoType=function(e,t,r){return r===s.Add?"string"===e.expType||"string"===t.expType?"string":"bool"===e.expType||"bool"===t.expType?"null":"number"===e.expType||"number"===t.expType?"number":"vector3"===e.expType||"vector3"===t.expType?"vector3":"vector2"===e.expType||"vector2"===t.expType?"vector2":"null":r===s.Divide||r===s.Multiply||r===s.Modulo||r===s.Power||r===s.Subtract?"string"===e.expType||"string"===t.expType||"bool"===e.expType||"bool"===e.expType?"null":"vector3"===e.expType&&"vector3"===t.expType&&r===s.Subtract?"vector3":"vector2"===e.expType&&"vector2"===t.expType&&r===s.Subtract?"vector2":"number"===e.expType&&"vector3"===t.expType&&r===s.Multiply||"vector3"===e.expType&&"number"===t.expType&&r==s.Multiply?"vector3":"number"===e.expType&&"vector2"===t.expType&&r===s.Multiply||"vector2"===e.expType&&"number"===t.expType&&r==s.Multiply?"vector2":"vector3"===e.expType&&"number"===t.expType&&r===s.Divide?"vector3":"vector2"===e.expType&&"number"===t.expType&&r===s.Divide?"vector2":"number"===e.expType||"number"===t.expType?"number":"null":r===s.LT||r===s.LT_EQ||r===s.GT_EQ||r===s.GT?"string"===e.expType||"string"===t.expType||"bool"===e.expType||"bool"===t.expType?"null":"bool":r===s.NEQ||r===s.EQ?t.expType!==e.expType?"null":"bool":r===s.Not?"bool"!==t.expType?"null":"bool":"string"},r.prototype.setLeftExp=function(e){this._left=e},r.prototype.setRightExp=function(e){this._right=e},r.prototype.getOp=function(){return this._op},r.prototype.getLeftExp=function(){return this._left},r.prototype.getRightExp=function(){return this._right},r.prototype.isSealed=function(){return this._isSealed},r.prototype.setSeal=function(){this._isSealed=!0},r.prototype.toString=function(){return"("+this._left.toString()+" "+this._op.toString()+" "+this._right.toString()+")"},r.prototype.clone=function(){return new r(this._left.clone(),this._right.clone(),this._op)},r.prototype.evaluate=function(){if("null"===this._expType)return null;"FunctionExpression"===this._left.className&&this._left.evaluate(),"FunctionExpression"===this._right.className&&this._right.evaluate(),this._expType=this.resultAutoType(this._left,this._right,this._op);var e=this._left.evaluate(),t=this._right.evaluate();if(null===e||null===t)return null;if(this._op===s.Add)return"string"===this._expType?e.toString()+t.toString():"number"===this._expType?e+t:"vector3"===this._expType?e.add(t):"vector2"===this._expType?e.add(t):null;if(this._op===s.Subtract)return"number"===this._expType?e-t:"vector3"===this._expType?e.subtract(t):"vector2"===this._expType?e.subtract(t):null;if(this._op===s.Multiply){if("number"===this._expType)return e*t;if("vector3"===this._expType)return"number"==typeof e?t.multiplyByFloats(e,e,e):"number"==typeof t?e.multiplyByFloats(t,t,t):null;if("vector2"===this._expType)return"number"==typeof e?t.multiplyByFloats(e,e):"number"==typeof t?e.multiplyByFloats(t,t):null}else{if(this._op!==s.Divide){if(this._op===s.Modulo)return"number"==typeof e&&"number"==typeof t?e%t:null;if(this._op===s.Power)return"number"==typeof e&&"number"==typeof t?Math.pow(e,t):null;if(this._op===s.And){var r=this.getBoolean(e),i=this.getBoolean(t);return r&&i}if(this._op!==s.Or)return this._op===s.LT?e<t:this._op===s.LT_EQ?e<=t:this._op===s.GT_EQ?t<=e:this._op===s.GT?t<e:this._op===s.EQ?e===t:this._op===s.NEQ?e!==t:this._op===s.Not?!this.getBoolean(t):!this.getBoolean(e);r=this.getBoolean(e),i=this.getBoolean(t);return r||i}if("number"===this._expType)return e/t;if("vector3"===this._expType)return"number"==typeof t?new BABYLON.Vector3(e.x/t,e.y/t,e.z/t):null;if("vector2"===this._expType)return"number"==typeof t?new BABYLON.Vector2(e.x/t,e.y/t):null}},r.prototype.getBoolean=function(e){return"number"==typeof e?0!==e:"string"==typeof e?""!==e:"boolean"==typeof e&&e},r.prototype.getPriority=function(){var e=r._priority.GetValue(this._op);return null===e?100:e},r.prototype.getPriorityOp=function(e){var t=r._priority.GetValue(e);return null===t?100:t},r._opDic={},r._priority=new i.Dictionary,r}();r.BinaryExpression=l;var c=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"expType",{get:function(){return this._value?this._value.varType:"null"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"VeryVarExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(){return this._value.getValue()},e.prototype.clone=function(){return new e(this._value.clone())},e.prototype.toString=function(){return this._value?this._value.toString():"null"},e}();r.VeryVarExpression=c;var p=function(){function t(){this._isTemplate=!1,this._template=new n.VE_Template("","")}return Object.defineProperty(t.prototype,"expType",{get:function(){return"bool"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"VeryTemplateExpression"},enumerable:!0,configurable:!0}),t.prototype.setTemplate=function(e){this._isTemplate=!0,this._template=e},t.prototype.evaluate=function(){return!!this._isTemplate&&(!!this._template&&null!==this._template.templateInstance)},t.prototype.clone=function(){var e=new t;return e._template=this._template,e._isTemplate=this._isTemplate,e},t.prototype.toString=function(){return this._isTemplate&&this._template?(null===this._template.templateInstance).toString():"false"},t}();r.VeryTemplateExpression=p,l.init()},{"../template":75,"../utility/dictionary":83}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this.itemBuffer=[],this.endReached=!1,this.problemCollector=[],this.endOfInputIndicator=void 0}return e.prototype.next=function(){return this.nextOffset(1)},e.prototype.nextOffset=function(e){for(;this.itemBuffer.length<=e&&!this.endReached;){var t=this.fetch();void 0!==t?this.itemBuffer.push(t):this.endReached=!0}return e>=this.itemBuffer.length?(void 0===this.endOfInputIndicator&&(this.endOfInputIndicator=this.endOfInput()),this.endOfInputIndicator):this.itemBuffer[e]},e.prototype.current=function(){return this.nextOffset(0)},e.prototype.consume=function(){var e=this.current();return this.consumeNext(1),e},e.prototype.consumeNext=function(e){if(!(e<0))for(;0<e--;)if(0!==this.itemBuffer.length)this.itemBuffer.shift();else{if(this.endReached)return;void 0===this.fetch()&&(this.endReached=!0)}},e.prototype.getProblemCollector=function(){return this.problemCollector},e.prototype.setProblemCollector=function(e){this.problemCollector=e},e}();r.ForwardQuery=i},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function r(){this._paras=[]}return Object.defineProperty(r.prototype,"expType",{get:function(){return this._function.expType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._function.className},enumerable:!0,configurable:!0}),r.prototype.setFunction=function(e){this._function=e},r.prototype.addPara=function(e){this._paras.push(e)},r.prototype.paraCount=function(){return this._paras.length},r.prototype.evaluate=function(){var e=null;try{e=this._function.evaluate(this._paras)}catch(e){return console.error("自定义函数编译错误，错误信息："+e),null}return e},r.prototype.clone=function(){var e=new r;e._function=this._function;for(var t=0;t<this._paras.length;t++)e._paras.push(this._paras[t].clone());return e},r.prototype.toString=function(){for(var e=this._function.className+"(",t=0;t<this._paras.length;t++)e+=0<t?","+this._paras[t].toString():this._paras[t].toString();return e+")"},r}();r.FunctionExpression=i},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../html"),i=e("../global"),a=e("../enum"),s=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"pow"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 2},e.prototype.evaluate=function(e){var t=Math.pow(e[0].evaluate(),e[1].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Pow函数参数错误，参数1类型："+e[0].expType+"，参数1值："+e[0].evaluate()+"，参数2类型："+e[1].expType+"，参数2值："+e[1].evaluate()+"，请检查！"):t},e}();r.Pow=s;var o=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"ln"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.log(e[0].evaluate());return NaN===t||t===1/0?void n.ShowError.showError("表达式编译错误：Ln函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Ln=o;var u=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"lg"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.log10(e[0].evaluate());return NaN===t||t===1/0?void n.ShowError.showError("表达式编译错误：Lg函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Lg=u;var l=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"sqrt"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.sqrt(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Sqrt函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Sqrt=l;var c=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"abs"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.abs(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Abs函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Abs=c;var p=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"random"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 2},e.prototype.evaluate=function(e){var t=e[0].evaluate(),r=e[1].evaluate()-e[0].evaluate(),i=Math.random()*r+t;return NaN===i?void n.ShowError.showError("表达式编译错误：Random函数参数错误，参数1类型："+e[0].expType+"，参数1值："+e[0].evaluate()+"，参数2类型："+e[1].expType+"，参数2值："+e[1].evaluate()+"，请检查！"):i},e}();r.Random=p;var h=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"round"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.round(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Round函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Round=h;var _=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"sin"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.sin(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Sin函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Sin=_;var f=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"asin"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.asin(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：ASin函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.ASin=f;var g=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"cos"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.cos(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Cos函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Cos=g;var y=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"acos"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.acos(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：ACos函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.ACos=y;var m=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"tan"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.tan(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：Tan函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.Tan=m;var d=function(){function e(){}return Object.defineProperty(e.prototype,"expType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"atan"},enumerable:!0,configurable:!0}),e.prototype.parameterNumber=function(){return 1},e.prototype.evaluate=function(e){var t=Math.atan(e[0].evaluate());return NaN===t?void n.ShowError.showError("表达式编译错误：ATan函数参数错误，参数类型："+e[0].expType+"，参数值："+e[0].evaluate()+"，请检查！"):t},e}();r.ATan=d;var b=function(){function e(){}return e.hasFunction=function(e){return e=e.toLowerCase(),!!this._functionsDic[e]},e.addFunction=function(e){var t=new e.prototype.constructor,r=t.className.toLowerCase();this._functionsDic[r]?i.VE_ErrorManager.Add(new i.VE_Error("","自定义函数初始化错误，函数ID重复，当前函数ID："+t.className+"，请为当前自定义函数重新分配ID！","",a.Severity.Error)):this._functionsDic[r]=e},e.createFunction=function(e){return new(this._functionsDic[e.trim().toLowerCase()].prototype.constructor)},e.remove=function(e){e=e.toLowerCase(),delete this._functionsDic[e]},e._functionsDic={},e}();(r.CustomFunctions=b).addFunction(s),b.addFunction(o),b.addFunction(u),b.addFunction(l),b.addFunction(c),b.addFunction(p),b.addFunction(h),b.addFunction(_),b.addFunction(f),b.addFunction(g),b.addFunction(y),b.addFunction(m),b.addFunction(d)},{"../enum":20,"../global":40,"../html":42}],29:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./expressionEnum")),i(e("./expressions")),i(e("./functions")),i(e("./positions")),i(e("./expChar")),i(e("./token")),i(e("./forwardQuery")),i(e("./tokenizer")),i(e("./tokenReader")),i(e("./variable")),i(e("./variableExpression")),i(e("./scope")),i(e("./functionExpression")),i(e("./expressionParsing")),i(e("./expManager")),i(e("./veryExpressions"))},{"./expChar":21,"./expManager":22,"./expressionEnum":23,"./expressionParsing":24,"./expressions":25,"./forwardQuery":26,"./functionExpression":27,"./functions":28,"./positions":30,"./scope":31,"./token":32,"./tokenReader":33,"./tokenizer":34,"./variable":35,"./variableExpression":36,"./veryExpressions":37}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i,a=function(){function e(e){this._value="",this._line=0,this._pos=0,this._value=e,this._line=1,this._pos=1}return e.prototype.getValue=function(){return this._value},e.prototype.getLine=function(){return this._line},e.prototype.getPos=function(){return this._pos},e}();r.NameLocation=a,(i=n=r.SeverityExp||(r.SeverityExp={}))[i.Warning=0]="Warning",i[i.Error=1]="Error";var s=function(){function i(e,t,r){this._pos=e,this._message=t,this._severity=r}return i.Warning=function(e,t){var r=t;return 0<e.getLine()&&(r="公式解析警告 >>> 错误字符序号："+e.getPos()+"，警告信息："+t),new i(e,r,n.Warning)},i.Error=function(e,t){var r=t;return 0<e.getLine()&&(r="公式解析错误 >>> 错误字符序号："+e.getPos()+"，警告信息："+t),new i(e,r,n.Error)},i.prototype.getPosition=function(){return this._pos},i.prototype.getMessage=function(){return this._message},i.prototype.getSeverity=function(){return this._severity},i.prototype.toString=function(){return"类型："+this._severity.toString()+"，信息："+this._message},i}();r.ParseError=s},{}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./variable"),i=function(){function r(){this._parent=void 0,this._context={}}return r.Create=function(){var e=new r;return e._parent=r.GetRootScope(),e},r.GetRootScope=function(){return void 0===r._root&&((r._root=new r).setVariable("PI","number",Math.PI).makeConstant(Math.PI),r._root.setVariable("EULER","number",Math.E).makeConstant(Math.E)),r._root},r.CreateWithParent=function(e){var t=r.Create();return t._parent=e,t},r.prototype.find=function(e){return this._context[e]?this._context[e]:void 0!==this._parent?this._parent.find(e):null},r.prototype.setVariable=function(e,t,r){var i=this.find(e);return null!==i?(i.setType(t),i.setValue(r),i):this.createVariable(e,t,r)},r.prototype.createVariable=function(e,t,r){if(this._context[e])return this._context[e].setType(t),this._context[e].setValue(r),this._context[e];var i=new n.Variable(e,t,r);return this._context[e]=i},r.prototype.setValue=function(e,t){this._context[e]&&this._context[e].setValue(t)},r.prototype.isCreated=function(e){return!!this._context[e]||void 0!==this._parent&&null!==this._parent.find(e)},r.prototype.clear=function(){this._context={}},r}();r.Scope=i},{"./variable":35}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./expressionEnum"),i=function(){function i(){this.type=n.ExpressionType.STRING,this._source="",this._contents="",this._trigger="",this._line=0,this._pos=0}return i.Create=function(e,t){var r=new i;return r.type=e,r._line=t.getLine(),r._pos=t.getPos(),r},i.CreateAndFill=function(e,t){var r=new i;return r.type=e,r._line=t.getLine(),r._pos=t.getPos(),r._contents=t.getValue(),r._trigger=t.getValue(),r._source=t.toString(),r},i.prototype.addToTrigger=function(e){return this._trigger+=e.getValue(),this._source+=e.getValue(),this},i.prototype.addToSource=function(e){return this._source+=e.getValue(),this},i.prototype.addToContentChar=function(e){return this.addToContent(e.getValue()),this},i.prototype.addToContent=function(e){return this._contents+=e,this._source+=e,this},i.prototype.getTrigger=function(){return this._trigger},i.prototype.getTokenType=function(){return this.type},i.prototype.getContents=function(){return this._contents},i.prototype.getSource=function(){return this._source},i.prototype.getValue=function(){return this._source},i.prototype.getLine=function(){return this._line},i.prototype.getPos=function(){return this._pos},i.prototype.setTokenType=function(e){this.type=e},i.prototype.setTrigger=function(e){this._trigger=e},i.prototype.setContent=function(e){this._contents=e},i.prototype.setSource=function(e){this._source=e},i.prototype.isEnd=function(){return this.type===n.ExpressionType.EOI},i.prototype.is=function(e){return this.type===e},i.prototype.matches=function(e,t){return!!this.is(e)&&(""!==t&&this.getTrigger()===t)},i.prototype.isOperator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return this.is(n.ExpressionType.OPERATOR);for(var r=0;r<e.length;r++)if(this.matches(n.ExpressionType.OPERATOR,e[r]))return!0;return!1},i.prototype.isStartBracket=function(){return!!this.is(n.ExpressionType.OPERATOR)&&("("===this._trigger||"（"===this._trigger)},i.prototype.isEndBracket=function(){return!!this.is(n.ExpressionType.OPERATOR)&&(")"===this._trigger||"）"===this._trigger)},i.prototype.isStartSquareBracket=function(){return!!this.is(n.ExpressionType.OPERATOR)&&("["===this._trigger||"【"===this._trigger)},i.prototype.isEndSquareBracket=function(){return!!this.is(n.ExpressionType.OPERATOR)&&("]"===this._trigger||"】"===this._trigger)},i.prototype.isStartBrace=function(){return!!this.is(n.ExpressionType.OPERATOR)&&"{"===this._trigger},i.prototype.isEndBrace=function(){return!!this.is(n.ExpressionType.OPERATOR)&&"}"===this._trigger},i.prototype.isKeyword=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return this.is(n.ExpressionType.KEYWORD);for(var r=0;r<e.length;r++)if(this.matches(n.ExpressionType.KEYWORD,e[r]))return!0;return!1},i.prototype.isIdentifier=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return this.is(n.ExpressionType.ID);for(var r=0;r<e.length;r++)if(this.matches(n.ExpressionType.ID,e[r]))return!0;return!1},i.prototype.isSpecialIdentifier=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return this.is(n.ExpressionType.SPECIAL_ID);for(var r=0;r<e.length;r++)if(this.matches(n.ExpressionType.SPECIAL_ID,e[r]))return!0;return!1},i.prototype.isSpecialIdentifierWithContent=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!this.matches(n.ExpressionType.SPECIAL_ID,e))return!1;if(0===t.length)return!0;for(var i=0;i<t.length;i++)if(this.getContents()===t[i])return!0;return!1},i.prototype.isNumber=function(){return this.is(n.ExpressionType.NUMBER)},i.prototype.isBool=function(){return this.is(n.ExpressionType.BOOL)},i.prototype.isString=function(){return this.is(n.ExpressionType.STRING)},i.prototype.isConstant=function(){return this.isNumber()||this.isBool()||this.isString()},i.prototype.toString=function(){return this.getTokenType().toString()+": "+this.getContents()+" ("+this._line+": "+this._pos+"), Trigger: "+this.getTrigger()},i}();r.Token=i},{"./expressionEnum":23}],33:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("./forwardQuery"),s=e("./expChar"),o=function(r){function e(e){var t=r.call(this)||this;return t._inputExp="",t._line=1,t._pos=0,t._count=0,t._operator=0,t._inputExp=e,t._count=e.length,t._operator=0,t}return n(e,r),e.prototype.endOfInput=function(){return new s.ExpChar("\0",this._line,this._pos)},e.prototype.fetch=function(){if(this._operator<=this._count-1){var e=this._inputExp[this._operator];return this._operator++,"\n"===e&&(this._line++,this._pos=0),this._pos++,new s.ExpChar(e,this._line,this._pos)}},e.prototype.toString=function(){return 0===this.itemBuffer.length?this._line+":"+this._pos+": Buffer empty":this.itemBuffer.length<2?this._line+":"+this._pos+": "+this.current().toString():this._line+":"+this._pos+": "+this.current().toString()+", "+this.next().toString()},e}(a.ForwardQuery);r.TokenReader=o},{"./expChar":21,"./forwardQuery":26}],34:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("./forwardQuery"),s=e("./token"),o=e("./tokenReader"),u=e("./expressionEnum"),l=e("./positions"),c=function(r){function e(e){var t=r.call(this)||this;return t._decimalSeparator=".",t._lineComment="//",t._blockCommentStart="/*",t._blockCommentEnd="*/",t._brackets=["(",")","（","）","[","]","{","}","【","】"],t._treatSinglePipeAsBracket=!0,t._specialIdStarters=[],t._specialIdTerminators=[],t._keywords={},t._keywordsCaseSensitive=!1,t._stringDelimiters={},t._boolConstant=[],t._inputExp=new o.TokenReader(e),t._stringDelimiters={},t._stringDelimiters['"']="\\",t._stringDelimiters["'"]="\0",t._boolConstant=[],t._boolConstant.push("false"),t._boolConstant.push("true"),t._keywords={},t._keywords.this="this",t._keywords.null="null",t._keywords.none="none",t._keywords[void 0]="undefined",t}return n(e,r),e.prototype.endOfInput=function(){return s.Token.CreateAndFill(u.ExpressionType.EOI,this._inputExp.current())},e.prototype.fetch=function(){for(;this._inputExp.current().isWhiteSpace();)this._inputExp.consume();if(!this._inputExp.current().isEndOfInput())return this.isAtStartOfLineComment(!0)?(this.skipToEndOfLine(),this.fetch()):this.isAtStartOfBlockComment(!0)?(this.skipBlockComment(),this.fetch()):this.isAtStartOfNumber()?this.fetchNumber():this.isAtStartOfIdentifier()?this.fetchId():this._stringDelimiters[this._inputExp.current().getValue()]?this.fetchString():this.isAtBracket(!1)?s.Token.CreateAndFill(u.ExpressionType.OPERATOR,this._inputExp.consume()):this.isAtStartOfSpecialId()?this.fetchSpecialId():this.isOperator(this._inputExp.current())?this.fetchOperator():(this.problemCollector.push(l.ParseError.Error(this._inputExp.current(),"无效的输入字符: "+this._inputExp.current().getValue())),this._inputExp.consume(),this.fetch())},e.prototype.fetchNumber=function(){var e=s.Token.Create(u.ExpressionType.NUMBER,this._inputExp.current());e.addToContentChar(this._inputExp.consume());for(var t=!1;this._inputExp.current().isDigit()||this._inputExp.current().is(this._decimalSeparator);)this._inputExp.current().is(this._decimalSeparator)&&(t&&this.problemCollector.push(l.ParseError.Error(this._inputExp.current(),"公式中有多个小数点！")),t=!0),e.addToContentChar(this._inputExp.consume());return e},e.prototype.fetchId=function(){var e=s.Token.Create(u.ExpressionType.ID,this._inputExp.current());for(e.addToContentChar(this._inputExp.consume());this.isIdentifierChar(this._inputExp.current());)e.addToContentChar(this._inputExp.consume());if(!this._inputExp.current().isEndOfInput()&&-1<this._specialIdTerminators.indexOf(this._inputExp.current().getValue())){var t=s.Token.Create(u.ExpressionType.SPECIAL_ID,e);return t.setTrigger(this._inputExp.current().getValue()),t.setContent(e.getContents()),t.setSource(e.getContents()),t.addToSource(this._inputExp.current()),this._inputExp.consume(),this.handleKeywords(t)}return this.handleKeywords(e)},e.prototype.fetchString=function(){var e=this._inputExp.current().getValue(),t=s.Token.Create(u.ExpressionType.STRING,this._inputExp.current());for(t.addToTrigger(this._inputExp.consume());!this._inputExp.current().isNewLine()&&!this._inputExp.current().is(e)&&!this._inputExp.current().isEndOfInput();)t.addToContentChar(this._inputExp.consume());return this._inputExp.current().is(e)?t.addToSource(this._inputExp.consume()):this.problemCollector.push(l.ParseError.Error(this._inputExp.current(),"常量字符串没有结束分隔符！")),t},e.prototype.isAtStartOfLineComment=function(e){return""!==this._lineComment&&this.canConsumeThisString(this._lineComment,e)},e.prototype.canConsumeThisString=function(e,t){for(var r=0;r<e.length;r++)if(!this._inputExp.nextOffset(r).is(e[r]))return!1;return t&&this._inputExp.consumeNext(e.length),!0},e.prototype.skipToEndOfLine=function(){for(;!this._inputExp.current().isEndOfInput()&&!this._inputExp.current().isNewLine();)this._inputExp.consume()},e.prototype.isAtStartOfBlockComment=function(e){return this.canConsumeThisString(this._blockCommentStart,e)},e.prototype.skipBlockComment=function(){for(;!this._inputExp.current().isEndOfInput();){if(this.isAtEndOfBlockComment())return;this._inputExp.consume()}this.problemCollector.push(l.ParseError.Error(this._inputExp.current(),"块注释没有结束符！"))},e.prototype.isAtEndOfBlockComment=function(){return this.canConsumeThisString(this._blockCommentEnd,!0)},e.prototype.isAtStartOfNumber=function(){return!!this._inputExp.current().isDigit()||!(!this._inputExp.current().is(".")||!this._inputExp.next().isDigit())},e.prototype.isAtStartOfIdentifier=function(){return this._inputExp.current().isLetterOrCharactor()||this._inputExp.current().is("_")||this._inputExp.current().is("#")},e.prototype.isIdentifierChar=function(e){return e.isDigit()||e.isLetterOrCharactor()||e.is("_")||e.is(".")||e.is("#")||e.is(":")||e.is("：")},e.prototype.isAtBracket=function(e){for(var t=!0,r=0;r<this._brackets.length;r++)this._inputExp.current().is(this._brackets[r])||(t=!1);return!!t||!(e||!this._treatSinglePipeAsBracket||!this._inputExp.current().is("|")||!this._inputExp.next().is("|"))},e.prototype.isAtStartOfSpecialId=function(){return-1<this._specialIdStarters.indexOf(this._inputExp.current().getValue())},e.prototype.fetchSpecialId=function(){var e=s.Token.Create(u.ExpressionType.SPECIAL_ID,this._inputExp.current());for(e.addToTrigger(this._inputExp.consume());this.isIdentifierChar(this._inputExp.current());)e.addToContentChar(this._inputExp.consume());return this.handleKeywords(e)},e.prototype.handleKeywords=function(e){var t="";if(this._keywordsCaseSensitive?this._keywords[e.getContents()]&&(t=this._keywords[e.getContents()]):this._keywords[e.getContents().toLowerCase()]&&(t=this._keywords[e.getContents().toLowerCase()]),""==t)return e.is(u.ExpressionType.SPECIAL_ID)||(t=e.getContents().toLowerCase(),-1<this._boolConstant.indexOf(t)&&e.setTokenType(u.ExpressionType.BOOL)),e;var r=s.Token.Create(u.ExpressionType.KEYWORD,e);return r.setTrigger(t),r.setContent(e.getContents()),r.setSource(e.getSource()),r},e.prototype.isOperator=function(e){return!(e.isEndOfInput()||e.isDigit()||e.isLetterOrCharactor()||e.isWhiteSpace())&&!(this.isAtBracket(!0)||this.isAtStartOfBlockComment(!1)||this.isAtStartOfLineComment(!1)||this.isAtStartOfNumber()||this.isAtStartOfIdentifier()||this._stringDelimiters[e.getValue()])},e.prototype.fetchOperator=function(){var e=s.Token.Create(u.ExpressionType.OPERATOR,this._inputExp.current());return e.addToTrigger(this._inputExp.consume()),e.isOperator("*")&&this._inputExp.current().is("*")?e.addToTrigger(this._inputExp.consume()):e.isOperator("&")&&this._inputExp.current().is("&")?e.addToTrigger(this._inputExp.consume()):e.isOperator("|")&&this._inputExp.current().is("|")?e.addToTrigger(this._inputExp.consume()):e.isOperator("<")&&this._inputExp.current().is("=")?e.addToTrigger(this._inputExp.consume()):e.isOperator(">")&&this._inputExp.current().is("=")?e.addToTrigger(this._inputExp.consume()):(e.isOperator("!")||e.isOperator("！"))&&this._inputExp.current().is("=")?e.addToTrigger(this._inputExp.consume()):e.isOperator("=")&&this._inputExp.current().is("=")&&e.addToTrigger(this._inputExp.consume()),e},e.prototype.addError=function(e,t){this.getProblemCollector().push(l.ParseError.Error(e,t))},e.prototype.addWarning=function(e,t){this.getProblemCollector().push(l.ParseError.Warning(e,t))},e}(a.ForwardQuery);r.Tokenizer=c},{"./expressionEnum":23,"./forwardQuery":26,"./positions":30,"./token":32,"./tokenReader":33}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t,r){this._expType="string",this._value=null,this._name="",this._constant=!1,this._name=e,this._expType=t,this._value=r}return Object.defineProperty(e.prototype,"expType",{get:function(){return this._expType},enumerable:!0,configurable:!0}),e.prototype.setType=function(e){this._constant||(this._expType=e)},e.prototype.setValue=function(e){this._constant||(this._value=e)},e.prototype.makeConstant=function(e){this.setValue(e),this._constant=!0},e.prototype.getValue=function(){return this._value},e.prototype.getName=function(){return this._name},e.prototype.isConstant=function(){return this._constant},e.prototype.toString=function(){return"Type: "+this._expType+" --- "+this._name+": "+this._value.toString()},e}();r.Variable=i},{}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"expType",{get:function(){return this._value.expType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"VariableExpression"},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(){return this._value.getValue()},e.prototype.toString=function(){return this._value.getName()},e.prototype.clone=function(){return new e(this._value)},e}();r.VariableExpression=i},{}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./scope"),c=e("./expressions"),u=e("./expressionParsing"),p=e("../enum"),n=e("../scene"),h=e("../manager"),_=e("../state"),a=function(){function o(){}return o.createSceneExpression=function(e,t,r){var i=u.VE_ExpressionParsing.parsing(e,t,o._scope,"","","",p.VariableScope.Scene);return 0<u.VE_ExpressionParsing.errors.length&&(r.isRight=!1,r.message=o.errorMessage(u.VE_ExpressionParsing.errors)),i},o.createGlobalExpression=function(e,t,r,i){var n=u.VE_ExpressionParsing.parsing(e,t,o._scope,r,"","",p.VariableScope.Global);return 0<u.VE_ExpressionParsing.errors.length&&(i.isRight=!1,i.message=o.errorMessage(u.VE_ExpressionParsing.errors)),n},o.createLocalExpression=function(e,t,r,i,n){var a=u.VE_ExpressionParsing.parsing(e,t,o._scope,r,i,"",p.VariableScope.Local);return 0<u.VE_ExpressionParsing.errors.length&&(n.isRight=!1,n.message=o.errorMessage(u.VE_ExpressionParsing.errors)),a},o.createFsmExpression=function(e,t,r,i,n,a){var s=u.VE_ExpressionParsing.parsing(e,t,o._scope,r,i,n,p.VariableScope.Fsm);return 0<u.VE_ExpressionParsing.errors.length&&(a.isRight=!1,a.message=o.errorMessage(u.VE_ExpressionParsing.errors)),s},o.getParseExpression=function(e,t,r,i){if(-1<r.indexOf(_.StateConst.STATE_SEPARATOR)){var n=r.split(_.StateConst.STATE_SEPARATOR);if(2!==n.length)return null;if(t=n[0].trim(),r=n[1].trim().substring(1),i!==p.VariableScope.Local&&i!==p.VariableScope.Fsm)return null;if(s=h.VE_Manager.objects(e)){if(o=s.getVeryObject(t)){if(o.isCreatedVariable(r)){var a=o.getVariable(r);return new c.VeryVarExpression(a)}if(o.isCreatedExpression(r))return o.getExpression(r);if(o.isCreatedFsm(r)){a=o.getFsm(r).fsmVar;return new c.VeryVarExpression(a)}return null}return null}return null}if(r.startsWith(_.StateConst.VARIABLE_SYMBOL)){if(r=r.substring(1),i!==p.VariableScope.Local&&i!==p.VariableScope.Fsm)return i===p.VariableScope.Global?this.getParseGlobal(e,r):this.getParseScene(r);var s;if(s=h.VE_Manager.objects(e)){var o;if(o=s.getVeryObject(t)){if(o.isCreatedVariable(r)){a=o.getVariable(r);return new c.VeryVarExpression(a)}if(o.isCreatedExpression(r))return o.getExpression(r);if(o.isCreatedFsm(r)){a=o.getFsm(r).fsmVar;return new c.VeryVarExpression(a)}return this.getParseGlobal(e,r)}return null}return null}return null},o.getParseGlobal=function(e,t){var r=h.VE_Manager.variables(e);if(r){if(r.isCreatedVariable(t)){var i=r.getVariable(t);return new c.VeryVarExpression(i)}return r.isCreatedExpression(t)?r.getExpression(t):this.getParseScene(t)}return null},o.getParseScene=function(e){if(n.VerySceneVariables.Variables.isCreated(e)){var t=n.VerySceneVariables.Variables.getVariable(e);return new c.VeryVarExpression(t)}return n.VerySceneVariables.Variables.isCreatedExpression(e)?n.VerySceneVariables.Variables.getExpression(e):null},o.errorMessage=function(e){for(var t="",r=0;r<e.length;r++)t+="\n("+(r+1)+") "+e[r].getMessage()+" ;";return t+="\n"},o.getTemplateExpression=function(e,t,r,i){if(-1<r.indexOf(_.StateConst.STATE_SEPARATOR)){var n=r.split(_.StateConst.STATE_SEPARATOR);if(2!==n.length)return null;if(t=n[0].trim(),r=n[1].trim().substring(1),i!==p.VariableScope.Local&&i!==p.VariableScope.Fsm)return null;if(s=h.VE_Manager.objects(e)){if(o=s.getVeryObject(t)){if(o.isCreatedTemplate(r)){var a=o.getTemplate(r);return(l=new c.VeryTemplateExpression).setTemplate(a),l}return null}return null}return null}if(r.startsWith(_.StateConst.VARIABLE_SYMBOL)){if(r=r.substring(1),i===p.VariableScope.Local||i===p.VariableScope.Fsm){var s;if(s=h.VE_Manager.objects(e)){var o;if(o=s.getVeryObject(t)){if(o.isCreatedTemplate(r)){a=o.getTemplate(r);return(l=new c.VeryTemplateExpression).setTemplate(a),l}if(u=h.VE_Manager.variables(e)){if(u.isCreatedTemplate(r)){a=u.getTemplate(r);return(l=new c.VeryTemplateExpression).setTemplate(a),l}return null}return null}return null}return null}if(i!==p.VariableScope.Global)return null;var u;if(u=h.VE_Manager.variables(e)){if(u.isCreatedTemplate(r)){var l;a=u.getTemplate(r);return(l=new c.VeryTemplateExpression).setTemplate(a),l}return null}return null}return null},o._scope=i.Scope.Create(),o}();r.VE_Expressions=a},{"../enum":20,"../manager":59,"../scene":66,"../state":70,"./expressionParsing":24,"./expressions":25,"./scope":31}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../enum"),i=function(){function i(e,t,r,i){this._pos="",this._message="",this._tableName="",this._severity=n.Severity.Error,this._pos=e,this._message=t,this._severity=i,this._tableName=r}return i.warning=function(e,t,r){return new i(e,t,r,n.Severity.Warning)},i.error=function(e,t,r){return new i(e,t,r,n.Severity.Error)},i.prototype.getPos=function(){return this._pos},i.prototype.getMessage=function(){return this._message},i.prototype.getTableName=function(){return this._tableName},i.prototype.getSeverity=function(){return this._severity},i.prototype.toString=function(){return"位置："+this._pos+"，错误信息："+this._message+"，表格名："+this._tableName},i}();r.VE_Error=i;var a=function(){function e(){}return Object.defineProperty(e,"Count",{get:function(){return this._errorList.length},enumerable:!0,configurable:!0}),e.Add=function(e){this._errorList.push(e)},e.GetError=function(e){return this._errorList[e]},e.Print=function(e){if(e)for(var t=0;t<this._errorList.length;t++)this._errorList[t].getSeverity()===n.Severity.Error?(console.error("编译错误 >>> "+e+" -> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--):this._errorList[t].getSeverity()===n.Severity.Warning&&(console.warn("编译警告 >>> "+e+" -> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--);else for(t=0;t<this._errorList.length;t++)this._errorList[t].getSeverity()===n.Severity.Error?(console.error("编译错误 >>> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--):this._errorList[t].getSeverity()===n.Severity.Warning&&(console.warn("编译警告 >>> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--)},e.PrintWarnning=function(e){if(e)for(var t=0;t<this._errorList.length;t++)this._errorList[t].getSeverity()===n.Severity.Warning&&(console.warn("编译警告 >>> "+e+" -> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--);else for(t=0;t<this._errorList.length;t++)this._errorList[t].getSeverity()===n.Severity.Warning&&(console.warn("编译警告 >>> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--)},e.PrintError=function(e){if(e)for(var t=0;t<this._errorList.length;t++)this._errorList[t].getSeverity()===n.Severity.Error&&(console.error("编译错误 >>> "+e+" -> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--);else for(t=0;t<this._errorList.length;t++)this._errorList[t].getSeverity()===n.Severity.Error&&(console.error("编译错误 >>> "+e+" -> "+this._errorList[t].toString()),this._errorList.splice(t,1),t--)},e._errorList=[],e}();r.VE_ErrorManager=a},{"../enum":20}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.PlatformLoaded=!1,e}();r.GameGlobal=i},{}],40:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./gameGlobal")),i(e("./errorManager")),i(e("./triggerGlobal"))},{"./errorManager":38,"./gameGlobal":39,"./triggerGlobal":41}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.Init=function(){},e.AddKeyboard=function(e,t){var r=this;-1===this._scenes.indexOf(t.scene)&&(this._scenes.push(t.scene),t.scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN?r._keyUpdate[e.event.key.toLowerCase()]=!0:r._keyUpdate[e.event.key.toLowerCase()]=!1})),this._triggerList.push(t)},e.RemoveKeyboard=function(e){},e.KeyboardUpdate=function(){for(var e=0;e<this._triggerList.length;e++)this._triggerList[e].enabled&&this._keyUpdate[this._keysDic[this._triggerList[e].unionID]]},e.clear=function(){},e.clearProject=function(e){this._scenes[0].onKeyboardObservable.clear()},e.KEYMAP={},e._keyUpdate={},e._keysDic={},e._triggerList=[],e._scenes=[],e._initialized=!1,e}();r.TriggerGlobal=i},{}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./showError"))},{"./showError":43}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function r(){}return r.initZone=function(){this.errorZone||(this.errorZone=document.getElementById("errorZone"))},r.showMsg=function(e,t){this.initZone(),this.errorContentNow||(this.errorContentNow=this.errorContentPrefix),this.errorContentNow+=e+t+"<br/>",this.errorZone.style.display="block",this.errorZone.innerHTML=this.errorContentNow+"</div>";var r=this.errorZone.querySelector(".close"),i=this;r.addEventListener("click",function(){i.errorZone.style.display="none"})},r.show=function(e){this.showMsg("打印信息>>>",e)},r.showError=function(e){this.showMsg("错误信息>>>",e)},r.showWarn=function(e){this.showMsg("警告信息>>>",e)},r.clear=function(){r.initZone(),r.errorContentNow=r.errorContentPrefix,r.errorZone.innerHTML=r.errorContentNow+"</div>";var e=r.errorZone.querySelector(".close"),t=r;e.addEventListener("click",function(){t.errorZone.style.display="none"})},r.close=function(){r.initZone(),"none"===r.errorZone.style.display?r.errorZone.style.display="block":r.errorZone.style.display="none"},r.errorContentPrefix='<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button>',r}();r.ShowError=i},{}],44:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./utility/index")),i(e("./action/index")),i(e("./dataSource/index")),i(e("./enum/index")),i(e("./expression/index")),i(e("./global/index")),i(e("./html/index")),i(e("./manager/index")),i(e("./object/index")),i(e("./state/index")),i(e("./template/index")),i(e("./trigger/index")),i(e("./loader/index")),i(e("./variables/index")),i(e("./scene/index")),i(e("../verytable/index")),i(e("./library/action/index")),i(e("./library/trigger/index"))},{"../verytable/index":99,"./action/index":7,"./dataSource/index":14,"./enum/index":20,"./expression/index":29,"./global/index":40,"./html/index":42,"./library/action/index":51,"./library/trigger/index":52,"./loader/index":57,"./manager/index":59,"./object/index":63,"./scene/index":66,"./state/index":70,"./template/index":75,"./trigger/index":79,"./utility/index":85,"./variables/index":92}],45:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var s,a,o=e("../../action"),u=e("../../variables"),l=e("../../utility"),c=e("../../enum"),p=e("../../global");(a=s||(s={}))[a.VeryVar=0]="VeryVar",a[a.Template=1]="Template",a[a.Const=2]="Const";var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._debugMode=0,e._typeList=[],e._veryVarDic={},e._templateDic={},e._constDic={},e._separator=" ",e._strBuilder="",e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Debug|调试"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_Debug"},enumerable:!0,configurable:!0}),e.prototype.active=function(){},e.prototype.onUpdate=function(){this._strBuilder="";for(var e=0;e<this._typeList.length;e++)this._typeList[e]===s.Const?this._strBuilder+=this._constDic[e]:this._typeList[e]===s.VeryVar?this._strBuilder+=this._veryVarDic[e].getValue():(this._typeList[e],s.Template),this._strBuilder+=this._separator;this._strBuilder=this._strBuilder.trim(),0===this._debugMode?console.log(this._strBuilder):1==this._debugMode?console.warn(this._strBuilder):2==this._debugMode&&console.error(this._strBuilder)},e.prototype.paraParser=function(e){if(l.ParaParserUtility.ParaNumbers(this.ID,c.ParaType.Action,e.length,2)){if("log"===e[0].toLowerCase()||"调试"===e[0])this._debugMode=0;else if("warn"===e[0].toLowerCase()||"警告"===e[0])this._debugMode=1;else{if("error"!==e[0].toLowerCase()&&"错误"!==e[0])return p.VE_ErrorManager.Add(new p.VE_Error("",this.ID+" 响应 传入参数格式错误，应为Log、Warn或者Error，当前为： "+e[0]+"，请检查填入数据！","",c.Severity.Error)),!1;this._debugMode=2}for(var t=e[1].split("+"),r=0;r<t.length;r++)if(t[r]=t[r].trim(),u.VarTools.IsVarID(t[r])){var i=new l.ErrorInfo,n=u.VarTools.GetVeryVarWithExpression(this.projectName,this.objectID,t[r],i);if(null===n){i.clear();var a=u.VarTools.GetTemplate(this.projectName,this.objectID,t[r],i);null===a?(p.VE_ErrorManager.Add(new p.VE_Error("",this.ID+" 响应 传入参数格式可能有误，当前参数："+t[r]+"，当前参数含有变量符号，但是在系统中无法查找到，此处当常量处理，请注意！","",c.Severity.Error)),this._constDic[this._typeList.length]=t[r],this._typeList.push(s.Const)):(this._templateDic[this._typeList.length]=a,this._typeList.push(s.Template))}else this._veryVarDic[this._typeList.length]=n,this._typeList.push(s.VeryVar)}else this._constDic[this._typeList.length]=t[r],this._typeList.push(s.Const);return!0}return!1},e.prototype.destroy=function(){},e}(o.VE_ActionBehaviour);r.Action_Debug=h,o.VE_Actions.addAction(h)},{"../../action":7,"../../enum":20,"../../global":40,"../../utility":85,"../../variables":92}],46:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../action"),s=e("../../enum"),o=e("../../utility"),u=e("../../variables"),l=e("../../global"),c=e("../../babylon"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._switch=!1,e._timer=0,e._isLinear=!0,e._startFloat=new u.VeryNumber,e._endFloat=new u.VeryNumber,e._timeFloat=new u.VeryNumber,e._resultFloat=new u.VeryNumber,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Float_Interpolate|浮点数插值"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_Float_Interpolate"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return s.ActionType.Animation},enumerable:!0,configurable:!0}),e.prototype.active=function(){0===this._timeFloat.value?this.timesUp():(this._timer=0,this._switch=!0)},e.prototype.pause=function(){this._switch=!1,t.prototype.pause.call(this)},e.prototype.resume=function(){this._switch=!0,t.prototype.resume.call(this)},e.prototype.stop=function(){this.timesUp(),t.prototype.stop.call(this)},e.prototype.timesUp=function(){this._switch=!1,this._timer=0,this.finish()},e.prototype.update=function(){this._switch&&(this._timer+=c.Time.deltaTime,this._timer>this._timeFloat.value?(this._switch=!1,this._timer=0,this._isLinear?this._resultFloat.value=o.FloatUitlity.Lerp(this._startFloat.value,this._endFloat.value,1):this._resultFloat.value=o.FloatUitlity.SLerp(this._startFloat.value,this._endFloat.value,1),this.timesUp()):this._isLinear?this._resultFloat.value=o.FloatUitlity.Lerp(this._startFloat.value,this._endFloat.value,this._timer/this._timeFloat.value):this._resultFloat.value=o.FloatUitlity.SLerp(this._startFloat.value,this._endFloat.value,this._timer/this._timeFloat.value))},e.prototype.paraParser=function(e){if(o.ParaParserUtility.ParaNumbers(this.ID,s.ParaType.Action,e.length,5)){if("linear"===e[0].toLowerCase()||"线性"===e[0])this._isLinear=!0;else{if("smooth"!==e[0].toLowerCase()&&"圆滑"!==e[0])return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 响应 传入参数格式错误，应为Log、Warn或者Error，当前为： "+e[0]+"，请检查填入数据！","",s.Severity.Error)),!1;this._isLinear=!1}var t=new o.VeryParas;if(!o.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,t,e[1]))return!1;this._startFloat=t.number;var r=new o.VeryParas;if(!o.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,r,e[2]))return!1;this._endFloat=r.number;var i=new o.VeryParas;if(!o.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,i,e[3]))return!1;this._timeFloat=i.number;var n=new o.VeryParas;return!!o.ParaParserUtility.NumberParaOnlyVar(this.projectName,this.objectID,this.ID,s.ParaType.Action,n,e[4])&&(this._resultFloat=n.number,!0)}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_Float_Interpolate=p,a.VE_Actions.addAction(p)},{"../../action":7,"../../babylon":10,"../../enum":20,"../../global":40,"../../utility":85,"../../variables":92}],47:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../action"),u=e("../../utility"),l=e("../../enum"),c=e("../../variables"),p=e("../../global"),s=e("../../manager"),o=e("../../babylon"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._template=null,e._templateVarID="",e._deriveID=new c.VeryString,e._objectInfo=new c.VeryString,e._ref=new c.VeryGameObject,e._position=new c.VeryVector3,e._posX=new c.VeryNumber,e._posY=new c.VeryNumber,e._posZ=new c.VeryNumber,e._isPositionVec=!0,e._angle=new c.VeryVector3,e._angleX=new c.VeryNumber,e._angleY=new c.VeryNumber,e._angleZ=new c.VeryNumber,e._isAngleVec=!0,e._destoryOnCreateNew=new c.VeryBool,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"创建模板对象|Create_Instance"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_CreateTemplateInstance"},enumerable:!0,configurable:!0}),e.prototype.active=function(){if(null!==this._template){var e=new u.ErrorInfo,t=s.VE_Manager.templates(this.projectName).createInstance(this.objectID,this._templateVarID,this._template,this._objectInfo.value,e,this._destoryOnCreateNew.value);if(null!==t&&null!==t.templateInstance)if(null!==this._ref.value){this._isPositionVec?t.templateInstance.gameObject.transform.position=this._ref.value.transform.transformPosition(this._position.value):t.templateInstance.gameObject.transform.position=this._ref.value.transform.transformPosition(new BABYLON.Vector3(this._posX.value,this._posY.value,this._posZ.value));var r=new o.GameObject("Angle__Empty");r.transform.parent=this._ref.value.transform,this._isAngleVec?r.transform.localEulerAngles=this._angle.value:r.transform.localEulerAngles=new BABYLON.Vector3(this._angleX.value,this._angleY.value,this._angleZ.value),t.templateInstance.gameObject.transform.eulerAngles=r.transform.eulerAngles,o.GameObject.Destroy(r)}else this._isPositionVec?t.templateInstance.gameObject.transform.position=this._position.value:t.templateInstance.gameObject.transform.position=new BABYLON.Vector3(this._posX.value,this._posY.value,this._posZ.value),this._isAngleVec?t.templateInstance.gameObject.transform.eulerAngles=this._angle.value:t.templateInstance.gameObject.transform.eulerAngles=new BABYLON.Vector3(this._angleX.value,this._angleY.value,this._angleZ.value);else console.error(this.ID+" 响应 创建模板对象错误，错误原因："+e.message)}},e.prototype.paraParser=function(e){if(u.ParaParserUtility.ParaNumbers(this.ID,l.ParaType.Action,e.length,6,7)){var t=new u.ErrorInfo;if(this._templateVarID=e[0],this._template=c.VarTools.GetTemplate(this.projectName,this.objectID,e[0],t),null===this._template)return p.VE_ErrorManager.Add(new p.VE_Error("",this.ID+" 响应 传入参数格式错误，创建模板对象错误，模板对象："+e[0]+"，错误原因： "+t.message,"",l.Severity.Error)),!1;var r=new u.VeryParas;if(!u.ParaParserUtility.StringParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,r,e[1]))return!1;this._deriveID=r.string;var i=new u.VeryParas;if(!u.ParaParserUtility.StringParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,i,e[2]))return!1;this._objectInfo=i.string;var n=new u.VeryParas;if(!u.ParaParserUtility.GameObjectPara(this.projectName,this.objectID,this.ID,l.ParaType.Action,n,e[3]))return!1;this._ref=n.gameObject;var a=new u.VeryParas;if(!u.ParaParserUtility.Vector3OrNumberParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,a,e[4]))return!1;this._isPositionVec=a.isVec,this._position=a.vector3,this._posX=a.vecNumbers[0],this._posY=a.vecNumbers[1],this._posZ=a.vecNumbers[2];var s=new u.VeryParas;if(!u.ParaParserUtility.Vector3OrNumberParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,s,e[5]))return!1;if(this._isAngleVec=s.isVec,this._angle=s.vector3,this._angleX=s.vecNumbers[0],this._angleY=s.vecNumbers[1],this._angleZ=s.vecNumbers[2],6<e.length){var o=new u.VeryParas;if(!u.ParaParserUtility.BoolParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,o,e[6]))return!1;this._destoryOnCreateNew=o.bool}else this._destoryOnCreateNew.value=!0;return!0}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_CreateTemplateInstance=h;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isInstance=!0,e._template=null,e._instance=null,e._templateStr="",e._deleteAllTemplates=new c.VeryBool,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"删除模板对象|Destroy_Instance"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_DestroyTemplateInstance"},enumerable:!0,configurable:!0}),e.prototype.active=function(){if(this._isInstance){if(null!==this._instance){if(null!==this._instance.template)if(this._instance.template.unloadInstance(this._instance),this._deleteAllTemplates.value)(e=this._instance.template.backupInstances)&&e.forEach(function(e){e.unload()}),this._instance.template.unload(!0);this._instance.unload()}}else{if(null===this._template||null===this._template.templateInstance)return void console.error(this.ID+" 响应，模板变量："+this._templateStr+"，当前模板变量未实例化创建，无法删除！");var e;if(this._deleteAllTemplates.value)(e=this._template.backupInstances)&&e.forEach(function(e){e.unload()}),this._template.unload(!0);else this._template.templateInstance.unload(),this._template.unload()}},e.prototype.paraParser=function(e){if(u.ParaParserUtility.ParaNumbers(this.ID,l.ParaType.Action,e.length,1,2)){if("this"===e[0].toLowerCase())this._instance=this.veryObject,this._isInstance=!0;else{this._isInstance=!1,this._templateStr=e[0];var t=new u.ErrorInfo;if(this._template=c.VarTools.GetTemplate(this.projectName,this.objectID,e[0],t),null===this._template)return p.VE_ErrorManager.Add(new p.VE_Error("",this.ID+" 响应 模板变量获取错误，错误原因："+t.message+"，请检查！","",l.Severity.Error)),!1}if(1<e.length){var r=new u.VeryParas;if(!u.ParaParserUtility.BoolParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,r,e[1]))return!1;this._deleteAllTemplates=r.bool}else this._deleteAllTemplates.value=!1;return!0}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_DestroyTemplateInstance=_,a.VE_Actions.addAction(h),a.VE_Actions.addAction(_)},{"../../action":7,"../../babylon":10,"../../enum":20,"../../global":40,"../../manager":59,"../../utility":85,"../../variables":92}],48:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../action"),s=e("../../variables"),o=e("../../babylon"),u=e("../../utility"),l=e("../../enum"),c=e("../../global"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._posvalue=new s.VeryNumber,e._posVec=new s.VeryVector3,e._space=BABYLON.Space.LOCAL,e._isVec=!1,e._x=new s.VeryNumber,e._y=new s.VeryNumber,e._z=new s.VeryNumber,e._axis=0,e._trans=new s.VeryGameObject,e._ref=new s.VeryGameObject,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Set_Position|设置位置"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_SetPosition"},enumerable:!0,configurable:!0}),e.prototype.active=function(){},e.prototype.onUpdate=function(){if(null!==this._trans&&null!==this._trans.value)if(this._space===BABYLON.Space.LOCAL)0===this._axis?this._trans.value.transform.localPosition=new BABYLON.Vector3(this._posvalue.value,this._trans.value.transform.localPosition.y,this._trans.value.transform.localPosition.z):1===this._axis?this._trans.value.transform.localPosition=new BABYLON.Vector3(this._trans.value.transform.localPosition.x,this._posvalue.value,this._trans.value.transform.localPosition.z):2===this._axis?this._trans.value.transform.localPosition=new BABYLON.Vector3(this._trans.value.transform.localPosition.x,this._trans.value.transform.localPosition.y,this._posvalue.value):this._isVec?this._trans.value.transform.localPosition=this._posVec.value:this._trans.value.transform.localPosition=new BABYLON.Vector3(this._x.value,this._y.value,this._z.value);else if(this._space===BABYLON.Space.WORLD)0===this._axis?this._trans.value.transform.position=new BABYLON.Vector3(this._posvalue.value,this._trans.value.transform.position.y,this._trans.value.transform.position.z):1===this._axis?this._trans.value.transform.position=new BABYLON.Vector3(this._trans.value.transform.position.x,this._posvalue.value,this._trans.value.transform.position.z):2===this._axis?this._trans.value.transform.position=new BABYLON.Vector3(this._trans.value.transform.position.x,this._trans.value.transform.position.y,this._posvalue.value):this._isVec?this._trans.value.transform.position=this._posVec.value:this._trans.value.transform.position=new BABYLON.Vector3(this._x.value,this._y.value,this._z.value);else if(null!==this._ref.value){var e=this._trans.value.transform.parent;this._trans.value.transform.parent=this._ref.value.transform,0===this._axis?this._trans.value.transform.localPosition=new BABYLON.Vector3(this._posvalue.value,this._trans.value.transform.localPosition.y,this._trans.value.transform.localPosition.z):1===this._axis?this._trans.value.transform.localPosition=new BABYLON.Vector3(this._trans.value.transform.localPosition.x,this._posvalue.value,this._trans.value.transform.localPosition.z):2===this._axis?this._trans.value.transform.localPosition=new BABYLON.Vector3(this._trans.value.transform.localPosition.x,this._trans.value.transform.localPosition.y,this._posvalue.value):this._isVec?this._trans.value.transform.localPosition=this._posVec.value:this._trans.value.transform.localPosition=new BABYLON.Vector3(this._x.value,this._y.value,this._z.value),this._trans.value.transform.parent=e}else console.warn(this.ID+" 响应，参考物体为空，请检查！")},e.prototype.paraParser=function(e){if(u.ParaParserUtility.ParaNumbers(this.ID,l.ParaType.Action,e.length,4)){var t=new u.VeryParas;if(!u.ParaParserUtility.GameObjectPara(this.projectName,this.objectID,this.ID,l.ParaType.Action,t,e[0]))return!1;if(this._trans=t.gameObject,"self"===e[1].toLowerCase()||"自身"===e[1])this._space=BABYLON.Space.LOCAL;else if("world"===e[1].toLowerCase()||"世界"===e[1])this._space=BABYLON.Space.WORLD;else{this._space=BABYLON.Space.BONE;var r=new u.VeryParas;if(!u.ParaParserUtility.GameObjectPara(this.projectName,this.objectID,this.ID,l.ParaType.Action,r,e[1]))return!1;if(this._ref=r.gameObject,null===this._ref.value)return c.VE_ErrorManager.Add(new c.VE_Error("",this.ID+" 响应传入参数 参考物体： "+e[1]+"，该参考物体在场景中无法找到！","",l.Severity.Error)),!1}if("x"===e[2].toLowerCase())this._axis=0;else if("y"===e[2].toLowerCase())this._axis=1;else if("z"===e[2].toLowerCase())this._axis=2;else{if("vector3"!==e[2].toLowerCase())return c.VE_ErrorManager.Add(new c.VE_Error("",this.ID+" 响应参数格式错误，轴参数应为x、y、z或者vector3，当前为："+e[2]+"，请检查！","",l.Severity.Error)),!1;this._axis=3}if(3===this._axis){var i=new u.VeryParas;if(!u.ParaParserUtility.Vector3OrNumberParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,i,e[3]))return!1;this._isVec=i.isVec,this._posVec=i.vector3,this._x=i.vecNumbers[0],this._y=i.vecNumbers[1],this._z=i.vecNumbers[2]}else{i=new u.VeryParas;if(!u.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,i,e[3]))return!1;this._posvalue=i.number}return!0}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_SetPosition=p;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._refType=BABYLON.Space.LOCAL,e._translateObj=new s.VeryGameObject,e._refObj=new s.VeryGameObject,e._isDeltaTime=new s.VeryBool,e._isVec=!0,e._vecVar=new s.VeryVector3,e._xVar=new s.VeryNumber,e._yVar=new s.VeryNumber,e._zVar=new s.VeryNumber,e._paraTime=1,e._paraVec=new s.VeryVector3,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"直线运动|Translate"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_Translate"},enumerable:!0,configurable:!0}),e.prototype.active=function(){},e.prototype.onUpdate=function(){this._translateObj&&this._translateObj.value&&(this._isDeltaTime&&this._isDeltaTime.value?this._paraTime=o.Time.deltaTime:this._paraTime=1,this._isVec?this._paraVec.value.copyFrom(this._vecVar.value):(this._paraVec.value.x=this._xVar.value,this._paraVec.value.y=this._yVar.value,this._paraVec.value.z=this._zVar.value),this._paraVec.value=this._paraVec.value.multiplyByFloats(this._paraTime,this._paraTime,this._paraTime),this._refType===BABYLON.Space.LOCAL||this._refType===BABYLON.Space.WORLD?this._translateObj.value.transform.translate(this._paraVec.value,this._refType):this._refObj&&this._refObj.value?this._translateObj.value.transform.translateRelativeTo(this._paraVec.value,this._refObj.value.transform):this._translateObj.value.transform.translate(this._paraVec.value,BABYLON.Space.WORLD))},e.prototype.paraParser=function(e){if(u.ParaParserUtility.ParaNumbers(this.ID,l.ParaType.Action,e.length,4)){var t=new u.VeryParas;if(!u.ParaParserUtility.GameObjectPara(this.projectName,this.objectID,this.ID,l.ParaType.Action,t,e[0]))return!1;this._translateObj=t.gameObject;var r=new u.VeryParas;if(!u.ParaParserUtility.Vector3OrNumberParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,r,e[1]))return!1;if(this._vecVar=r.vector3,this._xVar=r.vecNumbers[0],this._yVar=r.vecNumbers[1],this._zVar=r.vecNumbers[2],this._isVec=r.isVec,"world"===e[2].toLowerCase()||"世界"===e[2])this._refType=BABYLON.Space.WORLD;else if("self"===e[2].toLowerCase()||"自身"===e[2])this._refType=BABYLON.Space.LOCAL;else{var i=new u.VeryParas;if(!u.ParaParserUtility.GameObjectPara(this.projectName,this.objectID,this.ID,l.ParaType.Action,i,e[2]))return!1;this._refObj=i.gameObject,null===this._refObj.value&&c.VE_ErrorManager.Add(new c.VE_Error("",this.ID+" 响应传入参数 参考物体： "+e[2]+"，该参考物体在场景中无法找到！","",l.Severity.Error))}var n=new u.VeryParas;return!!u.ParaParserUtility.BoolParaWithExpression(this.projectName,this.objectID,this.ID,l.ParaType.Action,n,e[3])&&(this._isDeltaTime=n.bool,!0)}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_Translate=h,a.VE_Actions.addAction(p),a.VE_Actions.addAction(h)},{"../../action":7,"../../babylon":10,"../../enum":20,"../../global":40,"../../utility":85,"../../variables":92}],49:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../action"),s=e("../../utility"),o=e("../../enum"),u=e("../../variables"),l=e("../../global"),c=e("../../babylon"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._switch=!1,e._timer=0,e._isLinear=!0,e._acceptVec=new u.VeryVector3,e._timeFloat=new u.VeryNumber,e._isVec1=!1,e._vecUnit1=new u.VeryVector3,e._vecFloat1=[],e._isVec2=!1,e._vecUnit2=new u.VeryVector3,e._vecFloat2=[],e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Vector3_Interpolate|向量插值"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_Vector3_Interpolate"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return o.ActionType.Animation},enumerable:!0,configurable:!0}),e.prototype.active=function(){0===this._timeFloat.value?this.timesUp():(this._timer=0,this._switch=!0)},e.prototype.onUpdate=function(){if(this._switch){this._timer+=c.Time.deltaTime;var e=this._vecUnit1.value;this._isVec1||(e=new BABYLON.Vector3(this._vecFloat1[0].value,this._vecFloat1[1].value,this._vecFloat1[2].value));var t=this._vecUnit2.value;this._isVec2||(t=new BABYLON.Vector3(this._vecFloat2[0].value,this._vecFloat2[1].value,this._vecFloat2[2].value)),this._timer>this._timeFloat.value?(this._switch=!1,this._timer=0,this._isLinear?this._acceptVec.value=BABYLON.Vector3.Lerp(e,t,1):this._acceptVec.value=s.Vector3Utility.Slerp(e,t,1),this._acceptVec.value.set(t.x,t.y,t.z),this.timesUp()):this._isLinear?this._acceptVec.value=BABYLON.Vector3.Lerp(e,t,this._timer/this._timeFloat.value):this._acceptVec.value=s.Vector3Utility.Slerp(e,t,this._timer/this._timeFloat.value)}},e.prototype.pause=function(){this._switch=!1,t.prototype.pause.call(this)},e.prototype.resume=function(){this._switch=!0,t.prototype.resume.call(this)},e.prototype.stop=function(){this.timesUp(),t.prototype.stop.call(this)},e.prototype.timesUp=function(){this._switch=!1,this._timer=0,this.finish()},e.prototype.paraParser=function(e){if(s.ParaParserUtility.ParaNumbers(this.ID,o.ParaType.Action,e.length,5)){if("linear"===e[0].toLowerCase()||"线性"===e[0])this._isLinear=!0;else{if("smooth"!==e[0].toLowerCase()&&"圆滑"!==e[0])return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 响应 传入参数格式错误，应为Log、Warn或者Error，当前为： "+e[0]+"，请检查填入数据！","",o.Severity.Error)),!1;this._isLinear=!1}var t=new s.VeryParas;if(!s.ParaParserUtility.Vector3OrNumberParaWithExpression(this.projectName,this.objectID,this.ID,o.ParaType.Action,t,e[1]))return!1;this._isVec1=t.isVec,this._vecFloat1=t.vecNumbers,this._vecUnit1=t.vector3;var r=new s.VeryParas;if(!s.ParaParserUtility.Vector3OrNumberParaWithExpression(this.projectName,this.objectID,this.ID,o.ParaType.Action,r,e[2]))return!1;this._isVec2=r.isVec,this._vecFloat2=r.vecNumbers,this._vecUnit2=r.vector3;var i=new s.VeryParas;if(!s.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,o.ParaType.Action,i,e[3]))return!1;this._timeFloat=i.number;var n=new s.VeryParas;return!!s.ParaParserUtility.Vector3Para(this.projectName,this.objectID,this.ID,o.ParaType.Action,n,e[4])&&(this._acceptVec=n.vector3,!0)}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_Vector3_Interpolate=p,a.VE_Actions.addAction(p)},{"../../action":7,"../../babylon":10,"../../enum":20,"../../global":40,"../../utility":85,"../../variables":92}],50:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../action"),s=e("../../enum"),o=e("../../utility"),u=e("../../variables"),l=e("../../babylon"),c=e("../../trigger"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._switch=new u.VeryBool,e._timerEvent=null,e._mutiple=new u.VeryBool,e._totalTime=new u.VeryNumber,e._timer=[],e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Timer|定时器"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_Timer"},enumerable:!0,configurable:!0}),e.prototype.active=function(){this._switch.value?this.timeSet():this._timer=[]},e.prototype.timeSet=function(){if(this._mutiple.value){var e=new h(this._totalTime.value,l.Time.time);this._timer.push(e)}else if(0==this._timer.length){e=new h(this._totalTime.value,l.Time.time);this._timer.push(e)}else this._timer[0].reset(this._totalTime.value,l.Time.time)},e.prototype.update=function(){if(0<this._timer.length)for(var e=0;e<this._timer.length;e++)this._timer[e].isTimesUp(l.Time.time)&&(this._timer.length>e&&(this._timer.splice(e,1),e--),this.timesUp())},e.prototype.timesUp=function(){null!==this._timerEvent&&(this._timerEvent(),this.finish())},e.prototype.paraParser=function(e){if(o.ParaParserUtility.ParaNumbers(this.ID,s.ParaType.Action,e.length,3,4)){var t=new o.VeryParas;if(!o.ParaParserUtility.BoolParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,t,e[0]))return!1;this._switch=t.bool;for(var r=e[1].split(/,|，/),i=0;i<r.length;i++)c.VE_CustomTriggerManager.ConnectCustomTrigger(this.projectName,this.objectID,r[i].trim(),this.setCallback);var n=new o.VeryParas;if(!o.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,n,e[2]))return!1;if(this._totalTime=n.number,3<e.length){var a=new o.VeryParas;if(!o.ParaParserUtility.BoolParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,a,e[3]))return!1;this._mutiple=a.bool}else this._mutiple.value=!0;return!0}return!1},e.prototype.setCallback=function(e){this._timerEvent=e},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_Timer=p;var h=function(){function e(e,t){e<0&&(e=0),this._totalTime=e,this._startTime=t,this._timeRecorder=0}return e.prototype.isTimesUp=function(e){return this._timeRecorder=e-this._startTime,this._timeRecorder>=this._totalTime},e.prototype.reset=function(e,t){e<0&&(e=0),this._totalTime=e,this._startTime=t,this._timeRecorder=0},e}();r.VeryTimeControl=h;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._waitTime=new u.VeryNumber,e._timer=0,e._switch=!1,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Wait|等待"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Action_Wait"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return s.ActionType.Animation},enumerable:!0,configurable:!0}),e.prototype.active=function(){0===this._waitTime.value?this.timesUp():(this._switch=!0,this._timer=0)},e.prototype.update=function(){this._switch&&(this._timer+=l.Time.deltaTime,this._timer>this._waitTime.value&&this.timesUp())},e.prototype.pause=function(){this._switch=!1,t.prototype.pause.call(this)},e.prototype.resume=function(){this._switch=!0,t.prototype.resume.call(this)},e.prototype.stop=function(){this.timesUp(),t.prototype.stop.call(this)},e.prototype.timesUp=function(){this._switch=!1,this._timer=0,this.finish()},e.prototype.paraParser=function(e){if(o.ParaParserUtility.ParaNumbers(this.ID,s.ParaType.Action,e.length,1)){var t=new o.VeryParas;return!!o.ParaParserUtility.NumberParaWithExpression(this.projectName,this.objectID,this.ID,s.ParaType.Action,t,e[0])&&(this._waitTime=t.number,!0)}return!1},e.prototype.destroy=function(){},e}(a.VE_ActionBehaviour);r.Action_Wait=_,a.VE_Actions.addAction(p),a.VE_Actions.addAction(_)},{"../../action":7,"../../babylon":10,"../../enum":20,"../../trigger":79,"../../utility":85,"../../variables":92}],51:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./action-transform")),i(e("./action-debug")),i(e("./action-vector3")),i(e("./action-template")),i(e("./action_time")),i(e("./action-math"))},{"./action-debug":45,"./action-math":46,"./action-template":47,"./action-transform":48,"./action-vector3":49,"./action_time":50}],52:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./trigger-input")),i(e("./trigger-system")),i(e("./trigger-collision"))},{"./trigger-collision":53,"./trigger-input":54,"./trigger-system":55}],53:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../trigger"),s=e("../../variables"),o=e("../../utility"),u=e("../../enum"),l=e("../../global"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._target=new s.VeryGameObject,e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"On_Mouse_Over|碰撞体鼠标经过"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_MouseOver"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;if(o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,0,1)){if(0<e.length){var r=new o.VeryParas;if(!o.ParaParserUtility.GameObjectPara(this.projectName,this.objectID,this.ID,u.ParaType.Trigger,r,e[0]))return!1;this._target=r.gameObject}else this._target.value=this.gameObject;return null===this._target.value?(l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，填写0、1、2或者left、right、middle或者左、右、中，请检查！","",u.Severity.Error)),!1):(null===this._target.value.transform.mesh||(this._target.value.transform.mesh.enablePointerMoveEvents=!0),this._observer=this.scene.onPointerObservable.add(function(e){e.type===BABYLON.PointerEventTypes.POINTERMOVE&&null!==e.pickInfo&&null!==e.pickInfo.pickedMesh&&t._target.value&&e.pickInfo.pickedMesh===t._target.value.transform.mesh&&t.sendEvent()}),!0)}return!1},e.prototype.destroy=function(){this._observer&&this._scene.onPointerObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_MouseOver=c,a.VE_Triggers.addTrigger(c)},{"../../enum":20,"../../global":40,"../../trigger":79,"../../utility":85,"../../variables":92}],54:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../index"),s=e("../../trigger"),o=e("../../utility"),u=e("../../enum"),l=e("../../global"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._mouseButtonIndex=0,e._downFlag=!1,e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Mouse_Down|鼠标按下"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_MouseDown"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;if(o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,1)){if("0"===e[0]||"left"===e[0].toLowerCase()||"左"===e[0])this._mouseButtonIndex=0;else if("1"===e[0]||"right"===e[0].toLowerCase()||"右"===e[0])this._mouseButtonIndex=2;else{if("2"!==e[0]&&"middle"!==e[0].toLowerCase()&&"中"!==e[0])return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，填写0、1、2或者left、right、middle或者左、右、中，请检查！","",u.Severity.Error)),!1;this._mouseButtonIndex=1}return this._observer=this._scene.onPointerObservable.add(function(e){e.type===BABYLON.PointerEventTypes.POINTERDOWN?t._downFlag||e.event.button!==t._mouseButtonIndex||(t._downFlag=!0,t.sendEvent()):e.type===BABYLON.PointerEventTypes.POINTERUP&&t._downFlag&&e.event.button===t._mouseButtonIndex&&(t._downFlag=!1)}),!0}return!1},e.prototype.destroy=function(){this._observer&&this._scene.onPointerObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_MouseDown=c;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._mouseButtonIndex=0,e._downFlag=!1,e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Mouse_Up|鼠标抬起"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_MouseUp"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;if(o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,1)){if("0"===e[0]||"left"===e[0].toLowerCase()||"左"===e[0])this._mouseButtonIndex=0;else if("1"===e[0]||"right"===e[0].toLowerCase()||"右"===e[0])this._mouseButtonIndex=2;else{if("2"!==e[0]&&"middle"!==e[0].toLowerCase()&&"中"!==e[0])return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，填写0、1、2或者left、right、middle或者左、右、中，请检查！","",u.Severity.Error)),!1;this._mouseButtonIndex=1}return this._observer=this._scene.onPointerObservable.add(function(e){e.type===BABYLON.PointerEventTypes.POINTERDOWN?t._downFlag||e.event.button!==t._mouseButtonIndex||(t._downFlag=!0):e.type===BABYLON.PointerEventTypes.POINTERUP&&t._downFlag&&e.event.button===t._mouseButtonIndex&&(t._downFlag=!1,t.sendEvent())}),!0}return!1},e.prototype.destroy=function(){this._observer&&this._scene.onPointerObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_MouseUp=p;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._mouseButtonIndex=0,e._mouseUpdate={},e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Mouse_Button|鼠标持续"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_MouseButton"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;if(o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,1)){if("0"===e[0]||"left"===e[0].toLowerCase()||"左"===e[0])this._mouseButtonIndex=0;else if("1"===e[0]||"right"===e[0].toLowerCase()||"右"===e[0])this._mouseButtonIndex=2;else{if("2"!==e[0]&&"middle"!==e[0].toLowerCase()&&"中"!==e[0])return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，填写0、1、2或者left、right、middle或者左、右、中，请检查！","",u.Severity.Error)),!1;this._mouseButtonIndex=1}return this._observer=this._scene.onPointerObservable.add(function(e){e.type===BABYLON.PointerEventTypes.POINTERDOWN?t._mouseUpdate[e.event.button]=!0:e.type===BABYLON.PointerEventTypes.POINTERUP&&(t._mouseUpdate[e.event.button]=!1)}),!0}return!1},e.prototype.onUpdate=function(){this._mouseUpdate[this._mouseButtonIndex]&&this.sendEvent()},e.prototype.destroy=function(){this._observer&&this._scene.onPointerObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_MouseButton=h;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._keyboard="",e._keyUpdate={},e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"键盘持续|Key_Button"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_Keyboard"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;return!!o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,1)&&(this._keyboard=o.VE_KeyboardMap.GetKey(e[0]).toLowerCase(),"null"===this._keyboard?(l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，无法查找到该按钮，请查阅键盘字符串对应表！","",u.Severity.Error)),!1):(this._observer=this.scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN?t._keyUpdate[e.event.key.toLowerCase()]=!0:t._keyUpdate[e.event.key.toLowerCase()]=!1}),!0))},e.prototype.onUpdate=function(){this._keyUpdate[this._keyboard]&&this.sendEvent()},e.prototype.destroy=function(){this._observer&&this._scene.onKeyboardObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_Keyboard=_;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._keyboard="",e._downFlag=!1,e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"键盘按下|Key_Down"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_KeyDown"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;return!!o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,1)&&(this._keyboard=o.VE_KeyboardMap.GetKey(e[0]).toLowerCase(),"null"===this._keyboard?(l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，无法查找到该按钮，请查阅键盘字符串对应表！","",u.Severity.Error)),!1):(this._observer=this.scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN?t._downFlag||e.event.key.toLowerCase()!==t._keyboard||(t._downFlag=!0,t.sendEvent()):t._downFlag&&e.event.key.toLowerCase()===t._keyboard&&(t._downFlag=!1)}),!0))},e.prototype.destroy=function(){this._observer&&this._scene.onKeyboardObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_KeyDown=f;var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._keyboard="",e._downFlag=!1,e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"键盘抬起|Key_Up"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_KeyUp"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;return!!o.ParaParserUtility.ParaNumbers(this.ID,u.ParaType.Trigger,e.length,1)&&(this._keyboard=o.VE_KeyboardMap.GetKey(e[0]).toLowerCase(),"null"===this._keyboard?(l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[0]+"，无法查找到该按钮，请查阅键盘字符串对应表！","",u.Severity.Error)),!1):(this._observer=this.scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN?t._downFlag||e.event.key.toLowerCase()!==t._keyboard||(t._downFlag=!0):t._downFlag&&e.event.key.toLowerCase()===t._keyboard&&(t._downFlag=!1,t.sendEvent())}),!0))},e.prototype.destroy=function(){this._observer&&this._scene.onKeyboardObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_KeyUp=g;var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._keyboards=[],e._lastKey="",e._downFlag=!1,e._trigger=!1,e._keyUpdate={},e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Key_Combination|键盘组合"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_KeyboardCombine"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;if(e.length<2)return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数至少为2个，请检查传入参数！","",u.Severity.Error)),!1;for(var r=0;r<e.length;r++){var i=o.VE_KeyboardMap.GetKey(e[r]).toLowerCase();if("null"===i)return l.VE_ErrorManager.Add(new l.VE_Error("",this.ID+" 触发 传入参数格式错误："+e[r]+"，无法查找到该按钮，请查阅键盘字符串对应表！","",u.Severity.Error)),!1;this._keyboards.push(i)}return this._lastKey=this._keyboards[this._keyboards.length-1],this._observer=this.scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN?(t._downFlag||t._lastKey!==e.event.key.toLowerCase()||(t._downFlag=!0,t._trigger=!0),t._keyUpdate[e.event.key.toLowerCase()]=!0):(t._downFlag&&t._lastKey===e.event.key.toLowerCase()&&(t._downFlag=!1,t._trigger=!1),t._keyUpdate[e.event.key.toLowerCase()]=!1)}),!0},e.prototype.onUpdate=function(){if(this._keyboards&&0<this._keyboards.length)for(var e=!0,t=0;t<this._keyboards.length;t++)t===this._keyboards.length-1?e&&this._downFlag&&this._trigger&&(this._trigger=!1,this.sendEvent()):this._keyUpdate[this._keyboards[t]]||(e=!1)},e.prototype.destroy=function(){this._observer&&this._scene.onKeyboardObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_KeyboardCombine=y,s.VE_Triggers.addTrigger(c),s.VE_Triggers.addTrigger(p),s.VE_Triggers.addTrigger(h),s.VE_Triggers.addTrigger(_),s.VE_Triggers.addTrigger(f),s.VE_Triggers.addTrigger(g),s.VE_Triggers.addTrigger(y)},{"../../enum":20,"../../global":40,"../../index":44,"../../trigger":79,"../../utility":85}],55:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("../../trigger"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Start|开始"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_Start"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;return this._observer=this.scene.onBeforeRenderObservable.add(function(){t.sendEvent(),t.destroy()}),!0},e.prototype.destroy=function(){this._observer&&this.scene.onBeforeRenderObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_Start=s;var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._observer=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return"Continuous|连续"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"Trigger_Continuous"},enumerable:!0,configurable:!0}),e.prototype.paraParser=function(e){var t=this;return this._observer=this.scene.onBeforeRenderObservable.add(function(){t.sendEvent()}),!0},e.prototype.destroy=function(){this._observer&&this.scene.onBeforeRenderObservable.remove(this._observer),this._observer=null},e}(a.VE_TriggerBehaviour);r.Trigger_Continuous=o;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"ID",{get:function(){return"自定义|Custom"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"Trigger_Custom"},enumerable:!0,configurable:!0}),t.prototype.customEvent=function(){this.sendEvent()},t.prototype.paraParser=function(e){return!0},t.prototype.destroy=function(){},t}(a.VE_TriggerBehaviour);r.Trigger_Custom=u,a.VE_Triggers.addTrigger(s),a.VE_Triggers.addTrigger(o),a.VE_Triggers.addTrigger(u)},{"../../trigger":79}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var ee=e("../manager"),te=e("../variables"),re=e("../utility"),ie=e("../global"),ne=e("../expression"),ae=e("../state"),se=e("../trigger"),oe=e("../action"),ue=e("../enum"),A=e("../action/assignmentTypeJudge"),O=e("../scene"),i=function(){function e(){}return e.createProject=function(e){for(var t=ee.VE_Manager.templates(e),r=ee.VE_Manager.objects(e),i=ee.VE_Manager.variables(e),n=0;n<i.varData.count;n++){var a=i.varData.getVariableID(n);if("公式"!==(g=i.varData.getVariableParas(a))[0]&&"expression"!==g[0].toLowerCase())if(te.VeryVarManager.hasVarType(g[0])){var s=new re.ErrorInfo,o=te.VeryVarManager.createVariable(a,g[0],g[1],s);if(!s.isRight||null===o)return ie.VE_ErrorManager.Add(ie.VE_Error.error(i.varData.getPos(a),"项目："+e+"，全局变量："+a+"，"+g[0]+"，"+g[1]+"，全局变量创建失败，失败原因："+s.message+"，请检查！","")),!1;i.addVariable(a,o)}else{if(!t.isCreatedTemplate(g[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(i.varData.getPos(a),"项目："+e+"，全局变量："+a+"，"+g[0]+"，"+g[1]+"，全局变量创建失败，当前变量不存在，请检查！","")),!1;i.addTemplate(a,t.getTemplate(g[0]).clone("__global__",a))}}for(n=0;n<i.varData.count;n++){a=i.varData.getVariableID(n);if("公式"===(g=i.varData.getVariableParas(a))[0]||"expression"===g[0].toLowerCase()){s=new re.ErrorInfo;var u=ne.VE_Expressions.createGlobalExpression(a,g[1],e,s);if(!s.isRight||null===u)return ie.VE_ErrorManager.Add(ie.VE_Error.error(i.varData.getPos(a),"项目："+e+"，全局变量："+a+","+g[0]+","+g[1]+"，全局变量创建失败，公式创建错误：\n"+s.message,"")),!1;i.addExpression(a,u)}}for(n=0;n<r.count;n++)for(var l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.varData.count;p++){a=c.varData.getVariableID(p);if("公式"!==(g=c.varData.getVariableParas(a))[0]&&"expression"!==g[0].toLowerCase().trim())if(te.VeryVarManager.hasVarType(g[0])){s=new re.ErrorInfo;if(null===(o=te.VeryVarManager.createVariable(a,g[0],g[1],s))||!s.isRight)return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.varData.getPos(a),"项目："+e+"，全局变量："+a+"，"+g[0]+"，"+g[1]+"，全局变量创建失败，失败原因："+s.message+"，请检查！","")),!1;i.addVariable(a,o)}else{if(!t.isCreatedTemplate(g[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.varData.getPos(a),"项目："+e+"，对象："+l+"，局部变量："+a+","+g[0]+","+g[1]+"，局部变量创建失败，当前变量不存在，请检查！","")),!1;c.addTemplate(a,t.getTemplate(g[0]).clone(l,a))}}for(n=0;n<r.count;n++)for(l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.dataSource.fsmCount;p++){var h=c.dataSource.getFsmID(p),_=c.dataSource.getFsmData(h);(o=new te.VeryString).setValue(_.initialValStr);var f=new ae.VE_Fsm(e,l,h,o,c);c.addFsm(h,f)}for(n=0;n<r.count;n++)for(l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.varData.count;p++){var g;a=c.varData.getVariableID(p);if("公式"===(g=c.varData.getVariableParas(a))[0]||"expression"===g[0].toLowerCase().trim()){s=new re.ErrorInfo,o=ne.VE_Expressions.createLocalExpression(a,g[1],e,l,s);if(!s.isRight||null===o)return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.varData.getPos(a),"项目："+e+"，对象："+l+"，局部变量："+a+","+g[0]+","+g[1]+"，局部变量创建失败，公式创建错误：\n"+s.message,"")),!1;c.addExpression(a,o)}}for(n=0;n<r.count;n++)for(l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.dataSource.triggerCount;p++){var y=c.dataSource.getTriggerID(p),m=c.dataSource.getTriggerPara(y);if(!se.VE_Triggers.hasTrigger(m[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.dataSource.getTriggerPos(y),"项目："+e+"，对象："+l+"，触发："+y+"，触发类型："+m[0]+"，当前系统中不存在该触发类型，请检查！","")),!1;s=new re.ErrorInfo;var d=se.VE_Triggers.createTrigger(c,y,m[0],m.slice(1),s);if(!s.isRight||null===d)return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.dataSource.getTriggerPos(y),"项目："+e+"，对象："+l+"，触发："+y+"，触发创建错误，原因："+s.message+"，请检查！","")),!1;c.addTrigger(y,d)}for(n=0;n<r.count;n++)for(l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.dataSource.actionCount;p++){var b=c.dataSource.getActionID(p),E=c.dataSource.getActionPara(b);if(!oe.VE_Actions.hasAction(E[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.dataSource.getActionPos(b),"项目："+e+"，对象："+l+"，响应："+b+"，响应类型："+E[0]+"，当前系统中不存在该响应类型，请检查！","")),!1;s=new re.ErrorInfo;var v=oe.VE_Actions.createAction(c,b,E[0],E.slice(1),c.dataSource.getActionInitVal(b),s);if(!s.isRight||null===v)return ie.VE_ErrorManager.Add(ie.VE_Error.error(c.dataSource.getActionPos(b),"项目："+e+"，对象："+l+"，响应："+b+"，响应创建错误，原因："+s.message+"，请检查！","")),!1;c.addAction(b,v)}for(n=0;n<r.count;n++)for(l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.dataSource.fsmCount;p++){h=c.dataSource.getFsmID(p),_=c.dataSource.getFsmData(h),f=c.getFsm(h);for(var V=0;V<_.count;V++){var T=_.getStateData(V);if(f.hasStateValue(T.ValStr))return ie.VE_ErrorManager.Add(ie.VE_Error.error("（"+T.rowIndex+"，F）","项目："+e+"，对象："+l+"，状态："+h+"，当前状态值重复，同一个状态的值不允许重复，请检查！","")),!1;if((k=new ae.VE_State(f,f.count+1)).setConstValue(T.ValStr),T.isSequence&&k.setSequence(),""!==T.logicalExp){s=new re.ErrorInfo;var S=ne.VE_Expressions.createFsmExpression("",T.logicalExp,e,l,h,s);if(!s.isRight||null===S)return ie.VE_ErrorManager.Add(ie.VE_Error.error("（"+T.rowIndex.toString()+"，E）","项目："+e+"，对象："+l+"，状态："+h+"，状态逻辑表达式："+T.logicalExp+"，逻辑表达式创建失败，公式创建错误：\n"+s.message,"")),!1;k.logicalAssociated=S}for(var A=0;A<T.triggerCount;A++){var O=T.getTrigger(A),P=T.getTriggerPos(A);if(null===(d=se.VE_Triggers.findTrigger(c,O.triggerID)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(P,"项目："+e+"，对象："+l+"，状态："+h+"，触发："+O.triggerID+"，当前触发无法在系统中查找到，请检查！","")),!1;S=null;if(""!==O.logicalExp){s=new re.ErrorInfo;if(S=ne.VE_Expressions.createFsmExpression("",O.logicalExp,e,l,h,s),!s.isRight||null===S)return ie.VE_ErrorManager.Add(ie.VE_Error.error(P,"项目："+e+"，对象："+l+"，状态："+h+"，状态逻辑表达式："+O.logicalExp+"，逻辑表达式创建失败，公式创建错误：\n"+s.message,"")),!1}if(d.addTriggerTarget(S,k),""!==O.logicalSwitch){s=new re.ErrorInfo;var D=ne.VE_Expressions.createFsmExpression("",O.logicalSwitch,e,l,h,s);if(!s.isRight||null===D)return ie.VE_ErrorManager.Add(ie.VE_Error.error(P,"项目："+e+"，对象："+l+"，状态："+h+"，触发启动条件："+O.logicalSwitch+"，触发启动条件创建失败，公式创建错误：\n"+s.message,"")),!1;d.addLogicalSwitch(D)}}for(A=0;A<T.actionCount;A++){var x=T.getAction(A),I=T.getActionPos(A);if(x.type===ue.StateActionType.Action){if(null===(v=oe.VE_Actions.findAction(c,x.actionID)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，当前响应无法在系统中查找到，请检查！","")),!1;s=new re.ErrorInfo;var j=null,C=x.enabled.trim().toLowerCase();if("false"===C||"停止"===C)(j=new te.VeryBool).setValue(!1);else if("true"===C||"启动"===C)(j=new te.VeryBool).setValue(!0);else{if(!(-1<x.enabled.indexOf(ae.StateConst.VARIABLE_SYMBOL)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.enabled+"，响应启动参数允许填写格式为：“启动/true”、“停止/false”、“*变量名”、“对象名.*变量名”，且变量不能为模板变量，且变量返回值必须为bool值，当前参数不符合，请检查！","")),!1;if(s.clear(),j=te.VarTools.GetVeryVarWithExpression(e,l,x.enabled,s),!s.isRight||null===j)return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.enabled+"，响应启动参数格式不正确，错误信息："+s.message,"")),!1;if("bool"!==j.varType)return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.enabled+"，响应启动参数变量必须返回bool值类型，当前变量类型："+j.varType,"")),!1}var w=null,M=x.everyFrame.trim().toLowerCase();if("false"===M||"一次"===M)(w=new te.VeryBool).setValue(!1);else if("true"===M||"持续"===M)(w=new te.VeryBool).setValue(!0);else{if(!(-1<x.everyFrame.indexOf(ae.StateConst.VARIABLE_SYMBOL)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.everyFrame+"，响应帧循环参数允许填写格式为：“持续/true”、“一次/false”、“*变量名”、“对象名.*变量名”，且变量不能为模板变量，且变量返回值必须为bool值，当前参数不符合，请检查！","")),!1;if(s.clear(),w=te.VarTools.GetVeryVarWithExpression(e,l,x.everyFrame,s),!s.isRight||null===w)return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.everyFrame+"，响应帧循环参数格式不正确，错误信息："+s.message,"")),!1;if("bool"!==w.varType)return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.everyFrame+"，响应帧循环参数变量必须返回bool值类型，当前变量类型："+w.varType,"")),!1}var N=x.isSequence.trim().toLowerCase(),L=!1;if("false"===N||"同时"===N)L=!1;else{if("true"!==N&&"依次"!==N)return ie.VE_ErrorManager.Add(ie.VE_Error.error(I,"项目："+e+"，对象："+l+"，状态："+h+"，响应："+x.actionID+"，参数："+x.isSequence+"，响应依次运行状态允许填写格式为：“同时/false”、“依次/true”，不允许填写变量，请检查！","")),!1;L=!0}var F=new ae.VE_StateAction;F.setAction(v,j,w,L),k.addAction(F)}else if(!this.assignmentAction(e,l,h,i,r,c,x,k))return!1}f.addState(k)}}for(n=0;n<r.count;n++)for(l=r.getObjectID(n),c=r.getVeryObject(l),p=0;p<c.dataSource.fsmCount;p++)for(h=c.dataSource.getFsmID(p),_=c.dataSource.getFsmData(h),f=c.getFsm(h),V=0;V<_.count;V++){T=_.getStateData(V);var k=f.getStateInSequence(V);for(A=0;A<T.associatedStateCount;A++){for(var R=T.getAssociatedState(A),B=T.getAssociatedStatePos(A),W=new ae.VE_AssociatedState(k),z=R.split(/,|，/),G=0;G<z.length;G++){R=z[G].trim();var U=ae.StateConst.STATE_VALUE,Y=R.split("=");if(1===Y.length);else{if(2!==Y.length)return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态格式错误，应为“状态名 = 状态值”的形式，请检查！","")),!1;U=Y[1].trim()}var q=Y[0].trim();if(-1<q.indexOf(ae.StateConst.STATE_SEPARATOR)){for(var K=q.split(ae.StateConst.STATE_SEPARATOR),Z=0;Z<K.length;Z++)K[Z]=K[Z].trim();if(3===K.length){if(!r.isCreated(K[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.*模板变量.状态名”，无法查找到该对象，请检查！","")),!1;var Q=r.getVeryObject(K[0]);if(!K[1].startsWith(ae.StateConst.VARIABLE_SYMBOL))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.*模板变量.状态名”，模板变量填写格式不正确，请检查！","")),!1;a=K[1].substring(1);if(!Q.isCreatedTemplate(a))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.*模板变量.状态名”，在当前对象中无法查找到该模板变量，请检查！","")),!1;if(!(X=Q.getTemplate(a)).dataSource.isCreatedFsm(K[2]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.*模板变量.状态名”，在当前对象的该模板变量中无法查找到对应状态名，请检查！","")),!1;W.addTemplate(X,K[2],U,B)}else{if(2!==K.length)return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，状态名填写错误，无法查找到对应状态，请检查！","")),!1;var J=K[0].trim();if(q=K[1].trim(),J.startsWith(ae.StateConst.VARIABLE_SYMBOL))if(J=J.substring(1),c.isCreatedTemplate(J)){if(!(X=c.getTemplate(J)).dataSource.isCreatedFsm(K[1]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“*模板变量.状态名”，在当前模板变量中无法查找到对应状态名，请检查！","")),!1;W.addTemplate(X,K[1],U,B)}else{if(!i.isCreatedTemplate(J))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“*模板变量.状态名”，在当前系统中无法查找到该模板变量，请检查！","")),!1;var X;if(!(X=i.getTemplate(J)).dataSource.isCreatedFsm(K[1]))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“*模板变量.状态名”，在当前模板变量中无法查找到对应状态名，请检查！","")),!1;W.addTemplate(X,K[1],U,B)}else{if(null===(Q=r.getVeryObject(J)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.状态名”，当前系统中无法查找到该对象名，请检查！","")),!1;if(null===(H=Q.getFsm(q)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.状态名”，当前对象名所对应的对象中无法查找到该状态名，请检查！","")),!1;if(null===($=H.getState(U)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，当前关联状态填写格式为“对象名.状态名”，当前关联状态序号超出对应状态序号范围，请检查！","")),!1;W.add($,U,B)}}}else{var H,$;if(null===(H=c.getFsm(q)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，状态名填写错误，可以查找到对象，但是对象上无法查找到该状态，请检查！","")),!1;if(null===($=H.getState(U)))return ie.VE_ErrorManager.Add(ie.VE_Error.error(B,"项目："+e+"，对象："+l+"，状态："+h+"，关联状态："+R+"，状态名填写错误，可以查找到对象和状态，但是状态序号超出范围，请检查！","")),!1;W.add($,U,B)}}k.addAssociatedState(W)}}return!0},e.assignmentAction=function(e,t,r,i,n,a,s,o){var u=new oe.VE_Assignment(o,s.totalString),l=s.varID;if(!(-1<l.indexOf(ae.StateConst.VARIABLE_SYMBOL)))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左边必须为变量，请检查！","")),!1;if(-1<l.indexOf(ae.StateConst.STATE_SEPARATOR)){for(var c=l.split(ae.StateConst.STATE_SEPARATOR),p=0;p<c.length;p++)c[p]=c[p].trim();if(2===c.length)if(c[0].startsWith(ae.StateConst.VARIABLE_SYMBOL)){var h=c[0].substring(1);if(l=c[1].substring(1),a.isCreatedTemplate(h)){if((y=a.getTemplate(h)).varData.isCreatedVariable(l)){if("expression"===(_=y.varData.getVariableParas(l))[1].toLowerCase()||"公式"===_[1].toLowerCase())return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*模板变量.*变量”，该变量不能为“公式”，请检查！","")),!1;u.setLeftTemplateVar(y,l)}else{if(!y.dataSource.isCreatedFsm(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，请检查！","")),!1;u.setLeftTemplateVar(y,l)}}else{if(!i.isCreatedTemplate(h))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*模板变量.*变量”，当前“*模板变量”无法在系统中查找到，请检查！","")),!1;if((y=i.getTemplate(h)).varData.isCreatedVariable(l)){var _;if("expression"===(_=y.varData.getVariableParas(l))[1].toLowerCase()||"公式"===_[1].toLowerCase())return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*模板变量.*变量”，该变量不能为“公式”，请检查！","")),!1;u.setLeftTemplateVar(y,l)}else{if(!y.dataSource.isCreatedFsm(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，请检查！","")),!1;u.setLeftTemplateVar(y,l)}}}else{if(!n.isCreated(c[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式“对象名.*变量”，当前“对象名”无法在系统中查找到，请检查！","")),!1;var f=n.getVeryObject(c[0]);if(l=l.substring(1),f.isCreatedExpression(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“对象名.*变量”，该变量不能为“公式”，请检查！","")),!1;if(f.isCreatedFsm(l)){var g=f.getFsm(l).fsmVar;u.setLeftVariable(g)}else if(f.isCreatedVariable(l)){g=f.getVariable(l);u.setLeftVariable(g)}else{if(!f.isCreatedTemplate(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“对象名.*变量”，无法在当前对象名中查找到该变量，请检查！","")),!1;var y=f.getTemplate(l);u.setLeftTemplate(y)}}else{if(3!==c.length)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，请检查！","")),!1;if(c[0].startsWith(ae.StateConst.STATE_SEPARATOR)||!c[1].startsWith(ae.StateConst.STATE_SEPARATOR)||!c[2].startsWith(ae.StateConst.STATE_SEPARATOR))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，请检查！","")),!1;h=c[1].substring(1);if(l=c[2].substring(1),!n.isCreated(c[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名”无法在系统中查找到，请检查！","")),!1;if(!(V=n.getVeryObject(c[0])).isCreatedTemplate(h))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名”的对象中无法查找到该“*模板变量”，请检查！","")),!1;if((y=V.getTemplate(h)).dataSource.isCreatedFsm(l))u.setLeftTemplateVar(y,l);else{if(!y.varData.isCreatedVariable(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名.*模板变量”可以查找到，但是无法查到对应“*变量”，请检查！","")),!1;var m=y.varData.getVariableParas(l);if("expression"===m[1].toLowerCase()||"公式"===m[1].toLowerCase())return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名.*模板变量.*变量”为公式变量，公式变量不可直接赋值，请检查！","")),!1;u.setLeftTemplateVar(y,l)}}}else{if(l=l.substring(1),a.isCreatedExpression(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*变量”，该变量不能为“公式”，请检查！","")),!1;if(a.isCreatedFsm(l)){g=a.getFsm(l).fsmVar;u.setLeftVariable(g)}else if(a.isCreatedVariable(l)){g=a.getVariable(l);u.setLeftVariable(g)}else if(a.isCreatedTemplate(l)){y=a.getTemplate(l);u.setLeftTemplate(y)}else{if(i.isCreatedExpression(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*变量”，该变量不能为“公式”，请检查！","")),!1;if(i.isCreatedVariable(l)){g=i.getVariable(l);u.setLeftVariable(g)}else{if(!i.isCreatedTemplate(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧格式“*变量”，无法在当前系统中查找到该变量，请检查！","")),!1;y=i.getTemplate(l);u.setLeftTemplate(y)}}}if((l=s.varValue.trim()).startsWith('"')||l.startsWith("'")||l.startsWith("“")||l.startsWith("‘"))u.setRightConst(l.substring(1,l.length-2).trim());else if(re.VE_StringFormat.isFormulaString(l)){var d=new re.ErrorInfo;ae.StateConst.AssignmentFormulaCount++;var b=ne.VE_Expressions.createLocalExpression(ae.StateConst.AssignmentPrefix+ae.StateConst.AssignmentFormulaCount.toString(),l,e,t,d);if(!d.isRight||null===b)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧格式“公式”，公式解析错误，请检查！错误信息："+d.message,"")),!1;u.setRightVariable(new te.VeryExpression(b))}else if(-1<l.indexOf(ae.StateConst.VARIABLE_SYMBOL))if(-1<l.indexOf(ae.StateConst.STATE_SEPARATOR)){for(c=l.split(ae.StateConst.STATE_SEPARATOR),p=0;p<c.length;p++)c[p]=c[p].trim();if(2===c.length)if(c[0].startsWith(ae.StateConst.VARIABLE_SYMBOL)){h=c[0].substring(1);if(l=c[1].substring(1),a.isCreatedTemplate(h)){if(!(y=a.getTemplate(h)).varData.isCreatedVariable(l)&&!y.dataSource.isCreatedFsm(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，请检查！","")),!1;u.setRightTemplateVariable(y,l)}else{if(!i.isCreatedTemplate(h))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧格式“*模板变量.*变量”，当前“*模板变量”无法在系统中查找到，请检查！","")),!1;if(!(y=i.getTemplate(h)).varData.isCreatedVariable(l)&&!y.dataSource.isCreatedFsm(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，请检查！","")),!1;u.setRightTemplateVariable(y,l)}}else{if(!n.isCreated(c[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号右侧变量格式“对象名.*变量”，当前“对象名”无法在系统中查找到，请检查！","")),!1;f=n.getVeryObject(c[0]);l=l.substring(1);var E=null,v=null;if(f.isCreatedExpression(l))E=new te.VeryExpression(f.getExpression(l));else if(f.isCreatedFsm(l))E=f.getFsm(l).fsmVar;else if(f.isCreatedVariable(l))E=f.getVariable(l);else{if(!f.isCreatedTemplate(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧格式“对象名.*变量”，无法在当前系统中查找到该变量，请检查！","")),!1;v=f.getTemplate(l)}if(null!==E){if(u.leftType===ue.AssignType.Template)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧为“模板变量”类型，右侧为“普通变量”类型，无法赋值，请检查！","")),!1;if(u.leftType===ue.AssignType.Variable){if(!A.VE_AssignmentTypeJudge.allow(u.leftVariable,E))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧和右侧类型不匹配，无法赋值，请检查！","")),!1;u.setRightVariable(E)}else u.setRightVariable(E)}else{if(null==v)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧数据无法识别，请检查！","")),!1;if(u.leftType!==ue.AssignType.Template)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧为“模板变量”，右侧为“普通变量”，无法赋值，请检查！","")),!1;u.setRightTemplate(v)}}else{if(3!==c.length)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号右侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，请检查！","")),!1;if(c[0].startsWith(ae.StateConst.STATE_SEPARATOR)||!c[1].startsWith(ae.StateConst.STATE_SEPARATOR)||!c[2].startsWith(ae.StateConst.STATE_SEPARATOR))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号右侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，请检查！","")),!1;var V;h=c[1].substring(1);if(l=c[2].substring(1),!n.isCreated(c[0]))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号右侧变量格式“对象名.*模板变量.*变量”，当前“对象名”无法在系统中查找到，请检查！","")),!1;if(!(V=n.getVeryObject(c[0])).isCreatedTemplate(h))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号右侧变量格式“对象名.*模板变量.*变量”，当前“对象名”的对象中无法查找到该“*模板变量”，请检查！","")),!1;if(!(y=V.getTemplate(h)).dataSource.isCreatedFsm(l)&&!y.varData.isCreatedVariable(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，赋值响应等号右侧变量格式“对象名.*模板变量.*变量”，当前“对象名.*模板变量”可以查找到，但是无法查到对应“*变量”，请检查！","")),!1;u.setRightTemplateVariable(y,l)}}else{l=l.substring(1);E=null,v=null;if(a.isCreatedExpression(l))E=new te.VeryExpression(a.getExpression(l));else if(a.isCreatedFsm(l))E=a.getFsm(l).fsmVar;else if(a.isCreatedVariable(l))E=a.getVariable(l);else if(a.isCreatedTemplate(l))v=a.getTemplate(l);else if(i.isCreatedExpression(l))E=new te.VeryExpression(i.getExpression(l));else if(i.isCreatedVariable(l))E=i.getVariable(l);else if(i.isCreatedTemplate(l))v=i.getTemplate(l);else if(O.VerySceneVariables.Variables.isCreatedExpression(l))E=new te.VeryExpression(O.VerySceneVariables.Variables.getExpression(l));else{if(!O.VerySceneVariables.Variables.isCreatedVariable(l))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧格式“*变量”，无法在当前系统中查找到该变量，请检查！","")),!1;E=O.VerySceneVariables.Variables.getVariable(l)}if(null!=E){if(u.leftType===ue.AssignType.Template)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧为“模板变量”类型，右侧为“普通变量”类型，无法赋值，请检查！","")),!1;if(u.leftType===ue.AssignType.Variable){if(!A.VE_AssignmentTypeJudge.allow(u.leftVariable,E))return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧和右侧类型不匹配，无法赋值，请检查！","")),!1;u.setRightVariable(E)}else u.setRightVariable(E)}else{if(null==v)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号右侧数据无法识别，请检查！","")),!1;if(u.leftType!==ue.AssignType.Template)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧为“模板变量”，右侧为“普通变量”，无法赋值，请检查！","")),!1;u.setRightTemplate(v)}}else if(u.leftType===ue.AssignType.Template){if("null"!==l.trim().toLowerCase())return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧为模板变量，右侧赋值为常量时只能填“null”，表示销毁模板变量，当前格式错误，请检查！","")),!1;u.setRightNull()}else if(u.leftType===ue.AssignType.TemplateVariable)u.setRightConst(l);else{if(null===u.leftVariable)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧变量获取为空，请检查！","")),!1;d=new re.ErrorInfo;var T=u.leftVariable.initValue(l,d);if(!d.isRight||null===T)return ie.VE_ErrorManager.Add(ie.VE_Error.error("","项目："+e+"，对象："+t+"，状态："+r+"，赋值响应："+s.totalString+"，当前赋值响应等号左侧变量类型与右侧常量值不匹配，错误信息："+d.message+"，请检查！","")),!1;u.setRightConstValue(T)}var S=new ae.VE_StateAction;return S.setAssignment(u),o.addAction(S),!0},e.createInstance=function(e,t,r,i,n,a,s){return i},e}();r.CreateInstance=i},{"../action":7,"../action/assignmentTypeJudge":6,"../enum":20,"../expression":29,"../global":40,"../manager":59,"../scene":66,"../state":70,"../trigger":79,"../utility":85,"../variables":92}],57:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./loaderManager")),i(e("./createInstance"))},{"./createInstance":56,"./loaderManager":58}],58:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var C,i,w=e("../template"),M=e("../object"),N=e("../dataSource"),L=e("../manager"),F=e("../utility"),k=e("../global"),R=e("../state"),B=e("./createInstance"),W=e("../babylon");(i=C=r.AnalisysType||(r.AnalisysType={}))[i.Global=0]="Global",i[i.Object=1]="Object",i[i.Template=2]="Template";var n=function(){function e(){this._currentType=C.Global,this._projectName="",this._lastFsmID="",this._lastObjectID="",this._activeTemplate=null,this._activeObject=null,this._activeFsmData=null,this._activeStateData=null,this._emptyLine=!1}return e.prototype.load=function(e,t){this._projectName=e,this._table=t,L.VE_Manager.createProject(e);var r=L.VE_Manager.templates(e),i=L.VE_Manager.objects(e),n=L.VE_Manager.variables(e);if(t){for(var a=1;a<t.RowCount;a++)if(!t.getData(a,0).startsWith("//"))if(t.getRow(a).isEmpty())this._emptyLine=!0;else if(t.getData(a,0).startsWith("模板_")){this._activeFsmData=null,this._activeStateData=null,this._currentType=C.Template;var s=t.getData(a,0).replace(/ /g,"").substring(3);if(-1<s.indexOf(":")||-1<s.indexOf("："));else{if(!F.VE_StringFormat.isIDLegal(s))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,0),"模板对象名："+t.getData(a,0)+"，当前模板对象名不合法，包含非法字符，请检查！",t.ID)),!1;if(r.isCreatedTemplate(s))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,0),"模板对象名："+t.getData(a,0)+"，当前模板已创建，请勿使用重复的模板对象名！",t.ID)),!1;this._lastObjectID=s,this._emptyLine=!0;var o=new w.VE_Template(e,s);r.addTemplate(s,o),this._activeTemplate=o}}else if(""!==t.getData(a,0)){this._activeFsmData=null,this._activeStateData=null,this._currentType=C.Object;var u=t.getData(a,0),l="";if(-1<u.indexOf("=")){var c=u.split("=");if(2!==c.length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,0),"对象名："+t.getData(a,0)+"，当前对象名格式错误，应为“对象名”或者“对象名=场景物体名”的形式，请检查！",t.ID)),!1;u=c[0].trim(),l=c[1].trim()}if(!F.VE_StringFormat.isIDLegal(u))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,0),"对象名："+t.getData(a,0)+"，当前对象名不合法，包含非法字符，请检查！",t.ID)),!1;var p=null;if(""===l)p=new W.GameObject("__"+u+"_Empty");else if(null===(p=W.GameObject.Find(l)))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,0),"对象名："+l+"，当前对象在场景中不存在，请检查！",t.ID)),!1;if(this._lastObjectID=u,this._emptyLine=!0,i.isCreated(u))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,0),"对象名："+t.getData(a,0)+"，当前对象已创建，请勿使用重复的对象名！",t.ID)),!1;var h=new M.VeryEngineObject(e,u,p);i.add(u,h),this._activeObject=h}else if(""!==t.getData(a,5)&&""===t.getData(a,1)&&""===t.getData(a,2)&&""===t.getData(a,3)&&""===t.getData(a,4)&&""===t.getData(a,6)&&""===t.getData(a,7)&&""===t.getData(a,8)){var _=t.getData(a,5);if(this._currentType===C.Global){if(this._emptyLine=!0,2!==(E=F.VE_StringFormat.paraSegment(_)).length&&3!==E.length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"全局变量："+t.getData(a,5)+"，当前全局变量格式不正确，请检查！",t.ID)),!1;var f=E[0].trim();if(!F.VE_StringFormat.isIDLegal(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"全局变量："+t.getData(a,5)+"，当前变量名不合法，包含非法字符，请检查！",t.ID)),!1;var g=[E[1].trim()];if(2===E.length?g[1]="":g[1]=E[2].trim(),n.varData.isCreatedVariable(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"全局变量："+t.getData(a,5)+"，当前全局变量名已创建，请检查！",t.ID)),!1;n.varData.addVariable(f,g,t.pos(a,5))}else if(-1<_.indexOf("=")){if(2===(g=_.split("=")).length&&g[0].trim()===this._lastFsmID){if(this._emptyLine=!1,null===this._activeFsmData)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"状态赋值："+t.getData(a,5)+"，当前状态不属于任何对象和模板对象，请检查！",t.ID)),!1;(v=new N.VE_StateData(this._activeFsmData,g[1].trim(),!1)).rowIndex=a,this._activeFsmData.addState(v),this._activeStateData=v}else{if(this._emptyLine=!0,3!==(E=F.VE_StringFormat.paraSegment(_)).length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"局部公式变量："+t.getData(a,5)+"，当前局部公式变量格式不正确，请检查！",t.ID)),!1;f=E[0].trim();if(!F.VE_StringFormat.isIDLegal(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"变量："+t.getData(a,5)+"，当前变量名不合法，包含非法字符，请检查！",t.ID)),!1;var y=[E[1].trim(),E[2].trim()];if(this._currentType===C.Object){if(this._activeObject.varData.isCreatedVariable(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"对象名："+this._activeObject.objectID+"，局部变量："+t.getData(a,5)+"，当前局部变量名已创建，请检查！",t.ID)),!1;if(this._activeObject.dataSource.isCreatedFsm(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"对象名："+this._activeObject.objectID+"，局部变量："+t.getData(a,5)+"，局部变量名不能与状态名相同，当前状态已创建，请检查！",t.ID)),!1;this._activeObject.varData.addVariable(f,y,t.pos(a,5))}else{if(this._currentType!==C.Template)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"局部变量："+t.getData(a,5)+"，当前局部变量所属未知，格式错误，请检查！",t.ID)),!1;if(this._activeTemplate.varData.isCreatedVariable(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"模板对象名："+this._activeTemplate.templateID+"，局部变量："+t.getData(a,5)+"，当前局部变量名已创建，请检查！",t.ID)),!1;if(this._activeTemplate.dataSource.isCreatedFsm(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"模板对象名："+t.getData(a,5)+"，当前局部变量所属未知，格式错误，请检查！",t.ID)),!1;this._activeTemplate.varData.addVariable(f,y,t.pos(a,5))}}}else{if(this._emptyLine=!0,2!==(E=F.VE_StringFormat.paraSegment(_)).length&&3!==E.length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"局部变量："+t.getData(a,5)+"，当前局部变量格式不正确，请检查！",t.ID)),!1;f=E[0].trim();if(!F.VE_StringFormat.isIDLegal(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"变量："+t.getData(a,5)+"，当前变量名不合法，包含非法字符，请检查！",t.ID)),!1;g=[E[1].trim()];if(2===E.length?g[1]="":g[1]=E[2].trim(),this._currentType===C.Object){if(this._activeObject.varData.isCreatedVariable(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"对象名："+this._activeObject.objectID+"，局部变量："+t.getData(a,5)+"，当前局部变量名已创建，请检查！",t.ID)),!1;if(this._activeObject.dataSource.isCreatedFsm(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"对象名："+this._activeObject.objectID+"，局部变量："+t.getData(a,5)+"，局部变量名不能与状态名相同，当前状态已创建，请检查！",t.ID)),!1;this._activeObject.varData.addVariable(f,g,t.pos(a,5))}else{if(this._currentType!==C.Template)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"局部变量："+t.getData(a,5)+"，当前局部变量所属未知，格式错误，请检查！",t.ID)),!1;if(this._activeTemplate.varData.isCreatedVariable(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"模板对象名："+this._activeTemplate.templateID+"，局部变量："+t.getData(a,5)+"，当前局部变量名已创建，请检查！",t.ID)),!1;if(this._activeTemplate.dataSource.isCreatedFsm(f))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"模板对象名："+this._activeTemplate.templateID+"，局部变量："+t.getData(a,5)+"，局部变量名不能与状态名相同，当前状态已创建，请检查！",t.ID)),!1;this._activeTemplate.varData.addVariable(f,g,t.pos(a,5))}}}else{var m=!1;if(""!==(_=t.getData(a,5))?(m=!0,this._emptyLine=!1):this._emptyLine&&(m=!(this._emptyLine=!1),_=this._lastObjectID+"_空状态_"+R.StateConst.StateCount+++","+R.StateConst.STATE_VALUE),m)if(-1<_.indexOf("=")){var d=_.split("="),b=d[0].trim();if(2!==d.length||b!==this._lastFsmID)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"状态赋值："+t.getData(a,5)+"，状态名："+b+"，当前状态未定义，请检查！",t.ID)),!1;if(null===this._activeFsmData)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"状态赋值："+t.getData(a,5)+"，当前状态不属于任何对象和模板对象，请检查！",t.ID)),!1;(v=new N.VE_StateData(this._activeFsmData,d[1].trim(),!1)).rowIndex=a,this._activeFsmData.addState(v),this._activeStateData=v}else{var E;if(2!==(E=F.VE_StringFormat.paraSegment(_)).length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"状态："+t.getData(a,5)+"，当前状态格式不正确，应为“状态名，状态值”的形式，请检查！",t.ID)),!1;b=E[0].trim();if(!F.VE_StringFormat.isIDLegal(b))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"状态名："+t.getData(a,5)+"，当前状态名不合法，包含非法字符，请检查！",t.ID)),!1;if(E[1]=E[1].trim(),this._lastFsmID=b,this._currentType===C.Object){if(this._activeObject.varData.isCreatedVariable(b))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"对象名："+this._lastObjectID+"，状态名："+b+"，状态名与局部变量名不能相同，当前局部变量已创建，请检查！",t.ID)),!1;if(this._activeObject.dataSource.isCreatedFsm(b))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"对象名："+this._lastObjectID+"，状态名："+b+"，当前状态已创建，请检查！",t.ID)),!1;this._activeObject.dataSource.createFsm(b,t.pos(a,5)),this._activeFsmData=this._activeObject.dataSource.getFsmData(b),this._activeFsmData.initFsm("string",E[1]),(v=new N.VE_StateData(this._activeFsmData,E[1],!0)).rowIndex=a,this._activeFsmData.addState(v),this._activeStateData=v}else{if(this._currentType!==C.Template)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"局部变量："+t.getData(a,5)+"，当前局部变量所属未知，格式错误，请检查！",t.ID)),!1;if(this._activeTemplate.varData.isCreatedVariable(b))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"模板对象名："+this._lastObjectID+"，状态名："+b+"，状态名与局部变量名不能相同，当前局部变量已创建，请检查！",t.ID)),!1;if(this._activeTemplate.dataSource.isCreatedFsm(b))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,5),"模板对象名："+this._lastObjectID+"，状态名："+b+"，当前状态已创建，请检查！",t.ID)),!1;var v;this._activeTemplate.dataSource.createFsm(b,t.pos(a,5)),this._activeFsmData=this._activeTemplate.dataSource.getFsmData(b),this._activeFsmData.initFsm("string",E[1]),(v=new N.VE_StateData(this._activeFsmData,E[1],!0)).rowIndex=a,this._activeFsmData.addState(v),this._activeStateData=v}}if(""!==t.getData(a,2)||""!==t.getData(a,3)){if(null===this._activeFsmData||null===this._activeStateData)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,2),"触发："+t.getData(a,2)+"，当前触发不属于任何对象和模板对象，请检查！",t.ID)),!1;var V=t.getData(a,2);""===t.getData(a,2)&&(V=this._lastObjectID+"_"+this._lastFsmID+"_空触发_"+R.StateConst.TriggerCount++);var T=V.replace(/./g,"");if(!F.VE_StringFormat.isIDLegal(T))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,2),"触发名："+t.getData(a,2)+"，当前触发名不合法，包含非法字符，请检查！",t.ID)),!1;if(""!==t.getData(a,3)){if(this._activeFsmData.dataSource.isCreatedTrigger(V))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,2),"触发："+t.getData(a,2)+"，当前触发已在该对象中定义，请勿重复定义，请检查！",t.ID)),!1;this._activeFsmData.dataSource.addTrigger(V,F.VE_StringFormat.paraSegment(t.getData(a,3)),t.pos(a,2))}var S=new N.VE_StateTriggerData(V);this._activeStateData.addTrigger(S,t.pos(a,2)),""!==t.getData(a,1)&&(S.logicalSwitch=t.getData(a,1)),""!==t.getData(a,4)&&(S.logicalExp=t.getData(a,4))}else{if(""!==t.getData(a,1))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,1),"触发启动条件："+t.getData(a,1)+"，当前无触发，请勿定义触发启动条件，请检查！",t.ID)),!1;if(""!==t.getData(a,4)){if(null===this._activeFsmData||null===this._activeStateData)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,4),"状态逻辑条件："+t.getData(a,4)+"，当前状态逻辑条件不属于任何对象和模板对象，请检查！",t.ID)),!1;if(""!==this._activeStateData.logicalExp)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,4),"状态逻辑条件："+t.getData(a,4)+"，在状态的某个值中，无触发的状态逻辑条件只能填写1个，作为关联状态的逻辑条件，此处为第2个，不符合规则，请检查！",t.ID)),!1;this._activeStateData.logicalExp=t.getData(a,4)}}if(""!==t.getData(a,6)||""!==t.getData(a,7)){if(null===this._activeFsmData||null===this._activeStateData)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,6),"响应："+t.getData(a,6)+"，当前响应不属于任何对象和模板对象，请检查！",t.ID)),!1;if(""!==t.getData(a,7)){var A=t.getData(a,7).toLowerCase();if(A.startsWith("log(")||A.startsWith("log（")||A.startsWith("调试（")||A.startsWith("调试(")){var O=e+"__log__"+R.StateConst.LogCount++,P=new N.VE_StateActionData(O,"true","false");this._activeStateData.addAction(P,t.pos(a,7));var D=t.getData(a,7).substring(4);A.startsWith("调试")&&(D=t.getData(a,7).substring(3)),this._activeFsmData.dataSource.addAction(O,["调试","调试",D.substring(0,D.length-1)],["true","false"],t.pos(a,7)),""!==t.getData(a,6)&&k.VE_ErrorManager.Add(k.VE_Error.warning(t.pos(a,6),"响应名："+t.getData(a,6)+"，该处不应该再有响应定义，但是填写了响应名，请检查！",t.ID))}else if(A.startsWith("error(")||A.startsWith("error（")||A.startsWith("错误（")||A.startsWith("错误(")){O=e+"__log__"+R.StateConst.LogCount++,P=new N.VE_StateActionData(O,"true","false");this._activeStateData.addAction(P,t.pos(a,7));D=t.getData(a,7).substring(6);A.startsWith("错误")&&(D=t.getData(a,7).substring(3)),this._activeFsmData.dataSource.addAction(O,["调试","错误",D.substring(0,D.length-1)],["true","false"],t.pos(a,7)),""!==t.getData(a,6)&&k.VE_ErrorManager.Add(k.VE_Error.warning(t.pos(a,6),"响应名："+t.getData(a,6)+"，该处不应该再有响应定义，但是填写了响应名，请检查！",t.ID))}else if(A.startsWith("warn(")||A.startsWith("warn（")||A.startsWith("警告（")||A.startsWith("警告(")){O=e+"__log__"+R.StateConst.LogCount++,P=new N.VE_StateActionData(O,"true","false");this._activeStateData.addAction(P,t.pos(a,7));D=t.getData(a,7).substring(5);A.startsWith("警告")&&(D=t.getData(a,7).substring(3)),this._activeFsmData.dataSource.addAction(O,["调试","警告",D.substring(0,D.length-1)],["true","false"],t.pos(a,7)),""!==t.getData(a,6)&&k.VE_ErrorManager.Add(k.VE_Error.warning(t.pos(a,6),"响应名："+t.getData(a,6)+"，该处不应该再有响应定义，但是填写了响应名，请检查！",t.ID))}else{if(1===(j=F.VE_StringFormat.paraSegment(t.getData(a,7))).length&&-1<j[0].indexOf("=")){""!==t.getData(a,6)&&k.VE_ErrorManager.Add(k.VE_Error.warning(t.pos(a,6),"响应名："+t.getData(a,6)+"，该处不应该再有响应定义，但是填写了响应名，请检查！",t.ID));var x=t.getData(a,7).indexOf("=");(P=new N.VE_StateActionData("")).setAssignmentAction(t.getData(a,7),t.getData(a,7).substring(0,x).trim(),t.getData(a,7).substring(x+1).trim()),this._activeStateData.addAction(P,t.pos(a,7))}else{var I=void 0;if(2!==(I=""!==t.getData(a,6)?F.VE_StringFormat.paraSegment(t.getData(a,6)):[this._lastObjectID+"_"+this._lastFsmID+"_空响应_"+R.StateConst.ActionCount++,"true","false","false"]).length&&3!==I.length&&4!==I.length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,6),"响应："+t.getData(a,6)+"，响应格式不正确，应为“响应ID，启动标志（bool），每帧运行标志（bool）”的形式，请检查！",t.ID)),!1;P=void 0;if(P=2===I.length?new N.VE_StateActionData(I[0],I[1]):3===I.length?new N.VE_StateActionData(I[0],I[1],I[2]):new N.VE_StateActionData(I[0],I[1],I[2],I[3]),this._activeStateData.addAction(P,t.pos(a,6)),!F.VE_StringFormat.isIDLegal(I[0]))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,6),"响应名："+t.getData(a,6)+"，当前响应名不合法，包含非法字符，请检查！",t.ID)),!1;if(this._activeFsmData.dataSource.isCreatedAction(I[0]))return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,6),"响应："+t.getData(a,6)+"，当前响应已在该对象中定义，请勿重复定义，请检查！",t.ID)),!1;2==I.length?this._activeFsmData.dataSource.addAction(I[0],F.VE_StringFormat.paraSegment(t.getData(a,7)),[I[1],"false"],t.pos(a,6)):this._activeFsmData.dataSource.addAction(I[0],F.VE_StringFormat.paraSegment(t.getData(a,7)),[I[1],I[2]],t.pos(a,6))}}}else{var j;if(2!==(j=F.VE_StringFormat.paraSegment(t.getData(a,6))).length&&3!==j.length&&4!==j.length)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,6),"响应："+t.getData(a,6)+"，响应格式不正确，应为“响应ID，启动标志（bool），每帧运行标志（bool）”的形式，请检查！",t.ID)),!1;P=void 0;P=2===j.length?new N.VE_StateActionData(j[0],j[1]):3===j.length?new N.VE_StateActionData(j[0],j[1],j[2]):new N.VE_StateActionData(j[0],j[1],j[2],j[3]),this._activeStateData.addAction(P,t.pos(a,6))}}if(""!==t.getData(a,8)){if(null===this._activeFsmData||null===this._activeStateData)return k.VE_ErrorManager.Add(k.VE_Error.error(t.pos(a,8),"关联状态："+t.getData(a,8)+"，当前关联状态不属于任何对象和模板对象，请检查！",t.ID)),!1;this._activeStateData.addAssociatedState(t.getData(a,8),t.pos(a,8))}}return B.CreateInstance.createProject(e)}return k.VE_ErrorManager.Add(k.VE_Error.error("","表格内容不存在，引擎无法启动！","null")),!1},e}();r.LoaderManager=n},{"../babylon":10,"../dataSource":14,"../global":40,"../manager":59,"../object":63,"../state":70,"../template":75,"../utility":85,"./createInstance":56}],59:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./projects")),i(e("./manager")),i(e("./reset"))},{"./manager":60,"./projects":61,"./reset":62}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./projects"),n=e("../object"),a=e("../template"),s=e("../variables"),o=e("../state"),u=function(){function t(){}return Object.defineProperty(t,"projects",{get:function(){return null===this._projects&&(this._projects=new i.VE_Projects),this._projects},enumerable:!0,configurable:!0}),t.createProject=function(e){t.projects.addProject(e),t.projects.isCreatedObjects(e)||t.projects.addObjects(e,new n.VE_Objects(e)),t.projects.isCreatedTemplates(e)||t.projects.addTemplates(e,new a.VE_Templates(e)),t.projects.isCreatedVariables(e)||t.projects.addVariables(e,new s.VE_Variables(e))},t.globalVarData=function(e){return t.projects.isCreatedGlobals(e)||t.projects.addVariables(e,new s.VE_Variables(e)),t.projects.getGlobalVars(e)},t.templates=function(e){return t.projects.isCreatedTemplates(e)||t.projects.addTemplates(e,new a.VE_Templates(e)),t.projects.getTemplates(e)},t.variables=function(e){return t.projects.isCreatedVariables(e)||t.projects.addVariables(e,new s.VE_Variables(e)),t.projects.getVariables(e)},t.objects=function(e){return t.projects.isCreatedObjects(e)||t.projects.addObjects(e,new n.VE_Objects(e)),t.projects.getObjects(e)},t.clear=function(){t.projects.clear(),this._projects=null},t.clearProject=function(e){t.projects.clearProject(e)},t.dispose=function(){t.projects&&(t.clear(),o.StateConst.LogCount=0,o.StateConst.AssignmentFormulaCount=0,o.StateConst.TriggerCount=0,o.StateConst.ActionCount=0,o.StateConst.StateCount=0)},t._projects=null,t}();r.VE_Manager=u},{"../object":63,"../state":70,"../template":75,"../variables":92,"./projects":61}],61:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this._objects={},this._variables={},this._templates={},this.projects=[]}return e.prototype.addProject=function(e){-1===this.projects.indexOf(e)&&this.projects.push(e)},e.prototype.isCreatedObjects=function(e){return!!this._objects[e]},e.prototype.addObjects=function(e,t){this._objects[e]=t},e.prototype.getObjects=function(e){return this._objects[e]},e.prototype.isCreatedVariables=function(e){return!!this._variables[e]},e.prototype.addVariables=function(e,t){this._variables[e]=t},e.prototype.getVariables=function(e){return this._variables[e]},e.prototype.isCreatedTemplates=function(e){return!!this._templates[e]},e.prototype.addTemplates=function(e,t){this._templates[e]=t},e.prototype.getTemplates=function(e){return this._templates[e]},e.prototype.isCreatedGlobals=function(e){return!!this._variables[e]},e.prototype.getGlobalVars=function(e){return this._variables[e].varData},e.prototype.clear=function(){for(var e=0;e<this.projects.length;e++)this.disposeProject(this.projects[e]);this.projects=[]},e.prototype.clearProject=function(e){this.disposeProject(e);var t=this.projects.indexOf(e);-1<t&&this.projects.splice(t,1)},e.prototype.disposeProject=function(e){this._objects[e]&&this._objects[e].clear(),delete this._objects[e],this._templates[e]&&this._templates[e].clear(),delete this._templates[e],this._variables[e]&&this._variables[e].clear(),delete this._variables[e]},e.prototype.sleep=function(){},e.prototype.dispose=function(){this.clear()},e}();r.VE_Projects=i},{}],62:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./manager"),n=function(){function e(){}return e.dispose=function(){i.VE_Manager.clear()},e.addClear=function(e){this._clearTotal.push(e)},e.addProjectClear=function(e){this._clearProject.push(e)},e.clear=function(){this._clearTotal.forEach(function(e){e()})},e.clearProject=function(r){this._clearProject.forEach(function(e,t){e(r)})},e._clearTotal=[],e._clearProject=[],e}();r.VE_Reset=n},{"./manager":60}],63:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./veryengineObject")),i(e("./objects"))},{"./objects":64,"./veryengineObject":65}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../utility"),n=function(){function e(e){this._projectName="",this._objectIDs=[],this._objectDics={},this._projectName=e}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._objectIDs.length},enumerable:!0,configurable:!0}),e.prototype.isCreated=function(e){return!!this._objectDics[e]},e.prototype.add=function(e,t){this.isCreated(e)||(this._objectIDs.push(e),this._objectDics[e]=t)},e.prototype.getObjectID=function(e){return 0<=e&&e<this._objectIDs.length?this._objectIDs[e]:""},e.prototype.getVeryObject=function(e){return this._objectDics[e]},e.prototype.unloadObject=function(e){i.ArrayUtility.remove(this._objectIDs,e),delete this._objectDics.object_id},e.prototype.clear=function(){for(var e=0;e<this._objectIDs.length;e++){var t=this._objectDics[this._objectIDs[e]];t&&t.clear()}this._objectIDs=[],this._objectDics={}},e}();r.VE_Objects=n},{"../utility":85}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../dataSource"),n=e("../babylon"),a=function(){function e(e,t,r){this._projectName="",this._objectID="",this.template=null,this._variables={},this._expressions={},this._actions={},this._triggers={},this._fsms={},this._templates={},this._unloadCallback=null,this._projectName=projectName,this._objectID=t,this.gameObject=r,this.dataSource=new i.VE_DataSource(e,t,!1),this.varData=new i.VE_VariableData(e)}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),e.prototype.isCreatedFsm=function(e){return!!this._fsms[e]},e.prototype.addFsm=function(e,t){this._fsms[e]=t},e.prototype.getFsm=function(e){return this._fsms[e]},e.prototype.isCreatedTrigger=function(e){return!!this._triggers[e]},e.prototype.addTrigger=function(e,t){this._triggers[e]=t},e.prototype.getTrigger=function(e){return this._triggers[e]},e.prototype.isCreatedAction=function(e){return!!this._actions[e]},e.prototype.addAction=function(e,t){this._actions[e]=t},e.prototype.getAction=function(e){return this._actions[e]},e.prototype.isCreatedVariable=function(e){return!!this._variables[e]},e.prototype.addVariable=function(e,t){this._variables[e]=t},e.prototype.getVariable=function(e){return this._variables[e]},e.prototype.isCreatedExpression=function(e){return!!this._expressions[e]},e.prototype.addExpression=function(e,t){this._expressions[e]=t},e.prototype.getExpression=function(e){return this._expressions[e]},e.prototype.isCreatedTemplate=function(e){return!!this._templates[e]},e.prototype.addTemplate=function(e,t){this._templates[e]=t},e.prototype.getTemplate=function(e){return this._templates[e]},e.prototype.isCreatedVar=function(e){return!!(this._variables[e]||this._expressions[e]||this._templates[e])},e.prototype.update=function(){var t=this;Object.keys(this._triggers).forEach(function(e){t._triggers[e].update()}),Object.keys(this._actions).forEach(function(e){t._actions[e].update()})},e.prototype.unload=function(){null!=this._unloadCallback&&(this._unloadCallback(this._objectID),this.clear(),this.gameObject&&n.GameObject.Destroy(this.gameObject))},e.prototype.setUnloadCallback=function(e){this._unloadCallback=e},e.prototype.clear=function(){var t=this;this.dataSource&&this.dataSource.clear(),this.varData&&this.varData.clear(),this._variables={},this._expressions={},this._templates&&(Object.keys(this._templates).forEach(function(e){t._templates[e].clear()}),this._templates={}),this._fsms={},this.template=null,this._actions&&(Object.keys(this._actions).forEach(function(e){t._actions[e].destroy()}),this._actions={}),this._triggers&&(Object.keys(this._triggers).forEach(function(e){t._triggers[e].destroy()}),this._triggers={})},e}();r.VeryEngineObject=a},{"../babylon":10,"../dataSource":14}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./verySceneVariables"))},{"./verySceneVariables":67}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../variables"),n=function(){function e(){}return Object.defineProperty(e,"Variables",{get:function(){return null===e._variables&&(e._variables=new i.VE_Variables("__scene_varibale__")),e._variables},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HasLoaded",{get:function(){return this._hasLoaded},enumerable:!0,configurable:!0}),e.initIfNeeded=function(){this._hasLoaded||console.log("TODO: 场景变量下载")},e._variables=null,e._hasLoaded=!1,e}();r.VerySceneVariables=n},{"../variables":92}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("../enum"),u=e("./stateConst"),i=function(){function e(e){this._types=[],this._indexs=[],this._posArray=[],this._stateValues={},this._states={},this._templates={},this._templateFsmIDs={},this._fromState=e}return Object.defineProperty(e.prototype,"FromState",{get:function(){return this._fromState},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t,r){this._types.push(o.AssociatedFsmType.Object);var i=this._types.length;this._indexs.push(i),this._stateValues[i]=t,this._states[i]=e,this._posArray.push(r)},e.prototype.addTemplate=function(e,t,r,i){this._types.push(o.AssociatedFsmType.Template);var n=this._types.length;this._indexs.push(n),this._stateValues[n]=r,this._templates[n]=e,this._templateFsmIDs[n]=t,this._posArray.push(i)},e.prototype.connect=function(){for(var e=0;e<this._types.length;e++){var t=this._types[e],r=this._indexs[e];if(t!==o.AssociatedFsmType.Object){var i,n=this._templates[r],a=this._templateFsmIDs[r],s=this._stateValues[r];return null===n.templateInstance?void console.error("错误信息 >>> 位置："+this._posArray[e]+"，信息：项目名："+this._fromState.Fsm.projectName+"，对象名："+this._fromState.Fsm.objectID+"，关联起始状态："+this._fromState.Fsm.fsmID+"，关联模板变量："+n.templateVarID+"，关联状态错误：当前模板变量未实例化创建，请检查！"):n.templateInstance.isCreatedFsm(a)?null!==(i=n.templateInstance.getFsm(a).getState(s))?void i.action(u.StateConst.ASSOCIATED_STATE_PREFIX+this._fromState.Fsm.ID):void console.error("错误信息 >>> 位置："+this._posArray[e]+"，信息：项目名："+this._fromState.Fsm.projectName+"，对象名："+this._fromState.Fsm.objectID+"，关联起始状态："+this._fromState.Fsm.fsmID+"，关联模板变量："+n.templateVarID+"，目标状态名："+a+"，状态值："+s+"，关联状态错误：在目标模板变量的目标状态中，无法查找到该状态，请检查！"):void console.error("错误信息 >>> 位置："+this._posArray[e]+"，信息：项目名："+this._fromState.Fsm.projectName+"，对象名："+this._fromState.Fsm.objectID+"，关联起始状态："+this._fromState.Fsm.fsmID+"，关联模板变量："+n.templateVarID+"，目标状态名："+a+"，关联状态错误：在目标模板变量中无法查找到该目标状态名，请检查！")}if(null===(i=this._states[r]).logicalAssociated||!0===i.logicalAssociated.evaluate())return void i.action(u.StateConst.ASSOCIATED_STATE_PREFIX+this._fromState.Fsm.ID)}},e}();r.VE_AssociatedState=i},{"../enum":20,"./stateConst":74}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../babylon"),n=e("./stateConst"),a=function(){function e(e,t,r,i,n){this._projectName="",this._id="",this._objectID="",this._fsmID="",this._stateDics={},this._states=[],this._frameCount=-1,this._triggerIDs=[],this._projectName=e,this._objectID=t,this._fsmID=r,this._fsmVar=i,this._veryObject=n}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ID",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsmID",{get:function(){return this._fsmID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsmVar",{get:function(){return this._fsmVar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"VeryObject",{get:function(){return this._veryObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._states.length},enumerable:!0,configurable:!0}),e.prototype.isCreatedState=function(e){return!!this._stateDics[e]},e.prototype.addState=function(e){this._states.push(e)},e.prototype.getState=function(e){for(var t=0;t<this._states.length;t++)if(this._states[t].Value===e)return this._states[t];return null},e.prototype.getStateInSequence=function(e){return 0<=e&&e<this._states.length?this._states[e]:null},e.prototype.removeState=function(e){delete this._stateDics[e]},e.prototype.receiveEvent=function(e){return i.BabylonEngine.Scene.getFrameId()!=this._frameCount?(this._frameCount=i.BabylonEngine.Scene.getFrameId(),this._triggerIDs=[],this._triggerIDs.push(e),!0):!!e.startsWith(n.StateConst.ASSOCIATED_STATE_PREFIX)||-1===this._triggerIDs.indexOf(e)&&(this._triggerIDs.push(e),!0)},e.prototype.setValue=function(e){this._fsmVar.setValue(e)},e.prototype.hasStateValue=function(e){for(var t=0;t<this._states.length;t++)if(this._states[t].Value===e)return!0;return!1},e}();r.VE_Fsm=a},{"../babylon":10,"./stateConst":74}],70:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./state")),i(e("./fsm")),i(e("./stateAction")),i(e("./associatedState")),i(e("./stateConst")),i(e("./sequenceActions"))},{"./associatedState":68,"./fsm":69,"./sequenceActions":71,"./state":72,"./stateAction":73,"./stateConst":74}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../enum"),a=e("../babylon"),i=function(){function e(){this._sequenceState=n.SequenceActionState.Initial,this._activeActionIndex=-1,this._stateActions=[],this._activeActions=[],this._associatedStates=[],this._observer=null}return Object.defineProperty(e.prototype,"sequenceState",{get:function(){return this._sequenceState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"StateActions",{get:function(){return this._stateActions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ActiveActions",{get:function(){return this._activeActions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AssociatedStates",{get:function(){return this._associatedStates},enumerable:!0,configurable:!0}),e.prototype.sequenceAction=function(e,t){var r=this;this._activeActions=[],this._stateActions=[],this._associatedStates=[],this._sequenceState=n.SequenceActionState.Running;for(var i=0;i<e.length;i++)e[i].type===n.StateActionType.Action&&e[i].action.type===n.ActionType.Animation&&(e[i].action.SequenceState=n.SequenceActionState.Prepared),this._stateActions.push(e[i]);for(i=0;i<t.length;i++)this._associatedStates.push(t[i]);this.activate(0)&&this.checkActionsFinished(),this._observer=a.BabylonEngine.Scene.onBeforeRenderObservable.add(function(){r.update()})},e.prototype.activate=function(e){for(var t=e;t<this.StateActions.length;t++)if(this._activeActionIndex=t,this.StateActions[t].type===n.StateActionType.Assignment)this.StateActions[t].assignment.assign();else{var r=this.StateActions[t].action;if(r.type!==n.ActionType.Normal&&r.isSequence)return this.ActiveActions.push(this.StateActions[t]),r.sequenceAction(this,this.StateActions[t].enabled.getValue(),this.StateActions[t].everyFrame.getValue()),!1;r.action(this.StateActions[t].enabled.getValue(),this.StateActions[t].everyFrame.getValue())}return!0},e.prototype.pause=function(){0<this.ActiveActions.length&&(this._sequenceState=n.SequenceActionState.Pause,this.ActiveActions[0].action.pause())},e.prototype.resume=function(){0<this.ActiveActions.length&&(this._sequenceState=n.SequenceActionState.Running,this.ActiveActions[0].action.resume())},e.prototype.stop=function(){0<this.ActiveActions.length&&(this._sequenceState=n.SequenceActionState.Initial,this.ActiveActions[0].action.stop(),this.actionRecover(),this.destroy())},e.prototype.checkActionsFinished=function(){if(0==this.ActiveActions.length&&(++this._activeActionIndex>=this.StateActions.length||this.activate(this._activeActionIndex))&&(this._sequenceState=n.SequenceActionState.Initial,this.actionRecover(),0<this.AssociatedStates.length)){for(var e=0;e<this.AssociatedStates.length;e++)this.AssociatedStates[e].connect();this.destroy()}},e.prototype.actionRecover=function(){for(var e=0;e<this.StateActions.length;e++)this.StateActions[e].type===n.StateActionType.Action&&this.StateActions[e].action.type===n.ActionType.Animation&&(this.StateActions[e].action.SequenceState=n.SequenceActionState.Initial)},e.prototype.finishAction=function(e){if(0<this.ActiveActions.length)for(var t=0;t<this.ActiveActions.length;t++)if(this.ActiveActions[t].type===n.StateActionType.Action&&this.ActiveActions[t].action===e)return void this._activeActions.splice(t,1)},e.prototype.update=function(){this._sequenceState===n.SequenceActionState.Running&&this.checkActionsFinished()},e.prototype.destroy=function(){this._observer&&a.BabylonEngine.Scene.onBeforeRenderObservable.remove(this._observer),this._observer=null},e}();r.VE_SequenceActions=i},{"../babylon":10,"../enum":20}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./stateAction"),n=e("../enum"),a=e("../variables"),s=e("./sequenceActions"),o=function(){function e(e,t){this._isInitialValue=!1,this._value="",this._assignmentType=n.AssignmentType.Const,this._isTemplateVar=!1,this._template=null,this._varID="",this._templateVar=null,this._assignmentStr="",this._logicalExpression=null,this._index=0,this._stateVariable=null,this.logicalAssociated=null,this._stateActions=[],this._associatedStates=[],this._isSequence=!1,this._sequenceActions=new s.VE_SequenceActions,this._fsm=e,this._index=t}return Object.defineProperty(e.prototype,"Fsm",{get:function(){return this._fsm},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInitialValue",{get:function(){return this._isInitialValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTemplateVar",{get:function(){return this._isTemplateVar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logicalExpression",{get:function(){return this._logicalExpression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateVariable",{get:function(){return this._stateVariable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsSequence",{get:function(){return this._isSequence},enumerable:!0,configurable:!0}),e.prototype.setInitialValue=function(e){this._value=e,this._assignmentType=n.AssignmentType.Const},e.prototype.setSequence=function(){this._isSequence=!0},e.prototype.setLogicalExpression=function(e){this._logicalExpression=e},e.prototype.setTemplateInfo=function(e,t,r){this._isTemplateVar=!0,this._template=e,this._varID=t,this._assignmentStr=r},e.prototype.setConstValue=function(e){this._value=e,this._assignmentType=n.AssignmentType.Const},e.prototype.setStateVariable=function(e){this._stateVariable=e,this._assignmentType=n.AssignmentType.Variable},e.prototype.addAction=function(e){this._stateActions.push(e),e.type===n.StateActionType.Action&&e.action.isSequence&&(this._isSequence=!0)},e.prototype.addAssignment=function(e){var t=new i.VE_StateAction;t.setAssignment(e),this._stateActions.push(t)},e.prototype.addAssociatedState=function(e){this._associatedStates.push(e)},e.prototype.action=function(e){if(this._fsm.receiveEvent(e))if(this.Fsm.setValue(this.Value),this._isSequence){for(t=0;t<this._stateActions.length;t++)if(this._stateActions[t].type===n.StateActionType.Action&&this._stateActions[t].action.type===n.ActionType.Animation){if(this._stateActions[t].action.SequenceState===n.SequenceActionState.Prepared||this._stateActions[t].action.SequenceState===n.SequenceActionState.Running)return void console.error("错误信息 >>> （项目："+this._fsm.projectName+"，对象："+this._fsm.objectID+"，状态："+this._fsm.fsmID+"，ID："+this._index+"），当前状态中的响应："+this._stateActions[t].action.actionID+"，该响应处于“依次”运行状态，运行结束前不允许再次启动！");if(this._stateActions[t].action.SequenceState===n.SequenceActionState.Pause)return void console.error("错误信息 >>> （项目："+this._fsm.projectName+"，对象："+this._fsm.objectID+"，状态："+this._fsm.fsmID+"，ID："+this._index+"），当前状态中的响应："+this._stateActions[t].action.actionID+"，该响应处于“依次”运行状态（暂停中），运行结束前不允许再次启动！")}this._sequenceActions.sequenceAction(this._stateActions,this._associatedStates)}else{for(var t=0;t<this._stateActions.length;t++){var r=this._stateActions[t];r.type===n.StateActionType.Action?r.action.action(r.enabled.getValue(),r.everyFrame.getValue()):r.assignment.assign()}if(0<this._associatedStates.length)for(var t=0;t<this._associatedStates.length;t++)this._associatedStates[t].connect()}},e.prototype.getTemplateVar=function(){if(null===this._template.templateInstance)return console.error("错误信息 >>> 项目："+this._fsm.projectName+"，对象："+this._fsm.objectID+"，状态："+this._fsm.fsmID+"，状态赋值："+this._assignmentStr+"，当前赋值模板对象未实例化，赋值前，请先启动对应响应实例化该模板对象！"),void(this._templateVar=null);if(this._template.templateInstance.isCreatedVariable(this._varID))this._templateVar=this._template.templateInstance.getVariable(this._varID);else if(this._template.templateInstance.isCreatedExpression(this._varID))this._templateVar=new a.VeryExpression(this._template.templateInstance.getExpression(this._varID));else{if(!this._template.templateInstance.isCreatedFsm(this._varID))return console.error("错误信息 >>> 项目："+this._fsm.projectName+"，对象："+this._fsm.objectID+"，状态："+this._fsm.fsmID+"，状态赋值："+this._assignmentStr+"，在模板变量对象中无法查找到该变量："+this._varID+"，请检查！"),void(this._templateVar=null);this._templateVar=this._template.templateInstance.getFsm(this._varID).fsmVar}this._fsm.setValue(this._templateVar.getValue())},e}();r.VE_State=o},{"../enum":20,"../variables":92,"./sequenceActions":71,"./stateAction":73}],73:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../enum"),a=e("../variables"),i=function(){function e(){this._type=n.StateActionType.Action,this._action=null,this._assignment=null,this._enabled=new a.VeryBool,this._everyFrame=new a.VeryBool}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"action",{get:function(){return this._action},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"everyFrame",{get:function(){return this._everyFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assignment",{get:function(){return this._assignment},enumerable:!0,configurable:!0}),e.prototype.setAction=function(e,t,r,i){void 0===t&&(t=new a.VeryBool),void 0===r&&(r=new a.VeryBool),void 0===i&&(i=!1),this._action=e,this._enabled=t,this._everyFrame=r,this._action.isSequence=i,this._type=n.StateActionType.Action},e.prototype.setAssignment=function(e){this._assignment=e,this._type=n.StateActionType.Assignment},e}();r.VE_StateAction=i},{"../enum":20,"../variables":92}],74:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.STATE_SEPARATOR=".",e.ASSOCIATED_STATE_PREFIX="关联状态:",e.VARIABLE_SYMBOL="*",e.STATE_INDEX=-1,e.LogCount=0,e.AssignmentPrefix="公式变量赋值_",e.AssignmentFormulaCount=0,e.TriggerCount=0,e.ActionCount=0,e.StateCount=0,e.STATE_VALUE="空",e}();r.StateConst=i},{}],75:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./template")),i(e("./templates"))},{"./template":76,"./templates":77}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../dataSource"),i=function(){function i(e,t){this._projectName="",this._templateID="",this._templateVarID="",this._objectID="",this.templateInstance=null,this._counter=0,this.backupInstances=[],this.instanceArray=[],this._projectName=e,this._templateID=t,this.dataSource=new n.VE_DataSource(e,t,!0),this.varData=new n.VE_VariableData(e)}return Object.defineProperty(i.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"templateID",{get:function(){return this._templateID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"templateVarID",{get:function(){return this._templateVarID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"objectID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"counter",{get:function(){return this._counter},enumerable:!0,configurable:!0}),i.prototype.activeCount=function(){return this.backupInstances.length},i.prototype.addInstance=function(e){this.templateInstance=e,this.backupInstances.push(e)},i.prototype.isCreatedVariable=function(e){return this.varData.isCreatedVariable(e)},i.prototype.addVariable=function(e,t,r){this.varData.addVariable(e,t,r)},i.prototype.increase=function(){this._counter++},i.prototype.unload=function(e){void 0===e&&(e=!1),e?this.backupInstances=[]:this.backupInstances.pop(),this.templateInstance=null},i.prototype.unloadInstance=function(e){var t=this.backupInstances.indexOf(e);-1<t&&this.backupInstances.splice(t,1)},i.prototype.clone=function(e,t){var r=new i(this._projectName,this._templateID);return r._objectID=e,r._templateVarID=t,r.dataSource=this.dataSource,r.varData=this.varData,r._counter=this._counter,r},i.prototype.clear=function(){this.dataSource&&this.dataSource.clear(),this.varData&&this.varData.clear(),this.templateInstance&&this.templateInstance.clear()},i}();r.VE_Template=i},{"../dataSource":14}],77:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var ie=e("../utility"),ne=e("../state"),ae=e("../babylon"),se=e("../object"),oe=e("../manager"),ue=e("../variables"),le=e("../expression"),ce=e("../trigger"),pe=e("../action"),he=e("../enum"),O=e("../scene"),P=e("../action/assignmentTypeJudge"),i=function(){function e(e){this._projectName="",this._templateDic={},this._instanceDic={},this._instanceArray={},this._projectName=e}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),e.prototype.isCreatedTemplate=function(e){return!!this._templateDic[e]},e.prototype.addTemplate=function(e,t){this._templateDic[e]=t},e.prototype.getTemplate=function(e){return this._templateDic[e]},e.prototype.isCreatedInstance=function(e,t){return!(!this._instanceDic[e]||!this._instanceDic[e][t])},e.prototype.getInstance=function(e,t){return this._instanceDic[e][t]},e.prototype.clear=function(){var t=this;this._templateDic&&(Object.keys(this._templateDic).forEach(function(e){t._templateDic[e].clear()}),this._templateDic={})},e.prototype.createInstance=function(e,t,r,i,n,a){var s="错误定位信息：（项目："+this._projectName+"，对象："+e+"，模板变量："+t+"，模板名："+r.templateID+"）";null!==r.templateInstance&&a&&(r.templateInstance.unload(),r.unload());var o=null,u=!1,l=r.templateID+"_"+t.replace(ne.StateConst.VARIABLE_SYMBOL,"");if(""===i||"null"===i.toLowerCase()||"none"===i.toLowerCase())o=new ae.GameObject(l+"_Empty"),u=!0;else if(null===(o=ae.GameObject.Find(i)))return n.isRight=!1,n.message="模板对象实例化失败：无法在场景中查找到对应名字的物体，也无法以预制件在Resources文件夹中加载，物体名："+i+"！"+s,null;u||(o=ae.GameObject.CreateInstance(o)),o.name+="_"+r.counter,l+="_"+r.counter,r.increase();var c=new se.VeryEngineObject(this._projectName,l,o);r.addInstance(c),c.template=r;var p=oe.VE_Manager.objects(this._projectName);p.add(l,c),c.setUnloadCallback(p.unloadObject.bind(p));for(var h=0;h<r.varData.count;h++){var _=r.varData.getVariableID(h);if("公式"!==(b=r.varData.getVariableParas(_))[0]&&"expression"!==b[0].toLowerCase())if(ue.VeryVarManager.hasVarType(b[0])){var f=new ie.ErrorInfo,g=ue.VeryVarManager.createVariable(_,b[0],b[1],f);if(!f.isRight||null===g)return n.isRight=!1,n.message="模板对象实例化失败：局部变量创建失败，局部变量："+_+"，"+b[0]+"，"+b[1]+"，错误信息："+f.message+"！"+s,null;c.addVariable(_,g)}else{if(!this.isCreatedTemplate(b[0]))return n.isRight=!1,n.message="模板对象实例化失败：局部变量创建失败，当前变量不存在，局部变量："+_+","+b[0]+","+b[1]+"！"+s,null;c.addTemplate(_,this.getTemplate(b[0]).clone(l,_))}}for(h=0;h<r.dataSource.fsmCount;h++){var y=r.dataSource.getFsmID(h),m=r.dataSource.getFsmData(y);(g=new ue.VeryString).setValue(m.initialValStr);var d=new ne.VE_Fsm(this.projectName,l,y,g,c);c.addFsm(y,d)}for(h=0;h<r.varData.count;h++){var b;_=r.varData.getVariableID(h);if("公式"===(b=r.varData.getVariableParas(_))[0]||"expression"===b[0].toLowerCase()){f=new ie.ErrorInfo;var E=le.VE_Expressions.createLocalExpression(_,b[1],this._projectName,l,f);if(!f.isRight||null===E)return n.isRight=!1,n.message="模板对象实例化失败：局部变量创建失败，公式创建错误：\n"+f.message+"，请检查！"+s,null;c.addExpression(_,E)}}for(h=0;h<r.dataSource.triggerCount;h++){var v=r.dataSource.getTriggerID(h),V=r.dataSource.getTriggerPara(v);if(!ce.VE_Triggers.hasTrigger(V[0]))return n.isRight=!1,n.message="模板对象实例化失败：当前系统中不存在该触发类型，触发："+v+"类型："+V[0]+"，请检查！"+s,null;f=new ie.ErrorInfo;var T=ce.VE_Triggers.createTrigger(c,v,V[0],V.slice(1),f);if(!f.isRight||null===T)return n.isRight=!1,n.message="模板对象实例化失败：触发创建错误，触发："+v+"，原因："+f+"，请检查！"+s,null;"Trigger_Custom"===T.className&&ce.VE_CustomTriggerManager.AddTriggerEvent(this._projectName,l,v,T.customEvent),c.addTrigger(v,T)}for(h=0;h<r.dataSource.actionCount;h++){var S=r.dataSource.getActionID(h),A=r.dataSource.getActionPara(S);if(!pe.VE_Actions.hasAction(A[0]))return n.isRight=!1,n.message="模板对象实例化失败：当前系统中不存在该响应类型，响应："+S+"类型："+A[0]+"，请检查！"+s,null;f=new ie.ErrorInfo;var O=pe.VE_Actions.createAction(c,S,A[0],A.slice(1),r.dataSource.getActionInitVal(S),f);if(!f.isRight||null===O)return n.isRight=!1,n.message="模板对象实例化失败：响应创建错误，响应："+S+"，错误信息："+f+"，请检查！"+s,null;c.addAction(S,O)}for(h=0;h<r.dataSource.fsmCount;h++){y=r.dataSource.getFsmID(h),m=r.dataSource.getFsmData(y),d=c.getFsm(y);for(var P=0;P<m.count;P++){var D=m.getStateData(P);if((W=new ne.VE_State(d,d.count+1)).setConstValue(D.ValStr),D.isSequence&&W.setSequence(),""!==D.logicalExp){f=new ie.ErrorInfo;var x=le.VE_Expressions.createFsmExpression("",D.logicalExp,this._projectName,l,y,f);if(!f.isRight||null===x)return n.isRight=!1,n.message="模板对象实例化失败：状态逻辑表达式："+D.logicalExp+"，逻辑表达式创建失败，公式创建错误：\n："+f.message+"，状态："+y+"，请检查！"+s,null;W.logicalAssociated=x}for(var I=0;I<D.triggerCount;I++){var j=D.getTrigger(I);if(null===(T=ce.VE_Triggers.findTrigger(c,j.triggerID)))return n.isRight=!1,n.message="模板对象实例化失败：当前触发无法在模板对象中查找到，触发ID："+j.triggerID+"，状态："+y+"，请检查！"+s,null;x=null;if(""!==j.logicalExp){f=new ie.ErrorInfo;if(x=le.VE_Expressions.createFsmExpression("",j.logicalExp,this._projectName,l,y,f),!f.isRight||null===x)return n.isRight=!1,n.message="模板对象实例化失败：状态逻辑表达式："+j.logicalExp+"，逻辑表达式创建失败，公式创建错误：\n："+f.message+"，状态："+y+"，请检查！"+s,null}if(T.addTriggerTarget(x,W),""!==j.logicalSwitch){f=new ie.ErrorInfo;var C=le.VE_Expressions.createFsmExpression("",j.logicalSwitch,this._projectName,l,y,f);if(null==C)return n.isRight=!1,n.message="模板对象实例化失败：触发启动条件："+j.logicalSwitch+"，触发启动条件创建失败，公式创建错误：\n"+f.message+"状态："+y+"，请检查！"+s,null;T.addLogicalSwitch(C)}}for(I=0;I<D.actionCount;I++){var w=D.getAction(I);if(w.type===he.StateActionType.Action){if(null===(O=pe.VE_Actions.findAction(c,w.actionID)))return n.isRight=!1,n.message="模板对象实例化失败：当前响应无法在模板对象中查找到，响应ID："+w.actionID+"，状态："+y+"，请检查！"+s,null;f=new ie.ErrorInfo;var M=null,N=w.enabled.trim().toLowerCase();if("false"===N||"停止"===N)(M=new ue.VeryBool).setValue(!1);else if("true"===N||"启动"===N)(M=new ue.VeryBool).setValue(!0);else{if(!(-1<w.enabled.indexOf(ne.StateConst.VARIABLE_SYMBOL)))return n.isRight=!1,n.message="模板对象实例化失败：响应启动参数允许填写格式为：“启动/true”、“停止/false”、“*变量名”、“对象名.*变量名”，且变量不能为模板变量，且变量返回值必须为bool值，当前参数不符合，参数为："+w.enabled+"，请检查！"+s,null;if(f.clear(),M=ue.VarTools.GetVeryVarWithExpression(this.projectName,l,w.enabled,f),!f.isRight||null===M)return n.isRight=!1,n.message="模板对象实例化失败：响应启动参数格式不正确，错误信息："+f.message+"，请检查！"+s,null;if("bool"!==M.varType)return n.isRight=!1,n.message="模板对象实例化失败：响应启动参数变量必须返回bool值类型，当前变量类型："+M.varType+"，请检查！"+s,null}var L=null,F=w.everyFrame.trim().toLowerCase();if("false"===F||"一次"===F)(L=new ue.VeryBool).setValue(!1);else if("true"===F||"持续"===F)(L=new ue.VeryBool).setValue(!0);else{if(!(-1<w.everyFrame.indexOf(ne.StateConst.VARIABLE_SYMBOL)))return n.isRight=!1,n.message="模板对象实例化失败：响应帧循环参数允许填写格式为：“持续/true”、“一次/false”、“*变量名”、“对象名.*变量名”，且变量不能为模板变量，且变量返回值必须为bool值，当前参数为："+w.everyFrame+"，请检查！"+s,null;if(f.clear(),L=ue.VarTools.GetVeryVarWithExpression(this.projectName,l,w.everyFrame,f),!f.isRight||null===L)return n.isRight=!1,n.message="模板对象实例化失败：响应帧循环参数格式不正确，错误信息："+f.message+"，请检查！"+s,null;if("bool"!==L.varType)return n.isRight=!1,n.message="模板对象实例化失败：响应帧循环参数变量必须返回bool值类型，当前变量类型："+L.varType+"，请检查！"+s,null}var k=w.isSequence.trim().toLowerCase(),R=!1;if("false"===k||"同时"===k)R=!1;else{if("true"!==k&&"依次"!==k)return n.isRight=!1,n.message="模板对象实例化失败：响应依次运行状态允许填写格式为：“同时/false”、“依次/true”，不允许填写变量，当前参数为："+w.everyFrame+"，请检查！"+s,null;R=!0}var B=new ne.VE_StateAction;B.setAction(O,M,L,R),W.addAction(B)}else if(!this.assignmentAction(this._projectName,l,y,oe.VE_Manager.variables(this._projectName),c,w,W,n))return n.message+=s,null}}}for(h=0;h<r.dataSource.fsmCount;h++)for(y=r.dataSource.getFsmID(h),m=r.dataSource.getFsmData(y),d=c.getFsm(y),P=0;P<m.count;P++){D=m.getStateData(P);var W=d.getStateInSequence(P);for(I=0;I<D.associatedStateCount;I++){for(var z=D.getAssociatedState(I),G=new ne.VE_AssociatedState(W),U=z.split(/,|，/),Y=0;Y<U.length;Y++){z=U[Y].trim();var q=ne.StateConst.STATE_VALUE,K=z.split("=");if(1===K.length);else{if(2!==K.length)return n.isRight=!1,n.message="当前关联状态格式错误，应为“状态名 = 状态值”的形式，请检查！"+s,null;q=K[1].trim()}var Z=K[0].trim();if(-1<Z.indexOf(ne.StateConst.STATE_SEPARATOR)){for(var Q=Z.split(ne.StateConst.STATE_SEPARATOR[0]),J=0;J<Q.length;J++)Q[J]=Q[J].trim();if(3===Q.length){if(!p.isCreated(Q[0]))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“对象名.*模板变量.状态名”形式，在当前系统中无法查找到该对象名，状态："+y+"，关联状态："+z+"，请检查！"+s,null;var X=p.getVeryObject(Q[0]);if(!Q[1].startsWith(ne.StateConst.VARIABLE_SYMBOL))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“对象名.*模板变量.状态名”形式，模板变量填写格式不正确，状态："+y+"，关联状态："+z+"，请检查！"+s,null;_=Q[1].substring(1);return X.isCreatedTemplate(_)?($=X.getTemplate(_)).dataSource.isCreatedFsm(Q[2])?(G.addTemplate($,Q[2],q,s),n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，应为“（1）状态名（2）对象名.状态名（3）*模板变量.状态名（4）对象名.*局部模板变量.状态名”几种形式，当前不符合，无法解析，状态："+y+"，关联状态："+z+"，请检查！"+s):(n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“对象名.*模板变量.状态名”形式，在当前对象的该模板变量中无法查找到对应状态名，状态："+y+"，关联状态："+z+"，请检查！"+s):(n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“对象名.*模板变量.状态名”形式，在当前对象中无法查找到该模板变量，状态："+y+"，关联状态："+z+"，请检查！"+s),null}if(2!==Q.length)return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，应为“（1）状态名（2）对象名.状态名（3）*模板变量.状态名（4）对象名.*局部模板变量.状态名”几种形式，当前不符合，无法解析，状态："+y+"，关联状态："+z+"，请检查！"+s,null;var H=Q[0].trim();if(Z=Q[1].trim(),H.startsWith(ne.StateConst.VARIABLE_SYMBOL))if(H=H.substring(1),c.isCreatedTemplate(H)){if(!($=c.getTemplate(H)).dataSource.isCreatedFsm(Q[1]))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“*模板变量.状态名”形式，在当前模板变量中无法查找到对应状态名，状态："+y+"，关联状态："+z+"，请检查！"+s,null;G.addTemplate($,Q[1],q,s)}else{var $,ee=oe.VE_Manager.variables(this._projectName);if(!ee.isCreatedTemplate(H))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“*模板变量.状态名”形式，在当前模板变量中无法查找到该“*模板变量”，状态："+y+"，关联状态："+z+"，请检查！"+s,null;if(!($=ee.getTemplate(H)).dataSource.isCreatedFsm(Q[1]))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“*模板变量.状态名”形式，在当前模板变量中无法查找到对应状态名，状态："+y+"，关联状态："+z+"，请检查！"+s,null;G.addTemplate($,Q[1],q,s)}else{if(null===(X=p.getVeryObject(H)))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前关联状态填写格式为“对象名.状态名”，当前系统中无法查找到该对象名，状态："+y+"，关联状态："+z+"，请检查！"+s,null;if(null===(te=X.getFsm(Z)))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前关联状态填写格式为“对象名.状态名”，当前对象名所对应的对象中无法查找到该状态名，状态："+y+"，关联状态："+z+"，请检查！"+s,null;if(null===(re=te.getState(q)))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前关联状态填写格式为“对象名.状态名”，当前关联状态序号超出对应状态序号范围，状态："+y+"，关联状态："+z+"，请检查！"+s,null;G.add(re,q,s)}}else{var te,re;if(null===(te=c.getFsm(Z)))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“状态名”形式，无法查找到该状态，状态："+y+"，关联状态："+z+"，请检查！"+s,null;if(null===(re=te.getState(q)))return n.isRight=!1,n.message="模板对象实例化失败：当前关联状态格式错误，当前为“状态名”形式，可以查找到对象和状态，但是状态序号超出范围，状态："+y+"，关联状态："+z+"，请检查！"+s,null;G.add(re,q,s)}}W.addAssociatedState(G)}}return r},e.prototype.assignmentAction=function(e,t,r,i,n,a,s,o){var u=new pe.VE_Assignment(s,a.totalString),l=a.varID;if(!(-1<l.indexOf(ne.StateConst.VARIABLE_SYMBOL)))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左边必须为变量，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(-1<l.indexOf(ne.StateConst.STATE_SEPARATOR)){for(var c=l.split(ne.StateConst.STATE_SEPARATOR),p=0;p<c.length;p++)c[p]=c[p].trim();if(2===c.length)if(c[0].startsWith(ne.StateConst.VARIABLE_SYMBOL)){var h=c[0].substring(1);if(l=c[1].substring(1),n.isCreatedTemplate(h)){if((y=n.getTemplate(h)).varData.isCreatedVariable(l)){if("expression"===(_=y.varData.getVariableParas(l))[1].toLowerCase()||"公式"===_[1].toLowerCase())return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*模板变量.*变量”，该变量不能为“公式”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setLeftTemplateVar(y,l)}else{if(!y.dataSource.isCreatedFsm(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setLeftTemplateVar(y,l)}}else{if(!i.isCreatedTemplate(h))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，为全局变量，但是无法查到对应“*变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if((y=i.getTemplate(h)).varData.isCreatedVariable(l)){var _;if("expression"===(_=y.varData.getVariableParas(l))[1].toLowerCase()||"公式"===_[1].toLowerCase())return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*模板变量.*变量”，该变量不能为“公式”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setLeftTemplateVar(y,l)}else{if(!y.dataSource.isCreatedFsm(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*模板变量.*变量”，当前“*模板变量”无法在系统中查找到，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setLeftTemplateVar(y,l)}}}else{if(!(V=oe.VE_Manager.objects(e)).isCreated(c[0]))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式“对象名.*变量”，当前“对象名”无法在系统中查找到，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;var f=V.getVeryObject(c[0]);if(l=l.substring(1),f.isCreatedExpression(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“对象名.*变量”，该变量不能为“公式”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(f.isCreatedFsm(l)){var g=f.getFsm(l).fsmVar;u.setLeftVariable(g)}else if(f.isCreatedVariable(l)){g=f.getVariable(l);u.setLeftVariable(g)}else{if(!f.isCreatedTemplate(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式“对象名.*变量”，当前“对象名”中无法查找到该变量，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;var y=f.getTemplate(l);u.setLeftTemplate(y)}}else{if(3!==c.length)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(c[0].startsWith(ne.StateConst.STATE_SEPARATOR)||!c[1].startsWith(ne.StateConst.STATE_SEPARATOR)||!c[2].startsWith(ne.StateConst.STATE_SEPARATOR))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;h=c[1].substring(1);if(l=c[2].substring(1),!(V=oe.VE_Manager.objects(e)).isCreated(c[0]))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名”无法在系统中查找到，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(!(T=V.getVeryObject(c[0])).isCreatedTemplate(h))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名”的对象中无法查找到该“*模板变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if((y=T.getTemplate(h)).dataSource.isCreatedFsm(l))u.setLeftTemplateVar(y,l);else{if(!y.varData.isCreatedVariable(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名.*模板变量”可以查找到，但是无法查到对应“*变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;var m=y.varData.getVariableParas(l);if("expression"===m[1].toLowerCase()||"公式"===m[1].toLowerCase())return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号左侧变量格式“对象名.*模板变量.*变量”，当前“对象名.*模板变量.*变量”为公式变量，公式变量不可直接赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setLeftTemplateVar(y,l)}}}else{if(l=l.substring(1),n.isCreatedExpression(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*变量”，该变量不能为“公式”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(n.isCreatedFsm(l)){g=n.getFsm(l).fsmVar;u.setLeftVariable(g)}else if(n.isCreatedVariable(l)){g=n.getVariable(l);u.setLeftVariable(g)}else if(n.isCreatedTemplate(l)){y=n.getTemplate(l);u.setLeftTemplate(y)}else{if(i.isCreatedExpression(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*变量”，该变量不能为“公式”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(i.isCreatedVariable(l)){g=i.getVariable(l);u.setLeftVariable(g)}else{if(!i.isCreatedTemplate(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧格式“*变量”，无法在当前系统中查找到该变量，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;y=i.getTemplate(l);u.setLeftTemplate(y)}}}if((l=a.varValue.trim()).startsWith('"')||l.startsWith("'")||l.startsWith("“")||l.startsWith("‘"))u.setRightConst(l.substring(1,l.length-2).trim());else if(ie.VE_StringFormat.isFormulaString(l)){var d=new ie.ErrorInfo;ne.StateConst.AssignmentFormulaCount++;var b=le.VE_Expressions.createLocalExpression(ne.StateConst.AssignmentPrefix+ne.StateConst.AssignmentFormulaCount.toString(),l,e,t,d);if(!d.isRight||null===b)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“公式”，公式解析错误，请检查！错误信息："+d.message,!1;u.setRightVariable(new ue.VeryExpression(b))}else if(-1<l.indexOf(ne.StateConst.VARIABLE_SYMBOL))if(-1<l.indexOf(ne.StateConst.STATE_SEPARATOR)){for(c=l.split(ne.StateConst.STATE_SEPARATOR),p=0;p<c.length;p++)c[p]=c[p].trim();if(2===c.length)if(c[0].startsWith(ne.StateConst.VARIABLE_SYMBOL)){h=c[0].substring(1);if(l=c[1].substring(1),n.isCreatedTemplate(h)){if(!(y=n.getTemplate(h)).varData.isCreatedVariable(l)&&!y.dataSource.isCreatedFsm(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightTemplateVariable(y,l)}else{if(!i.isCreatedTemplate(h))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*模板变量.*变量”，当前“*模板变量”无法在系统中查找到，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(!(y=i.getTemplate(h)).varData.isCreatedVariable(l)&&!y.dataSource.isCreatedFsm(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*模板变量.*变量”，当前“*模板变量”可以查找到，但是无法查到对应“*变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightTemplateVariable(y,l)}}else{if(!(V=oe.VE_Manager.objects(e)).isCreated(c[0]))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“对象名.*变量”，当前“对象名”无法在系统中查找到，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;f=V.getVeryObject(c[0]);l=l.substring(1);var E=null,v=null;if(f.isCreatedExpression(l))E=new ue.VeryExpression(f.getExpression(l));else if(f.isCreatedFsm(l))E=f.getFsm(l).fsmVar;else if(f.isCreatedVariable(l))E=f.getVariable(l);else{if(!f.isCreatedTemplate(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“对象名.*变量”，当前“对象名”中无法查找到该变量，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;v=f.getTemplate(l)}if(null!==E){if(u.leftType===he.AssignType.Template)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧为“模板变量”类型，右侧为“普通变量”类型，无法赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(u.leftType===he.AssignType.Variable){if(!P.VE_AssignmentTypeJudge.allow(u.leftVariable,E))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“对象名.*变量”，当前赋值响应等号左侧和右侧类型不匹配，无法赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightVariable(E)}else u.setRightVariable(E)}else{if(null==v)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“对象名.*变量”，当前赋值响应等号右侧数据无法识别，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(u.leftType!==he.AssignType.Template)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧为“模板变量”，右侧为“普通变量”，无法赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightTemplate(v)}}else{if(3!==c.length)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号右侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，无法解析，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(c[0].startsWith(ne.StateConst.STATE_SEPARATOR)||!c[1].startsWith(ne.StateConst.STATE_SEPARATOR)||!c[2].startsWith(ne.StateConst.STATE_SEPARATOR))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号右侧变量格式错误，应为“（1）*变量；（2）对象名.*变量；（3）*模板变量.*变量；（4）对象名.*模板变量.*变量”几种形式，当前不符合，无法解析，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;var V,T;h=c[1].substring(1);if(l=c[2].substring(1),!(V=oe.VE_Manager.objects(e)).isCreated(c[0]))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号右侧变量格式“对象名.*模板变量.*变量”，当前“对象名”无法在系统中查找到，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(!(T=V.getVeryObject(c[0])).isCreatedTemplate(h))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号右侧变量格式“对象名.*模板变量.*变量”，当前“对象名”的对象中无法查找到该“*模板变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(!(y=T.getTemplate(h)).dataSource.isCreatedFsm(l)&&!y.varData.isCreatedVariable(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，赋值响应等号右侧变量格式“对象名.*模板变量.*变量”，当前“对象名.*模板变量”可以查找到，但是无法查到对应“*变量”，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightTemplateVariable(y,l)}}else{l=l.substring(1);E=null,v=null;if(n.isCreatedExpression(l))E=new ue.VeryExpression(n.getExpression(l));else if(n.isCreatedFsm(l))E=n.getFsm(l).fsmVar;else if(n.isCreatedVariable(l))E=n.getVariable(l);else if(n.isCreatedTemplate(l))v=n.getTemplate(l);else if(i.isCreatedExpression(l))E=new ue.VeryExpression(i.getExpression(l));else if(i.isCreatedVariable(l))E=i.getVariable(l);else if(i.isCreatedTemplate(l))v=i.getTemplate(l);else if(O.VerySceneVariables.Variables.isCreatedExpression(l))E=new ue.VeryExpression(O.VerySceneVariables.Variables.getExpression(l));else{if(!O.VerySceneVariables.Variables.isCreatedVariable(l))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*变量”，无法在当前系统中查找到该变量，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;E=O.VerySceneVariables.Variables.getVariable(l)}if(null!=E){if(u.leftType===he.AssignType.Template)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*变量”，等号左侧类型为“模板变量”，右侧为“普通变量”类型，无法赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(u.leftType===he.AssignType.Variable){if(!P.VE_AssignmentTypeJudge.allow(u.leftVariable,E))return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*变量”，当前赋值响应等号左侧和右侧类型不匹配，无法赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightVariable(E)}else u.setRightVariable(E)}else{if(null==v)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*变量”，但是数据无法识别，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;if(u.leftType!==he.AssignType.Template)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号右侧格式“*变量”，等号左侧类型为“模板变量”，右侧为“普通变量”类型，无法赋值，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightTemplate(v)}}else if(u.leftType===he.AssignType.Template){if("null"!==l.trim().toLowerCase())return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧为模板变量，右侧赋值为常量时只能填“null”，表示销毁模板变量，当前格式错误，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightNull()}else if(u.leftType===he.AssignType.TemplateVariable)u.setRightConst(l);else{if(null===u.leftVariable)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧变量获取为空，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;d=new ie.ErrorInfo;var S=u.leftVariable.initValue(l,d);if(!d.isRight||null===S)return o.isRight=!1,o.message="模板对象实例化失败：赋值响应格式错误，当前赋值响应等号左侧变量类型与右侧常量值不匹配，状态："+r+"，赋值响应："+a.totalString+"，请检查！",!1;u.setRightConstValue(S)}var A=new ne.VE_StateAction;return A.setAssignment(u),s.addAction(A),!0},e}();r.VE_Templates=i},{"../action":7,"../action/assignmentTypeJudge":6,"../babylon":10,"../enum":20,"../expression":29,"../manager":59,"../object":63,"../scene":66,"../state":70,"../trigger":79,"../utility":85,"../variables":92}],78:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.AddTriggerEvent=function(e,t,r,i){this._customTriggerStore[e]||(this._customTriggerStore[e]={}),this._customTriggerStore[e][t]||(this._customTriggerStore[e][t]={}),this._customTriggerStore[e][t][r]=i,this._delayAction[e]&&this._delayAction[e][t]&&this._delayAction[e][t][r]&&(this._delayAction[e][t][r].forEach(function(e){e(i)}),delete this._delayAction[e][t][r])},e.ConnectCustomTrigger=function(e,t,r,i){this._customTriggerStore[e]&&this._customTriggerStore[e][t]&&this._customTriggerStore[e][t][r]?i(this._customTriggerStore[e][t][r]):(this._delayAction[e]||(this._delayAction[e]={}),this._delayAction[e][t]||(this._delayAction[e][t]={}),this._delayAction[e][t][r]?this._delayAction[e][t][r].push(i):this._delayAction[e][t][r]=[i])},e._customTriggerStore={},e._delayAction={},e}();r.VE_CustomTriggerManager=i},{}],79:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./triggerBehaviour")),i(e("./triggers")),i(e("./customTriggerManager"))},{"./customTriggerManager":78,"./triggerBehaviour":80,"./triggers":81}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../state/stateConst"),n=function(){function e(){this._enabled=!0,this._projectName="",this._logicalSwitch=[],this._logicalExp=[],this._triggerTargets=[],this.gameObject=null,this.veryObject=null,this._objectID="object-axxx",this._triggerID="",this._id=""}return Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled&&this.isEnabled},set:function(e){this._enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){if(this._logicalSwitch)for(var e=0;e<this._logicalSwitch.length;e++)if(this._logicalSwitch[e]&&!this._logicalSwitch[e].evaluate())return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triggerID",{get:function(){return this._triggerID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unionID",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.set=function(e){this._scene=e},e.prototype.setTriggerID=function(e,t,r){this._projectName=e,this._triggerID=t,this._objectID=r,this._id=r+i.StateConst.STATE_SEPARATOR+t},e.prototype.addLogicalSwitch=function(e){this._logicalSwitch.push(e)},e.prototype.addTriggerTarget=function(e,t){this._logicalExp.push(e),this._triggerTargets.push(t)},e.prototype.setVeryObject=function(e){this.veryObject=e,this.gameObject=e.gameObject},e.prototype.sendEvent=function(){this.isEnabled&&this.eventProcess()},e.prototype.eventProcess=function(){if(this._triggerTargets)for(var e=0;e<this._triggerTargets.length;e++)(null===this._logicalExp[e]||this._logicalExp[e].evaluate())&&this._triggerTargets[e].action(this._id)},e.prototype.update=function(){this.isEnabled&&this.onUpdate()},e.prototype.onUpdate=function(){},e}();r.VE_TriggerBehaviour=n},{"../state/stateConst":74}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("../state"),u=e("../manager"),a=e("../global"),l=e("../babylon"),s=e("../enum"),i=function(){function e(){}return e.addTrigger=function(e){if(!a.GameGlobal.PlatformLoaded)for(var t=new e.prototype.constructor,r=t.ID.split("|"),i=0;i<r.length;i++){var n=r[i].trim().toLowerCase();this._triggerFunctionDics[n]?a.VE_ErrorManager.Add(new a.VE_Error("","触发初始化错误，触发ID重复，当前触发ID："+n+"，重复触发："+t.className+"，请为当前触发重新分配触发ID！","",s.Severity.Error)):this._triggerFunctionDics[n]=e}},e.hasTrigger=function(e){return e=e.toLowerCase(),!!this._triggerFunctionDics[e]},e.createTrigger=function(e,t,r,i,n){if(r=r.toLowerCase(),!this._triggerFunctionDics[r])return n.isRight=!1,n.message="触发创建错误：当前触发类型在平台中不存在，请检查！触发类型："+r,null;var a;try{if(!(a=new this._triggerFunctionDics[r].prototype.constructor))return n.isRight=!1,n.message="触发创建错误：当前触发创建失败，请检查！触发类型："+r,null;var s=a;return s.set(l.BabylonEngine.Scene),s.setVeryObject(e),s.setTriggerID(e.projectName,t,e.objectID),s.paraParser(i)?s:(n.isRight=!1,n.message="该触发创建失败，触发参数格式错误！",null)}catch(e){return console.error("触发创建错误："+e.message),n.isRight=!1,n.message="触发创建错误：当前触发类型创建失败，请检查！触发类型："+r+"，错误原因："+e.message,null}},e.remove=function(e){e=e.toLowerCase(),delete this._triggerFunctionDics[e]},e.findTrigger=function(e,t){if(e.isCreatedTrigger(t))return e.getTrigger(t);var r=t.split(o.StateConst.STATE_SEPARATOR);if(2!==r.length)return null;var i=u.VE_Manager.objects(e.projectName),n=r[0].trim(),a=r[1].trim();if(i.isCreated(n)){var s=i.getVeryObject(n);return s.isCreatedTrigger(a)?s.getTrigger(a):null}return null},e.dispose=function(){e._triggerFunctionDics={}},e._triggerFunctionDics={},e}();r.VE_Triggers=i},{"../babylon":10,"../enum":20,"../global":40,"../manager":59,"../state":70}],82:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.remove=function(e,t){var r=e.indexOf(t);-1<r&&e.splice(r,1)},e.clear=function(e){[]},e}();r.ArrayUtility=i},{}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this._keys=[],this._values=[]}return Object.defineProperty(e.prototype,"count",{get:function(){return this.Count()},enumerable:!0,configurable:!0}),e.prototype.Add=function(e,t){return this._keys.push(e),this._values.push(t)},e.prototype.Remove=function(e){var t=this._keys.indexOf(e,0);this._keys.splice(t,1),this._values.splice(t,1)},e.prototype.Count=function(){return this._keys.length},e.prototype.SetValue=function(e,t){var r=this._keys.indexOf(e,0);return-1!=r&&(this._keys[r]=e,this._values[r]=t,!0)},e.prototype.GetValue=function(e){var t=this._keys.indexOf(e,0);return-1!=t?this._values[t]:null},e.prototype.ContainsKey=function(e){for(var t=this._keys,r=0;r<t.length;++r)if(t[r]==e)return!0;return!1},e.prototype.GetKeys=function(){return this._keys},e.prototype.GetValues=function(){return this._values},e}();r.Dictionary=i},{}],84:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this.isRight=!0,this.message=""}return e.prototype.clear=function(){this.isRight=!0,this.message=""},e}();r.ErrorInfo=i},{}],85:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./arrayUtility")),i(e("./dictionary")),i(e("./errorInfo")),i(e("./stringFormat")),i(e("./paraParserUtility")),i(e("./keyboardMap")),i(e("./typeConvert")),i(e("./mathUtility")),i(e("./veryParas"))},{"./arrayUtility":82,"./dictionary":83,"./errorInfo":84,"./keyboardMap":86,"./mathUtility":87,"./paraParserUtility":88,"./stringFormat":89,"./typeConvert":90,"./veryParas":91}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.init=function(){this._keyMap.backspace="Backspace",this._keyMap["退格"]="Backspace",this._keyMap.tab="Tab",this._keyMap.enter="Enter",this._keyMap["回车"]="Enter",this._keyMap.shift="Shift",this._keyMap.control="Control",this._keyMap.ctrl="Control",this._keyMap.alt="Alt",this._keyMap.pause="Pause",this._keyMap.capsLock="CapsLock",this._keyMap.escape="Escape",this._keyMap.pageup="PageUp",this._keyMap["上一页"]="PageUp",this._keyMap.pagedown="PageDown",this._keyMap["下一页"]="PageDown",this._keyMap.end="End",this._keyMap.home="Home",this._keyMap.arrowleft="ArrowLeft",this._keyMap["左"]="ArrowLeft",this._keyMap.arrowup="ArrowUp",this._keyMap["上"]="ArrowUp",this._keyMap.arrowright="ArrowRight",this._keyMap["右"]="ArrowRight",this._keyMap.arrowdown="ArrowDown",this._keyMap["下"]="ArrowDown",this._keyMap.insert="Insert",this._keyMap["插入"]="Insert",this._keyMap.delete="Delete",this._keyMap["删除"]="Delete",this._keyMap[0]="0",this._keyMap[1]="1",this._keyMap[2]="2",this._keyMap[3]="3",this._keyMap[4]="4",this._keyMap[5]="5",this._keyMap[6]="6",this._keyMap[7]="7",this._keyMap[8]="8",this._keyMap[9]="9",this._keyMap[")"]=")",this._keyMap["）"]=")",this._keyMap["!"]="!",this._keyMap["！"]="!",this._keyMap["@"]="@",this._keyMap["#"]="#",this._keyMap.$="$",this._keyMap["￥"]="$",this._keyMap["%"]="%",this._keyMap["^"]="^",this._keyMap["……"]="^",this._keyMap["&"]="&",this._keyMap["*"]="*",this._keyMap["("]="(",this._keyMap["（"]="(",this._keyMap.meta="meta",this._keyMap.windows="meta",this._keyMap.contextmenu="ContextMenu",this._keyMap["快捷菜单"]="ContextMenu",this._keyMap.f1="F1",this._keyMap.f2="F2",this._keyMap.f3="F3",this._keyMap.f4="F4",this._keyMap.f5="F5",this._keyMap.f6="F6",this._keyMap.f7="F7",this._keyMap.f8="F8",this._keyMap.f9="F9",this._keyMap.f10="F10",this._keyMap.f11="F11",this._keyMap.f12="F12",this._keyMap.scrolllock="ScrollLock",this._keyMap[";"]=";",this._keyMap["；"]=";",this._keyMap[":"]=":",this._keyMap["："]=":",this._keyMap["="]="=",this._keyMap["+"]="+",this._keyMap["-"]="-",this._keyMap._="_",this._keyMap["——"]="_",this._keyMap[","]=",",this._keyMap["，"]=",",this._keyMap["<"]="<",this._keyMap["《"]="<",this._keyMap["."]=".",this._keyMap["。"]=".",this._keyMap[">"]=">",this._keyMap["》"]=">",this._keyMap["?"]="?",this._keyMap["？"]="?",this._keyMap["/"]="/",this._keyMap["`"]="`",this._keyMap["·"]="`",this._keyMap["~"]="~",this._keyMap["|"]="|",this._keyMap["\\"]="\\",this._keyMap["\\"]="\\",this._keyMap.numlock="NumLock",this._keyMap.a="a",this._keyMap.b="b",this._keyMap.c="c",this._keyMap.d="d",this._keyMap.e="e",this._keyMap.f="f",this._keyMap.g="g",this._keyMap.h="h",this._keyMap.i="i",this._keyMap.j="j",this._keyMap.k="k",this._keyMap.l="l",this._keyMap.m="m",this._keyMap.n="n",this._keyMap.o="o",this._keyMap.p="p",this._keyMap.q="q",this._keyMap.r="r",this._keyMap.s="s",this._keyMap.t="t",this._keyMap.u="u",this._keyMap.v="v",this._keyMap.w="w",this._keyMap.x="x",this._keyMap.y="y",this._keyMap.z="z"},e.GetKey=function(e){return this._initialized||(this.init(),this._initialized=!0),e=e.trim().toLowerCase(),this._keyMap[e]?this._keyMap[e]:"null"},e._keyMap={},e._initialized=!1,e}();r.VE_KeyboardMap=i},{}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.Slerp=function(e,t,r){r<0?r=0:1<r&&(r=1);var i=new BABYLON.Vector3,n=.5*(Math.sin(Math.PI*(r-.5))+1);return i.x=e.x+(t.x-e.x)*n,i.y=e.y+(t.y-e.y)*n,i.z=e.z+(t.z-e.z)*n,i},e}();r.Vector3Utility=i;var n=function(){function e(){}return e.Lerp=function(e,t,r){return r<0?r=0:1<r&&(r=1),e+(t-e)*r},e.SLerp=function(e,t,r){return r<0?r=0:1<r&&(r=1),e+(t-e)*(.5*(Math.sin(Math.PI*(r-.5))+1))},e}();r.FloatUitlity=n},{}],88:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=e("../enum"),_=e("../global"),f=e("../variables"),g=e("./errorInfo"),y=e("../manager"),m=e("../babylon"),l=e("./typeConvert"),i=function(){function u(){}return u.ParaNumbers=function(e,t,r){for(var i=[],n=3;n<arguments.length;n++)i[n-3]=arguments[n];for(var a=0;a<i.length;a++)if(i[a]===r)return!0;var s="";for(a=0;a<i.length;a++)s+=0===a?(i[a]+1).toString()+"个":"或者"+(i[a]+1).toString()+"个";return t===h.ParaType.Action?_.VE_ErrorManager.Add(new _.VE_Error("",e+" 响应 需要"+s+"传入参数，当前参数个数为"+(r+1)+"个，请检查！","",h.Severity.Error)):_.VE_ErrorManager.Add(new _.VE_Error("",e+" 触发 需要"+s+"传入参数，当前参数个数为"+(r+1)+"个，请检查！","",h.Severity.Error)),!1},u.GameObjectPara=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);if(null===u){o.clear();var l=f.VarTools.GetTemplate(e,t,a,o);return null===l?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，当前系统中无法查找到该变量："+a+"，请检查！","",h.Severity.Error)),!1):null===l.templateInstance?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，传入参数为模板变量："+a+"，当前模板变量未实例化，无法获取GameObject，请检查！","",h.Severity.Error)),!1):(n.gameObject.value=l.templateInstance.gameObject,!0)}if("VeryGameObject"===u.className)return n.gameObject=u,!0;if("VeryString"!==u.className)return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为GameObject变量，请检查！","",h.Severity.Error)),!1;var c=u;return n.gameObject.value=m.GameObject.Find(c.value),null!==n.gameObject.value||(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，物体："+c.value+"，无法在场景中查找到，请检查！","",h.Severity.Error)),!1)}if("this"===a.toLowerCase().trim()){if(null===(p=y.VE_Manager.objects(e).getVeryObject(t)))return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，当前响应所在对象 ："+t+"，无法在场景中查找到，请检查！","",h.Severity.Error)),!1;n.gameObject.value=p.gameObject}else if("null"===a.toLowerCase().trim()||"none"===a.toLowerCase().trim()||""===a.toLowerCase().trim())n.gameObject.value=null;else{if(a.startsWith("/")){var p;if(p=y.VE_Manager.objects(e).getVeryObject(t)){p.gameObject,a.substring(1).trim();return null!==n.gameObject.value||(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，对象名："+t+"，物体："+a+"，该子物体无法在当前对象中查找到，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，当前响应所在对象 ："+t+"，无法在场景中查找到，请检查！","",h.Severity.Error)),!1}if(n.gameObject.value=m.GameObject.Find(a),null===n.gameObject.value)return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，物体 ："+t+"，无法在场景中查找到，请检查！","",h.Severity.Error)),!1}return!0},u.GameObjectParaOnlyVar=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，只能为GameObject变量，不能为常量，也不能是模板变量，请检查！","",h.Severity.Error)),!1):"VeryGameObject"===u.className?(n.gameObject=u,!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为GameObject变量，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为GameObject变量，不能为常量，请检查！","",h.Severity.Error)),!1},u.StringPara=function(e,t,r,i,n,a,s){return void 0===s&&(s=!0),f.VarTools.IsVarID(a)?u.StringParaOnlyVar(e,t,r,i,n,a,s):(n.string.value=a,!0)},u.StringParaWithExpression=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVarWithExpression(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryString"===u.className?(n.string=u,!0):"VeryExpression"===u.className?"string"===u.varType?(n.string.setExpression(u),!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，该公式变量计算结果不为String，请检查！","",h.Severity.Error)),!1):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为String变量，请检查！","",h.Severity.Error)),!1)}return n.string.value=a,!0},u.StringParaOnlyVar=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryString"===u.className?(n.string=u,!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为String变量，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为String变量，不能为常量，请检查！","",h.Severity.Error)),!1},u.NumberPara=function(e,t,r,i,n,a,s){return void 0===s&&(s=!0),f.VarTools.IsVarID(a)?u.NumberParaOnlyVar(e,t,r,i,n,a,s):(n.number.value=parseFloat(a),!isNaN(n.number.value)||(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字常量，请检查！","",h.Severity.Error)),!1))},u.NumberParaWithExpression=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVarWithExpression(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryNumber"===u.className?(n.number=u,!0):"VeryExpression"===u.className?"number"===u.varType?(n.number.setExpression(u),!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，该公式变量计算结果不为number数字，请检查！","",h.Severity.Error)),!1):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字变量，请检查，请检查！","",h.Severity.Error)),!1)}return n.number.value=parseFloat(a),!isNaN(n.number.value)||(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字常量，请检查！","",h.Severity.Error)),!1)},u.NumberParaOnlyVar=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);return null===u?(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryNumber"===u.className?(n.number=u,!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字变量，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字变量，不能为常量，请检查！","",h.Severity.Error)),!1},u.BoolPara=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a))return u.BoolParaOnlyVar(e,t,r,i,n,a,s);var o=new g.ErrorInfo;return n.bool.value=l.VE_TypeConvert.boolConvert(a,o),!1!==o.isRight||(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为bool常量，请检查！","",h.Severity.Error)),!1)},u.BoolParaWithExpression=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryBool"===u.className?(n.bool=u,!0):"VeryExpression"===u.className?"bool"===u.varType?(n.bool.setExpression(u),!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，该公式变量计算结果不为bool，请检查！","",h.Severity.Error)),!1):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为bool变量，请检查！","",h.Severity.Error)),!1)}o=new g.ErrorInfo;return n.bool.value=l.VE_TypeConvert.boolConvert(a,o),!1!==o.isRight||(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为bool常量，请检查！","",h.Severity.Error)),!1)},u.BoolParaOnlyVar=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryBool"===u.className?(n.bool=u,!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为bool常量，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为bool变量，不能为常量，请检查！","",h.Severity.Error)),!1},u.Vector3Para=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVar(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryVector3"===u.className?(n.vector3=u,!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为Vector3向量变量，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为Vector3向量变量，当前为常量字符串，请检查！","",h.Severity.Error)),!1},u.Vector3OrNumberPara=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),-1<a.indexOf(",")||-1<a.indexOf("，")){n.isVec=!1;var o=a.split(/,|，/);return 3===o.length?!!this.privateNumberPara(e,t,r,i,n,o[0].trim(),0,s)&&(!!this.privateNumberPara(e,t,r,i,n,o[1].trim(),1,s)&&!!this.privateNumberPara(e,t,r,i,n,o[2].trim(),2,s)):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为“（数字1, 数字2, 数字3）”格式的数字number变量，当前参数个数不符合，请检查！","",h.Severity.Error)),!1)}return n.isVec=!0,this.Vector3Para(e,t,r,i,n,a,s)},u.Vector3ParaWithExpression=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),f.VarTools.IsVarID(a)){var o=new g.ErrorInfo,u=f.VarTools.GetVeryVarWithExpression(e,t,a,o);return null===u?(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+o.message,"",h.Severity.Error)),!1):"VeryVector3"===u.className?(n.vector3=u,!0):"VeryExpression"===u.className?"Vector3"===u.varType?(n.vector3.setExpression(u),!0):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，该公式变量计算结果不为Vector3，请检查！","",h.Severity.Error)),!1):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为Vector3变量，请检查！","",h.Severity.Error)),!1)}return s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为Vector3变量，当前为常量字符串，请检查！","",h.Severity.Error)),!1},u.Vector3OrNumberParaWithExpression=function(e,t,r,i,n,a,s){if(void 0===s&&(s=!0),-1<a.indexOf(",")||-1<a.indexOf("，")){n.isVec=!1;var o=a.split(/,|，/);return 3===o.length?!!this.privateNumberParaWithExpression(e,t,r,i,n,o[0].trim(),0,s)&&(!!this.privateNumberParaWithExpression(e,t,r,i,n,o[1].trim(),1,s)&&!!this.privateNumberParaWithExpression(e,t,r,i,n,o[2].trim(),2,s)):(s&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为“（数字1, 数字2, 数字3）”格式的Vector3变量，当前参数个数不符合，请检查！","",h.Severity.Error)),!1)}return n.isVec=!0,this.Vector3ParaWithExpression(e,t,r,i,n,a,s)},u.privateNumberParaWithExpression=function(e,t,r,i,n,a,s,o){if(void 0===o&&(o=!0),f.VarTools.IsVarID(a)){var u=new g.ErrorInfo,l=f.VarTools.GetVeryVarWithExpression(e,t,a,u);return null===l?(o&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+u.message,"",h.Severity.Error)),!1):"VeryNumber"===l.className?(n.vecNumbers[s]=l,!0):"VeryExpression"===l.className?"number"===l.varType?(n.vecNumbers[s].setExpression(l),!0):(o&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，该公式变量计算结果不为number数字，请检查！","",h.Severity.Error)),!1):(o&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字变量，请检查，请检查！","",h.Severity.Error)),!1)}return n.vecNumbers[s].value=parseFloat(a),!isNaN(n.vecNumbers[s].value)||(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字常量，请检查！","",h.Severity.Error)),!1)},u.privateNumberPara=function(e,t,r,i,n,a,s,o){return void 0===o&&(o=!0),f.VarTools.IsVarID(a)?u.privateNumberParaOnlyVar(e,t,r,i,n,a,s,o):(n.vecNumbers[s].value=parseFloat(a),!isNaN(n.vecNumbers[s].value)||(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字常量，请检查！","",h.Severity.Error)),!1))},u.privateNumberParaOnlyVar=function(e,t,r,i,n,a,s,o){if(void 0===o&&(o=!0),f.VarTools.IsVarID(a)){var u=new g.ErrorInfo,l=f.VarTools.GetVeryVar(e,t,a,u);return null===l?(_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，"+u.message,"",h.Severity.Error)),!1):"VeryNumber"===l.className?(n.vecNumbers[s]=l,!0):(o&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字变量，请检查！","",h.Severity.Error)),!1)}return o&&_.VE_ErrorManager.Add(new _.VE_Error("",r+"  "+(i===h.ParaType.Action?"响应":"触发")+" 传入参数错误，变量："+a+"，应为number数字变量，不能为常量，请检查！","",h.Severity.Error)),!1},u}();r.ParaParserUtility=i},{"../babylon":10,"../enum":20,"../global":40,"../manager":59,"../variables":92,"./errorInfo":84,"./typeConvert":90}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.init=function(){this._escapeCharacters.n="\n",this._escapeCharacters.b="\b",this._escapeCharacters.r="\r",this._escapeCharacters.t="\t",this._escapeCharacters.v="\v",this._escapeCharacters.f="\f",this._escapeCharacters[0]="\0",this._illegalChar["="]=!0,this._illegalChar[","]=!0,this._illegalChar["，"]=!0,this._illegalChar[":"]=!0,this._illegalChar["："]=!0,this._illegalChar["*"]=!0,this._illegalChar["("]=!0,this._illegalChar["（"]=!0,this._illegalChar[")"]=!0,this._illegalChar["）"]=!0,this._illegalChar["@"]=!0,this._illegalChar["#"]=!0,this._illegalChar.$=!0,this._illegalChar["%"]=!0,this._illegalChar["&"]=!0,this._illegalChar["^"]=!0,this._illegalChar["-"]=!0,this._illegalChar["+"]=!0,this._illegalChar["|"]=!0,this._illegalChar["/"]=!0,this._illegalChar["["]=!0,this._illegalChar["【"]=!0,this._illegalChar["]"]=!0,this._illegalChar["】"]=!0,this._illegalChar["{"]=!0,this._illegalChar["}"]=!0,this._illegalChar["."]=!0,this._illegalChar["。"]=!0,this._illegalChar["<"]=!0,this._illegalChar[">"]=!0,this._illegalChar[";"]=!0,this._illegalChar["；"]=!0,this._illegalChar["?"]=!0,this._illegalChar['"']=!0,this._illegalChar["“"]=!0,this._illegalChar["”"]=!0,this._illegalChar["'"]=!0,this._illegalChar["‘"]=!0,this._illegalChar["’"]=!0,this._illegalChar["!"]=!0,this._illegalChar["！"]=!0,this._illegalChar["`"]=!0,this._illegalChar["·"]=!0,this._illegalChar["~"]=!0,this._formulaChar["("]=!0,this._formulaChar[")"]=!0,this._formulaChar["（"]=!0,this._formulaChar["）"]=!0,this._formulaChar["!"]=!0,this._formulaChar["！"]=!0,this._formulaChar["^"]=!0,this._formulaChar["%"]=!0,this._formulaChar["&"]=!0,this._formulaChar["-"]=!0,this._formulaChar["+"]=!0,this._formulaChar["="]=!0,this._formulaChar["<"]=!0,this._formulaChar[">"]=!0,this._formulaChar["|"]=!0},e.strEscapeCharacterAction=function(e){for(var t="",r=0;r<e.length;r++)"\\"==e[r]&&r!=e.length-1?(t+=this.getEscapeCharacter(e[r+1]),r++):t+=e[r];return t},e.strSubsectionAction=function(e){for(var t="",r=[],i=!1,n=!1,a=0;a<e.length;a++){if("\\"==e[a]){if(a<e.length-1){t+=e[a+1],a++;continue}t+=e[a];break}if(n||'"'!==e[a]&&"“"!==e[a])if(!n||'"'!==e[a]&&"”"!==e[a])if(","===e[a]||"，"===e[a])i?t+=e[a]:(""!==t&&r.push(t),t="");else{if(" "===e[a])continue;t+=e[a]}else n=i=!1,""!==(t+='"')&&r.push(t),t="";else i=n=!0,t+='"'}return""!==t&&r.push(t),r},e.getEscapeCharacter=function(e){return this._escapeCharacters[e]?this._escapeCharacters[e]:e},e.getEscapeCharacter2=function(e,t){return this._escapeCharacters[e]?(t[0]=!0,this._escapeCharacters[e]):(t[0]=!1,e)},e.strSubsection=function(e){for(var t="",r=[],i=!1,n=!1,a=0;a<e.length;a++){if("\\"==e[a]){if(a<e.length-1){t+=this.getEscapeCharacter(e[a+1]),a++;continue}t+=e[a];break}if("("===e[a]||"（"===e[a]||'"'===e[a]||"“"===e[a])n=!(i=!0);else if(")"===e[a]||"）"===e[a]||'"'===e[a]||"”"===e[a])i=!1,""!==t&&r.push(t),t="",n=!1;else if(","===e[a]||"，"===e[a])i?t+=e[a]:(""!==t&&r.push(t),t=""),n=!1;else{if(" "===e[a]&&!n)continue;t+=e[a],n=!0}}return""!==t&&r.push(t),r},e.getParaArrayAll=function(e,t){for(var r=t.slice(),i=0;i<r.length;i++)if(r[i].startsWith("$"))if(-1<r[i].indexOf(",")||r[i].indexOf("，")){var n=r[i].split(/,|，/);n=this.getParaArrayAll(e,n);for(var a="",s=0;s<n.length;s++)s===n.length-1?a+=n[s]:(a+=n[s],a+=",");r[i]=a}else console.error("变量名："+r[i]+"，该变量未被创建！");else if(r[i].startsWith("%"))if(-1<r[i].indexOf(",")||-1<r[i].indexOf("，")){n=r[i].split(/,|，/);n=this.getParaArrayAll(e,n);for(a="",s=0;s<n.length;s++)s==n.length-1?a+=n[s]:(a+=n[s],a+=",");r[i]=a}else console.error("变量名："+r[i]+"，该BlurVar变量未被创建！");else if(-1<r[i].indexOf(",")||-1<r[i].indexOf("，")){n=r[i].split(/,|，/);n=this.getParaArrayAll(e,n);for(a="",s=0;s<n.length;s++)s==n.length-1?a+=n[s]:(a+=n[s],a+=",");r[i]=a}return r},e.paraSegment=function(e){for(var t="",r=[],i=!1,n=0,a=!1,s=!1,o=0;o<e.length;o++){if("\\"==e[o]){if(o<e.length-1){var u=[!0],l=this.getEscapeCharacter2(e[o+1],u);u[0]?(o++,t+=l):t+=e[++o];continue}t+=e[o];break}"("===e[o]||"（"===e[o]?s?t+=e[o]:(i?(n++,t+=e[o]):""!==t.trim()?(t+=e[o],a=!0):o<e.length-1&&this.needSaveBracket(e.substring(o+1))&&(t+=e[o],a=!0),i=!0):")"===e[o]||"）"===e[o]?s?t+=e[o]:0<n?(n--,i=!0,t+=e[o]):i=!(!i||!a)&&(t+=e[o],a=!1):'"'===e[o]||"'"===e[o]||"“"===e[o]||"”"===e[o]||"‘"===e[o]||"’"===e[o]?(t+=e[o],s=!s):","===e[o]||"，"===e[o]?s?t+=e[o]:i?t+=e[o]:(""!==t&&r.push(t.trim()),t=""):t+=e[o]}return""!==t&&r.push(t.trim()),r},e.needSaveBracket=function(e){for(var t=!1,r=0,i=0;i<e.length;i++){if(t){if(" "===e[i])continue;return","!==e[i]&&"，"!==e[i]}"("===e[i]||"（"===e[i]?r++:")"!==e[i]&&"）"!==e[i]||(0<r?r--:t=!0)}return!1},e.isIDLegal=function(e){for(var t=0;t<e.length;t++)if(this._illegalChar[e[t]])return!1;return!0},e.isFormulaString=function(e){for(var t=0;t<e.length;t++)if(this._formulaChar[e[t]])return!0;return!1},e._illegalChar={},e._formulaChar={},e._escapeCharacters={},e}();(r.VE_StringFormat=i).init()},{}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.boolConvert=function(e,t){return"true"===(e=e.toLowerCase().trim())||"开"===e||("false"===e||"关"===e||(t.isRight=!1,t.message="bool|开关类型转换错误，格式不正确，原始字符串："+e),!1)},e.intConvert=function(e,t){e=e.toLowerCase().trim();var r=parseFloat(e);return isNaN(r)?(t.isRight=!1,t.message="number|数字类型转化错误，格式不正确，原始字符串："+e,-1):Math.round(r)},e.floatConvert=function(e,t){e=e.toLowerCase().trim();var r=parseFloat(e);return isNaN(r)?(t.isRight=!1,t.message="number|数字类型转化错误，格式不正确，原始字符串："+e,-1):r},e}();r.VE_TypeConvert=i},{}],91:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../variables"),n=function(){function e(){this.gameObject=new i.VeryGameObject,this.bool=new i.VeryBool,this.number=new i.VeryNumber,this.string=new i.VeryString,this.vector3=new i.VeryVector3,this.vecNumbers=[new i.VeryNumber,new i.VeryNumber,new i.VeryNumber],this.isVec=!0}return e.prototype.clear=function(){},e}();r.VeryParas=n},{"../variables":92}],92:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./veryExpression")),i(e("./veryVarManager")),i(e("./veryVariables")),i(e("./variables")),i(e("./varTools"))},{"./varTools":93,"./variables":94,"./veryExpression":95,"./veryVarManager":96,"./veryVariables":97}],93:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=e("../state"),i=e("../scene"),p=e("../manager"),h=e("./veryExpression"),n=function(){function l(){}return l.IsVarID=function(e){return-1<e.indexOf(c.StateConst.VARIABLE_SYMBOL)},l.GetVeryVar=function(e,t,r,i){if(-1<r.indexOf(c.StateConst.STATE_SEPARATOR)){var n=r.split(c.StateConst.STATE_SEPARATOR);if(2!==n.length)return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，不符合，请检查！",null;for(var a=0;a<n.length;a++)n[a]=n[a].trim();if(n[1].startsWith(c.StateConst.VARIABLE_SYMBOL)){if((u=p.VE_Manager.objects(e)).isCreated(n[0])){var s=u.getVeryObject(n[0]),o=n[1].substring(1);return s.isCreatedVariable(o)?s.getVariable(o):(s.isCreatedFsm(o)?(i.isRight=!1,i.message="当前触发和响应不能引用状态变量，当前变量ID为："+r+"，请检查！"):s.isCreatedExpression(o)?(i.isRight=!1,i.message="当前触发和响应不能引用公式变量，当前变量ID为："+r+"，请检查！"):s.isCreatedTemplate(o)?(i.isRight=!1,i.message="当前触发和响应不能引用模板变量，当前变量ID为："+r+"，请检查！"):(i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，在当前对象中无法查找到该变量，请检查！"),null)}return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，在当前系统中，无法查找到该对象名，请检查！",null}return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，不符合，请检查！",null}var u;return r.startsWith(c.StateConst.VARIABLE_SYMBOL)?(r=r.substring(1),(u=p.VE_Manager.objects(e)).isCreated(t)?(s=u.getVeryObject(t)).isCreatedVariable(r)?s.getVariable(r):s.isCreatedFsm(r)?(i.isRight=!1,i.message="当前触发和响应不能引用状态变量，当前变量ID为："+r+"，请检查！",null):s.isCreatedExpression(r)?(i.isRight=!1,i.message="当前触发和响应不能引用公式变量，当前变量ID为："+r+"，请检查！",null):s.isCreatedTemplate(r)?(i.isRight=!1,i.message="触发和响应不能引用模板变量，当前变量ID为："+r+"，请检查！",null):l.GetGlobalVar(p.VE_Manager.variables(e),r,i):l.GetGlobalVar(p.VE_Manager.variables(e),r,i)):(i.isRight=!1,i.message="变量格式错误，应为“*变量”的格式，当前变量ID为："+r+"，请检查！",null)},l.GetGlobalVar=function(e,t,r){return e.isCreatedVariable(t)?e.getVariable(t):e.isCreatedExpression(t)?(r.isRight=!1,r.message="当前触发和响应不能引用公式变量，当前变量ID为："+t+"，请检查！",null):e.isCreatedTemplate(t)?(r.isRight=!1,r.message="当前触发和响应不能引用模板变量，当前变量ID为："+t+"，请检查！",null):l.GetSceneVar(t,r)},l.GetSceneVar=function(e,t){return i.VerySceneVariables.Variables.isCreatedVariable(e)?i.VerySceneVariables.Variables.getVariable(e):(i.VerySceneVariables.Variables.isCreatedExpression(e)?(t.isRight=!1,t.message="当前触发和响应不能引用公式变量，当前变量ID为："+e+"，请检查！"):(t.isRight=!1,t.message="无法在系统中查找到该变量，当前变量ID为："+e+"，请检查！"),null)},l.GetTemplate=function(e,t,r,i){if(-1<r.indexOf(c.StateConst.STATE_SEPARATOR)){var n=r.split(c.StateConst.STATE_SEPARATOR);if(2!==n.length)return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，不符合，请检查！",null;for(var a=0;a<n.length;a++)n[a]=n[a].trim();if(n[1].startsWith(c.StateConst.VARIABLE_SYMBOL)){if((u=p.VE_Manager.objects(e)).isCreated(n[0])){var s=u.getVeryObject(n[0]),o=n[1].substring(1);return s.isCreatedTemplate(o)?s.getTemplate(o):(i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，在当前对象中无法查找到该模板变量，请检查！",null)}return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，在当前系统中，无法查找到该对象名，请检查！",null}return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，不符合，请检查！",null}if(r.startsWith(c.StateConst.VARIABLE_SYMBOL)){var u;if(r=r.substring(1),(u=p.VE_Manager.objects(e)).isCreated(t))if((s=u.getVeryObject(t)).isCreatedTemplate(r))return s.getTemplate(r);var l=p.VE_Manager.variables(e);return l.isCreatedTemplate(r)?l.getTemplate(r):(i.isRight=!1,i.message="当前变量格式应为“*变量”，当前变量ID为："+r+"，在当前项目中无法查找到该模板变量，请检查！",null)}return i.isRight=!1,i.message="当前变量格式应为“*变量”，当前变量ID为："+r+"，不符合，请检查！",null},l.GetVeryVarWithExpression=function(e,t,r,i){if(-1<r.indexOf(c.StateConst.STATE_SEPARATOR)){var n=r.split(c.StateConst.STATE_SEPARATOR);if(2!==n.length)return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，不符合，请检查！",null;for(var a=0;a<n.length;a++)n[a]=n[a].trim();if(n[1].startsWith(c.StateConst.VARIABLE_SYMBOL)){if((u=p.VE_Manager.objects(e)).isCreated(n[0])){var s=u.getVeryObject(n[0]),o=n[1].substring(1);return s.isCreatedVariable(o)?s.getVariable(o):s.isCreatedFsm(o)?s.getFsm(o).fsmVar:s.isCreatedExpression(o)?new h.VeryExpression(s.getExpression(o)):(s.isCreatedTemplate(o)?(i.isRight=!1,i.message="当前触发和响应不能引用模板变量，当前变量ID为："+r+"，请检查！"):(i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，在当前对象中无法查找到该变量，请检查！"),null)}return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，在当前系统中，无法查找到该对象名，请检查！",null}return i.isRight=!1,i.message="当前变量格式应为“对象名.*变量”，当前变量ID为："+r+"，不符合，请检查！",null}var u;return r.startsWith(c.StateConst.VARIABLE_SYMBOL)?(r=r.substring(1),(u=p.VE_Manager.objects(e)).isCreated(t)?(s=u.getVeryObject(t)).isCreatedVariable(r)?s.getVariable(r):s.isCreatedFsm(r)?s.getFsm(r).fsmVar:s.isCreatedExpression(r)?new h.VeryExpression(s.getExpression(r)):s.isCreatedTemplate(r)?(i.isRight=!1,i.message="当前触发和响应不能引用模板变量，当前变量ID为："+r+"，请检查！",null):l.GetGlobalVarWithExpression(p.VE_Manager.variables(e),r,i):l.GetGlobalVarWithExpression(p.VE_Manager.variables(e),r,i)):(i.isRight=!1,i.message="变量格式错误，应为“*变量”的格式，当前变量ID为："+r+"，请检查！",null)},l.GetGlobalVarWithExpression=function(e,t,r){return e.isCreatedVariable(t)?e.getVariable(t):e.isCreatedExpression(t)?new h.VeryExpression(e.getExpression(t)):e.isCreatedTemplate(t)?(r.isRight=!1,r.message="当前触发和响应不能引用模板变量，当前变量ID为："+t+"，请检查！",null):l.GetSceneVarWithExpression(t,r)},l.GetSceneVarWithExpression=function(e,t){return i.VerySceneVariables.Variables.isCreatedVariable(e)?i.VerySceneVariables.Variables.getVariable(e):i.VerySceneVariables.Variables.isCreatedExpression(e)?new h.VeryExpression(i.VerySceneVariables.Variables.getExpression(e)):(t.isRight=!1,t.message="无法在系统中查找到该变量，当前变量ID为："+e+"，请检查！",null)},l}();r.VarTools=n},{"../manager":59,"../scene":66,"../state":70,"./veryExpression":95}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../dataSource"),n=function(){function e(e){this._projectName="",this._veryVars={},this._tempalteVars={},this._expressions={},this._projectName=e,this.varData=new i.VE_VariableData(e)}return Object.defineProperty(e.prototype,"projectName",{get:function(){return this._projectName},enumerable:!0,configurable:!0}),e.prototype.isCreated=function(e){return!!(this._veryVars[e]||this._tempalteVars[e]||this._expressions[e])},e.prototype.isCreatedVariable=function(e){return!!this._veryVars[e]},e.prototype.addVariable=function(e,t){this._veryVars[e]=t},e.prototype.getVariable=function(e){return this._veryVars[e]},e.prototype.isCreatedTemplate=function(e){return!!this._tempalteVars[e]},e.prototype.addTemplate=function(e,t){this._tempalteVars[e]=t},e.prototype.getTemplate=function(e){return this._tempalteVars[e]},e.prototype.isCreatedExpression=function(e){return!!this._expressions[e]},e.prototype.addExpression=function(e,t){this._expressions[e]=t},e.prototype.getExpression=function(e){return this._expressions[e]},e.prototype.clear=function(){this.varData&&this.varData.clear(),this._veryVars={},this._expressions={},this._tempalteVars={}},e}();r.VE_Variables=n},{"../dataSource":14}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../expression"),n=function(){function e(e){this.name="",this._value=i.ConstantExpression.Empty(),this._value=e}return Object.defineProperty(e.prototype,"varType",{get:function(){return this._value.expType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return"VeryExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ID",{get:function(){return"VeryExpression|公式变量"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNull",{get:function(){return null===this._value},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e){this._value=e},e.prototype.getValue=function(){return this._value.evaluate()},e.prototype.initValue=function(e,t){var r=parseFloat(e);return isNaN(r)?(t.isRight=!1,t.message="类型: "+this.varType+"，值："+e+"，该变量值和类型不匹配，转化错误，请检查！",null):r},e.prototype.clone=function(){return new e(this._value)},e}();r.VeryExpression=n},{"../expression":29}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l=e("../manager"),a=e("../global"),c=e("./veryExpression"),s=e("../enum"),i=function(){function e(){}return e.hasVarType=function(e){return e=e.toLowerCase(),!!this._veryVarFunctions[e]},e.addVarType=function(e){if(!a.GameGlobal.PlatformLoaded)for(var t=new e.prototype.constructor,r=t.ID.split("|"),i=0;i<r.length;i++){var n=r[i].trim().toLowerCase();this._veryVarFunctions[n]?a.VE_ErrorManager.Add(new a.VE_Error("","变量类型重复，当前变量类型："+n+"，重复变量："+t.className+"，请为当前变量重新分配变量类型！","",s.Severity.Error)):this._veryVarFunctions[n]=e}},e.createVariable=function(e,t,r,i){if(t=t.toLowerCase(),!this._veryVarFunctions[t])return i.isRight=!1,i.message="变量创建错误：当前变量类型在平台中不存在，请检查！变量类型："+t,null;var n;try{if(!(n=new this._veryVarFunctions[t].prototype.constructor))return i.isRight=!1,i.message="变量创建错误：当前类型在平台中不存在，请检查！类型名："+t,null;var a=n.initValue(r,i);return i.isRight?(n.setValue(a),n.name=e,n):null}catch(e){return console.log("变量创建错误："+e.message),i.isRight=!1,i.message="变量创建错误：当前类型在平台中不存在，请检查！类型名："+t+"，错误原因："+e.message,null}},e.getVarType=function(e){return e=e.toLowerCase(),this._veryVarFunctions&&this._veryVarFunctions[e]?this._veryVarFunctions[e]:null},e.remove=function(e){e=e.toLowerCase(),delete this._veryVarFunctions[e]},e.getVariable=function(e,t,r,i){if(""===t)return this.getSceneVariable(e,i);if(""===r)return this.getGlobalVariable(e,t,i);var n=l.VE_Manager.objects(t);if(n){var a=n.getVeryObject(r);return a?a.isCreatedVariable(e)?a.getVariable(e):a.isCreatedExpression(e)?new c.VeryExpression(a.getExpression(e)):a.isCreatedFsm(e)?a.getFsm(e).fsmVar:this.getGlobalVariable(e,t,i):this.getGlobalVariable(e,t,i)}return this.getGlobalVariable(e,t,i)},e.getTemplateVariable=function(e,t,r,i,n){if(""===r)return n.isRight=!1,n.message="无法在当前项目中查找到当前模板变量："+e+"；\n",null;if(""!==i){var a=l.VE_Manager.objects(r);if(a){if(a.isCreated(i)){var s=a.getVeryObject(i);return s.isCreatedTemplate(e)?null===(o=s.getTemplate(e)).templateInstance?(n.isRight=!1,n.message+="当前模板变量未实例化，请先实例化该模板对象，模板变量名："+e+"；\n",null):o.templateInstance.isCreatedVariable(t)?o.templateInstance.getVariable(t):o.templateInstance.isCreatedExpression(t)?new c.VeryExpression(o.templateInstance.getExpression(t)):o.templateInstance.isCreatedFsm(t)?o.templateInstance.getFsm(t).fsmVar:(n.isRight=!1,n.message+="当前模板变量中无法查找到该变量，模板变量名："+e+"，变量名："+t+"；\n",null):(n.isRight=!1,n.message+="无法在当前项目中查找到当前模板变量："+e+"；\n",null)}return n.isRight=!1,n.message+="无法在当前项目中查找到当前对象："+i+"；\n",null}return n.isRight=!1,n.message+="无法在当前项目中查找到当前对象："+i+"；\n",null}var o,u=l.VE_Manager.variables(r);return u&&u.isCreatedTemplate(e)?null===(o=u.getTemplate(e)).templateInstance?(n.isRight=!1,n.message+="当前模板变量未实例化，请先实例化该模板对象，模板变量名："+e+"；\n",null):o.templateInstance.isCreatedVariable(t)?o.templateInstance.getVariable(t):o.templateInstance.isCreatedExpression(t)?new c.VeryExpression(o.templateInstance.getExpression(t)):o.templateInstance.isCreatedFsm(t)?o.templateInstance.getFsm(t).fsmVar:(n.isRight=!1,n.message+="当前模板变量中无法查找到该变量，模板变量名："+e+"，变量名："+t+"；\n",null):(n.isRight=!1,n.message+="无法在当前项目中查找到当前模板变量："+e+"；\n",null)},e.getGlobalVariable=function(e,t,r){if(""===t)return this.getSceneVariable(e,r);var i=l.VE_Manager.variables(t);return i?i.isCreatedVariable(e)?i.getVariable(e):i.isCreatedExpression(e)?new c.VeryExpression(i.getExpression(e)):this.getSceneVariable(e,r):this.getSceneVariable(e,r)},e.getSceneVariable=function(e,t){return t.isRight=!1,t.message="暂时不支持场景变量！",null},e.dispose=function(){e._veryVarFunctions={}},e._veryVarFunctions={},e}();r.VeryVarManager=i},{"../enum":20,"../global":40,"../manager":59,"./veryExpression":95}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./veryVarManager"),n=e("../babylon/babylonVariables"),a=function(){function t(){this.name="",this._isExpression=!1,this._expression=null,this._value=!1,this._value=!1}return Object.defineProperty(t.prototype,"varType",{get:function(){return"bool"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"VeryBool"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ID",{get:function(){return"bool|开关"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._isExpression?this._expression.value.evaluate():this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),t.prototype.setValue=function(e){this._value=e},t.prototype.getValue=function(){return this._isExpression?this._expression.value.evaluate():this._value},t.prototype.setExpression=function(e){this._expression=e,this._isExpression=!0},t.prototype.initValue=function(e,t){return"false"!==(e=e.trim()).toLowerCase()&&"关"!==e&&("true"===e.toLowerCase()||"开"===e||""!==e&&"null"!==e.toLowerCase()&&"none"!==e.toLowerCase()&&(t.isRight=!1,t.message="类型: "+this.varType+"，值："+e+"，该变量值和类型不匹配，转化错误，请检查！",null))},t.prototype.clone=function(){var e=new t;return e.setValue(this._value),e},t}();r.VeryBool=a;var s=function(){function t(){this.name="",this._isExpression=!1,this._expression=null,this._value=0,this._value=0}return Object.defineProperty(t.prototype,"varType",{get:function(){return"number"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"VeryNumber"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ID",{get:function(){return"number|数字"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._isExpression&&this._expression?this._expression.value.evaluate():this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),t.prototype.setValue=function(e){this._value=e},t.prototype.setExpression=function(e){this._expression=e,this._isExpression=!0},t.prototype.getValue=function(){return this._isExpression&&this._expression?this._expression.value.evaluate():this._value},t.prototype.initValue=function(e,t){var r=parseFloat(e);return isNaN(r)?(t.isRight=!1,t.message="类型: "+this.varType+"，值："+e+"，该变量值和类型不匹配，转化错误，请检查！",null):r},t.prototype.clone=function(){var e=new t;return e.setValue(this._value),e},t}();r.VeryNumber=s;var o=function(){function t(){this.name="",this._isExpression=!1,this._expression=null,this._value="",this._value=""}return Object.defineProperty(t.prototype,"varType",{get:function(){return"string"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"VeryString"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ID",{get:function(){return"string|字符串"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._isExpression?this._expression.value.evaluate().toString():this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),t.prototype.getValue=function(){return this._isExpression?this._expression.value.evaluate().toString():this._value},t.prototype.setValue=function(e){this._value=e},t.prototype.initValue=function(e,t){return e.startsWith("'")||e.startsWith('"')||e.startsWith("“")||e.startsWith("‘")?e.substring(1,e.length-2):e},t.prototype.clone=function(){var e=new t;return e.setValue(this._value),e},t.prototype.setExpression=function(e){this._isExpression=!0,this._expression=e},t}();r.VeryString=o;var u=function(){function r(){this.name="",this._isExpression=!1,this._expression=null,this._value=BABYLON.Vector3.Zero(),this._value=BABYLON.Vector3.Zero()}return Object.defineProperty(r.prototype,"varType",{get:function(){return"Vector3"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return"VeryVector3"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ID",{get:function(){return"Vector3|向量"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"value",{get:function(){return this._isExpression&&this._expression?this._expression.value.evaluate():this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),r.prototype.getValue=function(){return this._isExpression&&this._expression?this._expression.value.evaluate():this._value},r.prototype.setValue=function(e){this._value=e},r.prototype.setExpression=function(e){this._isExpression=!0,this._expression=e},r.prototype.initValue=function(e,t){var r=BABYLON.Vector3.Zero();if("none"===e||"null"===e||""===e)return r;var i=e.split(/,|，/);if(3!==i.length)return t.isRight=!1,t.message="类型: "+this.varType+", 值: "+e+"，Vector3|向量类型值格式错误，转化错误！",null;var n=parseFloat(i[0]),a=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(n)||isNaN(a)||isNaN(s)?(t.isRight=!1,t.message="类型: "+this.varType+", 值: "+e+"，Vector3|向量类型值格式错误，转化错误！",null):r=new BABYLON.Vector3(n,a,s)},r.prototype.clone=function(){var e=new r,t=new BABYLON.Vector3(this._value.x,this._value.y,this._value.z);return e.setValue(t),e},r}();r.VeryVector3=u;var l=function(){function t(){this.name="",this._value=null}return Object.defineProperty(t.prototype,"varType",{get:function(){return"GameObject"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"VeryGameObject"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ID",{get:function(){return"GameObject|对象"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),t.prototype.setValue=function(e){this._value=e},t.prototype.getValue=function(){return this._value},t.prototype.initValue=function(e,t){if(""===e||"null"===e.toLowerCase()||"none"===e.toLowerCase())return null;var r=n.GameObject.Find(e);return null===r&&(t.isRight=!1,t.message="类型: "+this.varType+"，值："+e+"，在场景中找不到指定对象，请检查！"),r},t.prototype.clone=function(){var e=new t;return e.setValue(this._value),e},t}();r.VeryGameObject=l,i.VeryVarManager.addVarType(a),i.VeryVarManager.addVarType(s),i.VeryVarManager.addVarType(o),i.VeryVarManager.addVarType(u),i.VeryVarManager.addVarType(l)},{"../babylon/babylonVariables":8,"./veryVarManager":96}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../verytable/index"),i=e("./html/showError"),a=e("./loader/loaderManager"),s=e("./global"),o=e("./manager");!function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./index"));var u=function(){function e(){}return e.prototype.init=function(e,t){o.VE_Reset.dispose();var r=new n.VeryTable(e,"VeRyEngine"),i=(new a.LoaderManager).load(projectName,r);console.log("表格解析结果："+i),i||s.VE_ErrorManager.Print(),s.GameGlobal.PlatformLoaded=!0},e.prototype.showErrorTest=function(e){i.ShowError.show("大股东萨芬个是电饭锅三分隔收费的发大股东萨芬个是电饭锅三分隔收费的发大股东萨芬个是电饭锅三分隔收费的发大股东萨芬个是电饭锅三分隔收费的发大股东萨芬个是电饭锅三分隔收费的发大股东萨芬个是电饭锅三分隔收费的发，错误位置："+e.pos(7,5)),i.ShowError.showError("大股东萨芬个是电饭锅三分隔收费的发，错误位置："+e.pos(7,5)),i.ShowError.showWarn("大股东萨芬个是电饭锅三分隔收费的发，错误位置："+e.pos(7,5)),i.ShowError.show("大股东萨芬个是电饭锅三分隔收费的发，错误位置："+e.pos(7,5)),i.ShowError.show("大股东萨芬个是电饭锅三分隔收费的发，错误位置："+e.pos(7,5)),document.getElementById("settingsButton").addEventListener("click",i.ShowError.close)},e}();r.VeryEngine=u},{"../verytable/index":99,"./global":40,"./html/showError":43,"./index":44,"./loader/loaderManager":58,"./manager":59}],99:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),i(e("./veryTableRow")),i(e("./veryTable")),i(e("./veryTableSet"))},{"./veryTable":100,"./veryTableRow":101,"./veryTableSet":102}],100:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./veryTableRow"),i=function(){function e(e,t){if(void 0===t&&(t="默认Sheet"),this._id="",this._columnIDs=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],this._rows=[],this._id=t,this._rows=[],e)for(var r=0;r<e.length;r++){var i=new n.VeryTableRow(e[r]);this._rows.push(i)}}return Object.defineProperty(e.prototype,"ID",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"RowCount",{get:function(){return this._rows?this._rows.length:0},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){return this._rows[e].getData(t)},e.prototype.getRow=function(e){return 0<=e&&e<this._rows.length?this._rows[e]:void 0},e.prototype.pos=function(e,t){return"（"+(e+1)+"，"+this.getColumnID(t)+"，表名："+this.ID+"）"},e.prototype.getColumnID=function(e){if(0<=e&&e<26)return this._columnIDs[e];if(e<0)return"error";var t=Math.floor(e/26),r=e%26;return 0===t?this._columnIDs[t]:this._columnIDs[t-1]+this._columnIDs[r]},e.prototype.addRow=function(e){this._rows.push(e)},e}();r.VeryTable=i},{"./veryTableRow":101}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){this._rowData=[],e.forEach(function(e,t,r){r[t]||(r[t]="")}),this._rowData=e}return Object.defineProperty(e.prototype,"Count",{get:function(){return this._rowData?this._rowData.length:0},enumerable:!0,configurable:!0}),e.prototype.getData=function(e){return this._rowData[e]},e.prototype.add=function(e){this._rowData.push(e)},e.prototype.insert=function(e,t){this._rowData.push(t);var r=this._rowData.slice(e);r.push(t),this._rowData=r},e.prototype.remove=function(e){this._rowData.splice(e,1)},e.prototype.removeEnd=function(){this._rowData.pop()},e.prototype.isEmpty=function(){if(!this._rowData)return!0;for(var e=0;e<this._rowData.length;e++)if(""!==this._rowData[e]&&null!==this._rowData[e]&&void 0!==this._rowData[e])return!1;return!0},e}();r.VeryTableRow=i},{}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){this._tables=[],e&&(this._tables=e)}return Object.defineProperty(e.prototype,"Count",{get:function(){return this._tables?this._tables.length:0},enumerable:!0,configurable:!0}),e.prototype.getTable=function(e){return 0<=e&&e<this.Count?this._tables[e]:void 0},e.prototype.addTable=function(e){this._tables.push(e)},e.prototype.removeTable=function(e){0<=e&&e<this.Count&&this._tables.splice(e,1)},e}();r.VeryTableSet=i},{}]},{},[2]);
//# sourceMappingURL=veryengine.js.map
